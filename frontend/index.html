<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¹ç°¿AI ContractClarity - ä¸“å®¶çº§ AI åˆåŒå®¡æŸ¥</title>
    <!-- å¤–éƒ¨ä¾èµ–åº“ -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- OCR æ–‡å­—è¯†åˆ«åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <!-- PDF è§£æåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <!-- Word æ–‡æ¡£è§£æåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Fraunces:wght@700;900&display=swap"
        rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #020617;
            min-height: 100vh;
            color: #f1f5f9;
            overflow-x: hidden;
        }

        /* â”€â”€ åŠ¨æ€èƒŒæ™¯ â”€â”€ */
        .bg-orbs {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.12;
            animation: orbFloat 18s ease-in-out infinite;
        }
        .orb-1 { width: 600px; height: 600px; background: #3b82f6; top: -200px; left: -200px; animation-delay: 0s; }
        .orb-2 { width: 500px; height: 500px; background: #a855f7; top: 30%; right: -150px; animation-delay: -6s; }
        .orb-3 { width: 400px; height: 400px; background: #06b6d4; bottom: -100px; left: 30%; animation-delay: -12s; }
        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33%       { transform: translate(40px, -60px) scale(1.05); }
            66%       { transform: translate(-30px, 40px) scale(0.95); }
        }

        /* â”€â”€ æ‰«æçº¿åŠ¨ç”» â”€â”€ */
        @keyframes scanLine {
            0%   { transform: translateY(-100%); opacity: 0.6; }
            100% { transform: translateY(100vh); opacity: 0; }
        }
        .scan-line {
            position: fixed;
            left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(59,130,246,0.5), transparent);
            animation: scanLine 6s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        .display-font { font-family: 'Fraunces', serif; }

        .glass-card {
            background: rgba(255,255,255,0.025);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255,255,255,0.07);
            border-radius: 2rem;
        }
        .glass-card-light {
            background: rgba(255,255,255,0.04);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1.5rem;
        }

        .gradient-text {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 50%, #f472b6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-text-green {
            background: linear-gradient(135deg, #34d399, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* â”€â”€ é£é™©ç­‰çº§ â”€â”€ */
        .risk-æé«˜, .risk-Critical, .risk-TrÃ¨s Ã©levÃ©, .risk-Sehr hoch, .risk-Muy alto {
            background: #ef4444; box-shadow: 0 0 30px rgba(239,68,68,0.4); color: white;
        }
        .risk-é«˜, .risk-High, .risk-Ã‰levÃ©, .risk-Hoch, .risk-Alto {
            background: #f97316; box-shadow: 0 0 30px rgba(249,115,22,0.4); color: white;
        }
        .risk-ä¸­, .risk-Medium, .risk-Moyen, .risk-Mittel, .risk-Medio {
            background: #fbbf24; box-shadow: 0 0 30px rgba(251,191,36,0.4); color: #1e293b;
        }
        .risk-ä½, .risk-Low, .risk-Faible, .risk-Niedrig, .risk-Bajo {
            background: #10b981; box-shadow: 0 0 30px rgba(16,185,129,0.4); color: white;
        }

        .border-æé«˜, .border-Critical { border-color: #ef4444 !important; border-width: 2px; }
        .border-é«˜,  .border-High     { border-color: #f97316 !important; border-width: 2px; }
        .border-ä¸­,  .border-Medium   { border-color: #fbbf24 !important; border-width: 2px; }
        .border-ä½,  .border-Low      { border-color: #10b981 !important; border-width: 2px; }

        .highlight-æé«˜, .highlight-Critical { background: rgba(239,68,68,0.3); border-bottom: 2px solid #ef4444; }
        .highlight-é«˜,   .highlight-High     { background: rgba(249,115,22,0.3); border-bottom: 2px solid #f97316; }
        .highlight-ä¸­,   .highlight-Medium   { background: rgba(251,191,36,0.3); border-bottom: 2px solid #fbbf24; }
        .highlight-ä½,   .highlight-Low      { background: rgba(16,185,129,0.3); border-bottom: 2px solid #10b981; }

        /* â”€â”€ åˆåŒæ–‡æœ¬ â”€â”€ */
        .text-view-box {
            height: 100%;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 2;
            color: #94a3b8;
            background: rgba(255,255,255,0.02);
            backdrop-filter: blur(20px);
            padding: 2.5rem;
            border-radius: 2rem;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .revised-contract-box {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 2;
            color: #cbd5e1;
            background: rgba(0,255,150,0.02);
            padding: 2rem;
            border-radius: 1.5rem;
            border: 1px solid rgba(16,185,129,0.15);
            font-size: 0.9rem;
        }

        /* â”€â”€ ä¿®è®¢æ ‡è®°é«˜äº® â”€â”€ */
        .revised-contract-box .revision-marker {
            background: rgba(16,185,129,0.2);
            border-left: 3px solid #10b981;
            padding: 0.2rem 0.5rem;
            border-radius: 0.25rem;
            color: #6ee7b7;
            font-weight: 700;
        }

        /* â”€â”€ æ»šåŠ¨æ¡ â”€â”€ */
        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.08); border-radius: 10px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

        /* â”€â”€ æ ‡ç­¾æŒ‰é’® â”€â”€ */
        .tab-btn-active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            box-shadow: 0 10px 25px rgba(59,130,246,0.35);
        }

        /* â”€â”€ åŠ¨ç”» â”€â”€ */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .animate-up { animation: slideUp 0.6s ease-out forwards; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to   { opacity: 1; }
        }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }

        @keyframes pulse-ring {
            0%   { transform: scale(1);   opacity: 0.8; }
            100% { transform: scale(1.8); opacity: 0; }
        }
        .pulse-ring {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            border: 2px solid #3b82f6;
            animation: pulse-ring 2s cubic-bezier(0.4,0,0.6,1) infinite;
        }

        /* â”€â”€ ä»ªè¡¨ç›˜ â”€â”€ */
        .gauge-ring { transition: stroke-dasharray 2s ease-in-out; }

        /* â”€â”€ è¯­è¨€é€‰æ‹©å™¨ â”€â”€ */
        .lang-selector {
            appearance: none;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.12);
            color: #cbd5e1;
            padding: 0.4rem 2rem 0.4rem 0.75rem;
            border-radius: 0.75rem;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.6rem center;
            transition: all 0.2s;
        }
        .lang-selector:hover { border-color: rgba(99,102,241,0.5); }
        .lang-selector:focus { outline: none; border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99,102,241,0.2); }

        /* â”€â”€ Markdown æ ·å¼ â”€â”€ */
        .negotiation-markdown strong { color: #60a5fa !important; font-weight: 800; }

        /* â”€â”€ è¿›åº¦æ¡ â”€â”€ */
        @keyframes progressPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .progress-bar { animation: progressPulse 1.5s ease-in-out infinite; }

        /* â”€â”€ å­—æ•°æ¡ â”€â”€ */
        .char-bar-fill { transition: width 0.3s ease; }
        .char-bar-warn  { background: #f97316; }
        .char-bar-ok    { background: linear-gradient(90deg, #3b82f6, #8b5cf6); }
        .char-bar-error { background: #ef4444; }

        /* â”€â”€ å¡ç‰‡æ‚¬åœ â”€â”€ */
        .hover-lift { transition: transform 0.2s, box-shadow 0.2s; }
        .hover-lift:hover { transform: translateY(-3px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }

        /* â”€â”€ OCR è¿›í–‰ â”€â”€ */
        @keyframes typing {
            0%, 100% { opacity: 1; }
            50%       { opacity: 0; }
        }
        .cursor-blink { animation: typing 0.8s steps(1) infinite; }

        /* â”€â”€ é£é™©åˆ†å¸ƒæ¡ â”€â”€ */
        .risk-bar { transition: width 0.8s cubic-bezier(0.4,0,0.2,1); }

        /* â”€â”€ ä¿®è®¢åˆåŒ Tab â”€â”€ */
        .revision-note-card {
            border-left: 3px solid #10b981;
            padding: 0.75rem 1rem;
            background: rgba(16,185,129,0.05);
            border-radius: 0 0.75rem 0.75rem 0;
        }

        /* â”€â”€ æ–‡ä»¶ä¸Šä¼ æ‹–æ‹½ â”€â”€ */
        .upload-zone { transition: all 0.3s ease; }
        .upload-zone.drag-over {
            border-color: rgba(99,102,241,0.8) !important;
            background: rgba(99,102,241,0.08) !important;
            transform: scale(1.01);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* â”€â”€ ç™»å½•é¡µé¢ â”€â”€                                      */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .login-input {
            width: 100%;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.10);
            border-radius: 1rem;
            padding: 0.875rem 1.25rem;
            color: #f1f5f9;
            font-size: 0.95rem;
            font-family: 'Plus Jakarta Sans', sans-serif;
            transition: all 0.2s;
            outline: none;
        }
        .login-input:focus {
            border-color: rgba(99,102,241,0.6);
            background: rgba(99,102,241,0.05);
            box-shadow: 0 0 0 3px rgba(99,102,241,0.15);
        }
        .login-input::placeholder { color: rgba(148,163,184,0.45); }

        .social-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.7rem;
            border-radius: 0.875rem;
            border: 1px solid rgba(255,255,255,0.08);
            background: rgba(255,255,255,0.03);
            color: #94a3b8;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }
        .social-btn:hover { background: rgba(255,255,255,0.07); border-color: rgba(255,255,255,0.15); color: #cbd5e1; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* â”€â”€ ä¸ªäººä¸­å¿ƒ â”€â”€                                      */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .profile-nav-btn {
            display: flex;
            align-items: center;
            gap: 0.875rem;
            width: 100%;
            text-align: left;
            padding: 0.75rem 1rem;
            border-radius: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #64748b;
            font-weight: 600;
            font-size: 0.875rem;
            background: transparent;
            border: none;
        }
        .profile-nav-btn:hover { background: rgba(255,255,255,0.05); color: #94a3b8; }
        .profile-nav-btn.active { background: rgba(99,102,241,0.15); color: #818cf8; }

        .stat-card {
            background: rgba(255,255,255,0.025);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 1.5rem;
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 16px 40px rgba(0,0,0,0.3); }

        .history-card {
            background: rgba(255,255,255,0.025);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 1.25rem;
            padding: 1.1rem 1.4rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.2s;
        }
        .history-card:hover { border-color: rgba(99,102,241,0.35); background: rgba(99,102,241,0.05); }

        .avatar-circle {
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            flex-shrink: 0;
        }

        .toggle-track {
            width: 44px; height: 24px;
            border-radius: 12px;
            background: rgba(255,255,255,0.08);
            position: relative;
            cursor: pointer;
            transition: background 0.25s;
            flex-shrink: 0;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .toggle-track.on { background: #6366f1; border-color: #6366f1; }
        .toggle-knob {
            position: absolute;
            width: 18px; height: 18px;
            border-radius: 50%;
            background: white;
            top: 2px; left: 2px;
            transition: transform 0.25s cubic-bezier(0.4,0,0.2,1);
            box-shadow: 0 1px 4px rgba(0,0,0,0.4);
        }
        .toggle-track.on .toggle-knob { transform: translateX(20px); }

        .plan-badge-free { background: rgba(100,116,139,0.2); color: #94a3b8; border: 1px solid rgba(100,116,139,0.3); border-radius: 999px; }
        .plan-badge-pro  { background: rgba(251,191,36,0.15);  color: #fbbf24; border: 1px solid rgba(251,191,36,0.3);  border-radius: 999px; }
        .plan-badge-team { background: rgba(99,102,241,0.15);  color: #818cf8; border: 1px solid rgba(99,102,241,0.3);  border-radius: 999px; }

        .user-avatar-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0.75rem 0.35rem 0.35rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.09);
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .user-avatar-btn:hover { background: rgba(255,255,255,0.09); border-color: rgba(255,255,255,0.15); }

        @keyframes modalIn {
            from { opacity: 0; transform: translateY(20px) scale(0.97); }
            to   { opacity: 1; transform: translateY(0) scale(1); }
        }
        .modal-in { animation: modalIn 0.35s cubic-bezier(0.16,1,0.3,1) forwards; }

        .security-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.1rem 1.4rem;
            border-radius: 1rem;
            background: rgba(255,255,255,0.025);
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* â”€â”€ åˆåŒå†å² Risk pill â”€â”€ */
        .risk-pill {
            display: inline-flex;
            align-items: center;
            padding: 0.2rem 0.65rem;
            border-radius: 999px;
            font-size: 0.7rem;
            font-weight: 800;
            letter-spacing: 0.03em;
        }
    </style>
</head>

<body>
    <!-- åŠ¨æ€èƒŒæ™¯è£…é¥° -->
    <div class="bg-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <div id="root" style="position:relative;z-index:2;"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // ==================== å…¨å±€é…ç½® ====================
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        const API_BASE_URL     = "http://localhost:5000";
        const MAX_CHARACTERS   = 8000;   // æé«˜ä¸Šé™ä»¥æ”¯æŒæ›´å¤šæ–‡ä»¶å†…å®¹
        const FILE_MAX_CHARS   = 8000;   // æ–‡ä»¶å†…å®¹ä¸Šé™
        const MIN_CHARACTERS   = 100;

        // JWT å­˜å‚¨é”®å
        const _ACCESS_KEY  = 'cc_access_token';
        const _REFRESH_KEY = 'cc_refresh_token';

        const getAccessToken  = () => localStorage.getItem(_ACCESS_KEY)  || '';
        const getRefreshToken = () => localStorage.getItem(_REFRESH_KEY) || '';
        const setTokens = (access, refresh) => {
            localStorage.setItem(_ACCESS_KEY,  access);
            if (refresh) localStorage.setItem(_REFRESH_KEY, refresh);
        };
        const clearTokens = () => {
            localStorage.removeItem(_ACCESS_KEY);
            localStorage.removeItem(_REFRESH_KEY);
        };

        // å°è£… fetchï¼Œè‡ªåŠ¨é™„åŠ  Bearer tokenï¼Œå¤„ç† 401 è‡ªåŠ¨åˆ·æ–°
        let _refreshPromise = null; // é˜²æ­¢å¹¶å‘åˆ·æ–°
        const authFetch = async (url, options = {}) => {
            const makeHeaders = () => ({
                'Content-Type': 'application/json',
                'bypass-tunnel-reminder': 'true',
                'ngrok-skip-browser-warning': 'true',
                ...(options.headers || {}),
                ...(getAccessToken() ? { 'Authorization': 'Bearer ' + getAccessToken() } : {}),
            });
            let res = await fetch(API_BASE_URL + url, { ...options, headers: makeHeaders() });

            // access token è¿‡æœŸ â†’ å°è¯•ç”¨ refresh token æ¢æ–°çš„
            if (res.status === 401) {
                const body = await res.clone().json().catch(() => ({}));
                if (body.error === 'token_expired' && getRefreshToken()) {
                    if (!_refreshPromise) {
                        _refreshPromise = fetch(API_BASE_URL + '/auth/refresh', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json', 'bypass-tunnel-reminder': 'true' },
                            body: JSON.stringify({ refresh_token: getRefreshToken() }),
                        }).then(async r => {
                            _refreshPromise = null;
                            if (!r.ok) { clearTokens(); return null; }
                            const d = await r.json();
                            setTokens(d.access_token, d.refresh_token);
                            return d.access_token;
                        }).catch(() => { _refreshPromise = null; clearTokens(); return null; });
                    }
                    const newToken = await _refreshPromise;
                    if (newToken) {
                        // ç”¨æ–° token é‡è¯•åŸè¯·æ±‚
                        res = await fetch(API_BASE_URL + url, { ...options, headers: makeHeaders() });
                    }
                }
            }
            return res;
        };

        // ä¾¿æ·æ–¹æ³•
        const apiGet    = (url)         => authFetch(url, { method: 'GET' });
        const apiPost   = (url, body)   => authFetch(url, { method: 'POST',   body: JSON.stringify(body)  });
        const apiPut    = (url, body)   => authFetch(url, { method: 'PUT',    body: JSON.stringify(body)  });
        const apiDelete = (url, body)   => authFetch(url, { method: 'DELETE', body: body ? JSON.stringify(body) : undefined });

        // å¯åŠ¨æ—¶ä»æœåŠ¡ç«¯éªŒè¯ token å¹¶åŠ è½½ç”¨æˆ·ï¼ˆè¿”å› null è¡¨ç¤ºæœªç™»å½•/token æ— æ•ˆï¼‰
        const fetchCurrentUser = async () => {
            if (!getAccessToken()) return null;
            try {
                const res = await apiGet('/auth/me');
                if (!res.ok) { clearTokens(); return null; }
                return await res.json();
            } catch { return null; }
        };

        // ==================== è¯­è¨€é…ç½® ====================
        const LANGUAGES = [
            { code: 'zh-CN', label: 'ğŸ‡¨ğŸ‡³ ç®€ä½“ä¸­æ–‡' },
            { code: 'zh-TW', label: 'ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡' },
            { code: 'en',    label: 'ğŸ‡¬ğŸ‡§ English' },
            { code: 'ja',    label: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª' },
            { code: 'ko',    label: 'ğŸ‡°ğŸ‡· í•œêµ­ì–´' },
            { code: 'fr',    label: 'ğŸ‡«ğŸ‡· FranÃ§ais' },
            { code: 'de',    label: 'ğŸ‡©ğŸ‡ª Deutsch' },
            { code: 'es',    label: 'ğŸ‡ªğŸ‡¸ EspaÃ±ol' },
            { code: 'pt',    label: 'ğŸ‡§ğŸ‡· PortuguÃªs' },
            { code: 'ar',    label: 'ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' },
            { code: 'ru',    label: 'ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹' },
        ];

        // ==================== å¤šè¯­è¨€ UI å­—å…¸ ====================
        const UI_STRINGS = {
          'zh-CN': {
            subtitle: 'ä¸“å®¶çº§ AI åˆåŒå®¡æŸ¥', subtitle2: 'å®æ—¶æ³•å¾‹åº“æ£€ç´¢', subtitle3: 'æ·±åº¦è°ˆåˆ¤åšå¼ˆ',
            step1_heading: 'è¯·é€‰æ‹©æ‚¨æƒ³è¦å®¡æŸ¥çš„åˆåŒç±»å‹',
            step1_desc: 'ç²¾å‡†çš„ç±»å‹é€‰æ‹©å°†åŒ¹é…æ›´ä¸“ä¸šçš„æ³•å¾‹åº“ç´¢å¼•',
            expand_all: 'å±•å¼€å…¨éƒ¨ç»†èŠ‚', collapse_all: 'éšè—å…¨éƒ¨ç»†èŠ‚',
            back_btn: 'è¿”å›é‡é€‰ç±»å‹', current_type: 'å½“å‰ç±»å‹ï¼š',
            upload_title: 'ä¸Šä¼ åˆåŒæ–‡æ¡£', upload_formats: 'PDF Â· Word Â· å›¾ç‰‡ Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ å›¾ç‰‡è‡ªåŠ¨ OCR + AI ä¼˜åŒ–',
            upload_max: n => `ğŸ“ æœ€å¤§ ${n.toLocaleString()} å­—ç¬¦`,
            or_paste: 'æˆ–è€…ç›´æ¥ç²˜è´´æ–‡æœ¬', textarea_placeholder: 'åœ¨æ­¤ç²˜è´´åˆåŒæ–‡æœ¬...',
            min_chars: n => `æœ€å°‘ ${n} å­—`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` ï¼ˆè¿˜éœ€ ${n} å­—ï¼‰`, chars_over: ' âš  è¶…å‡ºä¸Šé™', chars_ok: ' âœ“ å¯ä»¥æäº¤',
            start_review: 'ğŸ” å¼€å§‹ä¸“å®¶å®¡æŸ¥', input_first: 'è¯·å…ˆè¾“å…¥åˆåŒå†…å®¹',
            analyzing_subtitle: 'AI ä¸“å®¶å®¡æŸ¥é€šå¸¸éœ€è¦ 3-5 åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…',
            ocr_processing: 'ğŸ¤– AI æ­£åœ¨ä¼˜åŒ– OCR æ–‡æœ¬è´¨é‡...', ocr_done: 'âœ… OCR ä¼˜åŒ–å®Œæˆ',
            cancel_btn: 'å–æ¶ˆå®¡æŸ¥',
            stages: ['æ–‡æ¡£è§£æ', 'é£é™©å®¡æŸ¥', 'è°ˆåˆ¤ç­–ç•¥', 'ä¿®è®¢åˆåŒ', 'æ•´åˆæŠ¥å‘Š'],
            tab_overview: 'é˜…è¯»åŸæ–‡', tab_risks: 'é£é™©è§£æ', tab_negotiation: 'åšå¼ˆç­–ç•¥', tab_revised: 'å®Œæ•´ä¿®è®¢',
            risk_dist: 'é£é™©åˆ†å¸ƒ', core_threats: n => `æ ¸å¿ƒå¨èƒ (${n})`,
            original_clause: 'åŸæ–‡è¡¨è¿°', legal_basis: 'æ³•å¾‹ä¾æ®', problem_title: 'é—®é¢˜å‰–æ',
            action_title: 'è¡ŒåŠ¨å¯¹ç­–', revision_suggestion: 'é˜²å¾¡æ€§æ¡æ¬¾ä¿®è®¢å»ºè®®', plain_explanation: 'é€šä¿—è§£é‡Š',
            game_overview: 'åšå¼ˆå…¨å±€è§‚', call_script: 'ç”µè¯é¢è°ˆè„šæœ¬',
            opening_label: 'å¼€åœº Opening', key_reasons_label: 'æ ¸å¿ƒç†ç”± Key Reasons',
            style_strategies: 'å¤šé£æ ¼è°ˆåˆ¤ç­–ç•¥',
            copy_btn: 'å¤åˆ¶', copied_btn: 'âœ“ å·²å¤åˆ¶', copy_full: 'å¤åˆ¶å…¨æ–‡', copy_full2: 'å¤åˆ¶å…¨æ–‡',
            email_section: 'ä¹¦é¢æ²Ÿé€šé‚®ä»¶',
            revised_title: 'å®Œæ•´ä¿®è®¢åˆåŒ',
            revised_desc: 'å·²æ ¹æ®æ‰€æœ‰é£é™©ç‚¹ç”Ÿæˆä¿®è®¢ç‰ˆåˆåŒï¼Œä¿®è®¢å¤„ä»¥ã€ä¿®è®¢ã€‘æ ‡è®°ã€‚',
            revised_full_tab: 'ä¿®è®¢åˆåŒå…¨æ–‡',
            revision_notes: n => `ä¿®è®¢è¯´æ˜ (${n} å¤„)`,
            download_txt: 'ä¸‹è½½ .txt', no_revision: 'ä¿®è®¢åˆåŒå†…å®¹ç”Ÿæˆä¸­æˆ–æš‚ä¸å¯ç”¨ã€‚',
            revision_item_label: i => `ä¿®è®¢ ${i + 1}`,
            overall_risk: 'æ€»ä½“é£é™©', risk_clauses_label: 'é£é™©æ¡æ¬¾',
            export_report: 'å¯¼å‡ºæŠ¥å‘Š', restart_btn: 'å®¡æŸ¥æ–°åˆåŒ',
            quick_nav_call: 'ç”µè¯é¢è°ˆè„šæœ¬', quick_nav_email: 'ä¹¦é¢æ²Ÿé€šé‚®ä»¶',
            style_aggressive: 'å¼ºç¡¬ Aggressive', style_consultative: 'åå•† Consultative', style_compromise: 'å¦¥å Compromise',
            risk_lv: { xh: 'æé«˜é£é™©', h: 'é«˜é£é™©', m: 'ä¸­ç­‰é£é™©', l: 'ä½é£é™©', s: 'å®‰å…¨' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'åŠ³åŠ¨ç”¨å·¥ç±»','æˆ¿äº§ç‰©ä¸šç±»':'æˆ¿äº§ç‰©ä¸šç±»','æ¶ˆè´¹æœåŠ¡ç±»':'æ¶ˆè´¹æœåŠ¡ç±»','é‡‘èå€Ÿè´·ç±»':'é‡‘èå€Ÿè´·ç±»','ç½‘ç»œæ•°å­—ç±»':'ç½‘ç»œæ•°å­—ç±»','å©šå§»å®¶åº­ç±»':'å©šå§»å®¶åº­ç±»','ç»è¥åˆä½œç±»':'ç»è¥åˆä½œç±»','å…¶ä»–ç±»':'å…¶ä»–ç±»' },
          },
          'zh-TW': {
            subtitle: 'å°ˆå®¶ç´š AI åˆç´„å¯©æŸ¥', subtitle2: 'å³æ™‚æ³•å¾‹åº«æª¢ç´¢', subtitle3: 'æ·±åº¦è«‡åˆ¤åšå¼ˆ',
            step1_heading: 'è«‹é¸æ“‡æ‚¨æƒ³è¦å¯©æŸ¥çš„åˆç´„é¡å‹',
            step1_desc: 'ç²¾æº–çš„é¡å‹é¸æ“‡å°‡åŒ¹é…æ›´å°ˆæ¥­çš„æ³•å¾‹åº«ç´¢å¼•',
            expand_all: 'å±•é–‹å…¨éƒ¨ç´°ç¯€', collapse_all: 'éš±è—å…¨éƒ¨ç´°ç¯€',
            back_btn: 'è¿”å›é‡é¸é¡å‹', current_type: 'ç•¶å‰é¡å‹ï¼š',
            upload_title: 'ä¸Šå‚³åˆç´„æ–‡ä»¶', upload_formats: 'PDF Â· Word Â· åœ–ç‰‡ Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ åœ–ç‰‡è‡ªå‹• OCR + AI å„ªåŒ–',
            upload_max: n => `ğŸ“ æœ€å¤§ ${n.toLocaleString()} å­—å…ƒ`,
            or_paste: 'æˆ–è€…ç›´æ¥è²¼ä¸Šæ–‡å­—', textarea_placeholder: 'åœ¨æ­¤è²¼ä¸Šåˆç´„æ–‡å­—...',
            min_chars: n => `æœ€å°‘ ${n} å­—`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` ï¼ˆé‚„éœ€ ${n} å­—ï¼‰`, chars_over: ' âš  è¶…å‡ºä¸Šé™', chars_ok: ' âœ“ å¯ä»¥æäº¤',
            start_review: 'ğŸ” é–‹å§‹å°ˆå®¶å¯©æŸ¥', input_first: 'è«‹å…ˆè¼¸å…¥åˆç´„å…§å®¹',
            analyzing_subtitle: 'AI å°ˆå®¶å¯©æŸ¥é€šå¸¸éœ€è¦ 3-5 åˆ†é˜ï¼Œè«‹è€å¿ƒç­‰å¾…',
            ocr_processing: 'ğŸ¤– AI æ­£åœ¨å„ªåŒ– OCR æ–‡å­—å“è³ª...', ocr_done: 'âœ… OCR å„ªåŒ–å®Œæˆ',
            cancel_btn: 'å–æ¶ˆå¯©æŸ¥',
            stages: ['æ–‡ä»¶è§£æ', 'é¢¨éšªå¯©æŸ¥', 'è«‡åˆ¤ç­–ç•¥', 'ä¿®è¨‚åˆç´„', 'æ•´åˆå ±å‘Š'],
            tab_overview: 'é–±è®€åŸæ–‡', tab_risks: 'é¢¨éšªè§£æ', tab_negotiation: 'åšå¼ˆç­–ç•¥', tab_revised: 'å®Œæ•´ä¿®è¨‚',
            risk_dist: 'é¢¨éšªåˆ†ä½ˆ', core_threats: n => `æ ¸å¿ƒå¨è„… (${n})`,
            original_clause: 'åŸæ–‡è¡¨è¿°', legal_basis: 'æ³•å¾‹ä¾æ“š', problem_title: 'å•é¡Œå‰–æ',
            action_title: 'è¡Œå‹•å°ç­–', revision_suggestion: 'é˜²ç¦¦æ€§æ¢æ¬¾ä¿®è¨‚å»ºè­°', plain_explanation: 'é€šä¿—è§£é‡‹',
            game_overview: 'åšå¼ˆå…¨å±€è§€', call_script: 'é›»è©±é¢è«‡è…³æœ¬',
            opening_label: 'é–‹å ´ Opening', key_reasons_label: 'æ ¸å¿ƒç†ç”± Key Reasons',
            style_strategies: 'å¤šé¢¨æ ¼è«‡åˆ¤ç­–ç•¥',
            copy_btn: 'è¤‡è£½', copied_btn: 'âœ“ å·²è¤‡è£½', copy_full: 'è¤‡è£½å…¨æ–‡', copy_full2: 'è¤‡è£½å…¨æ–‡',
            email_section: 'æ›¸é¢æºé€šéƒµä»¶',
            revised_title: 'å®Œæ•´ä¿®è¨‚åˆç´„',
            revised_desc: 'å·²æ ¹æ“šæ‰€æœ‰é¢¨éšªé»ç”Ÿæˆä¿®è¨‚ç‰ˆåˆç´„ï¼Œä¿®è¨‚è™•ä»¥ã€ä¿®è¨‚ã€‘æ¨™è¨˜ã€‚',
            revised_full_tab: 'ä¿®è¨‚åˆç´„å…¨æ–‡',
            revision_notes: n => `ä¿®è¨‚èªªæ˜ (${n} è™•)`,
            download_txt: 'ä¸‹è¼‰ .txt', no_revision: 'ä¿®è¨‚åˆç´„å…§å®¹ç”Ÿæˆä¸­æˆ–æš«ä¸å¯ç”¨ã€‚',
            revision_item_label: i => `ä¿®è¨‚ ${i + 1}`,
            overall_risk: 'æ•´é«”é¢¨éšª', risk_clauses_label: 'é¢¨éšªæ¢æ¬¾',
            export_report: 'åŒ¯å‡ºå ±å‘Š', restart_btn: 'å¯©æŸ¥æ–°åˆç´„',
            quick_nav_call: 'é›»è©±é¢è«‡è…³æœ¬', quick_nav_email: 'æ›¸é¢æºé€šéƒµä»¶',
            style_aggressive: 'å¼·ç¡¬ Aggressive', style_consultative: 'å”å•† Consultative', style_compromise: 'å¦¥å” Compromise',
            risk_lv: { xh: 'æ¥µé«˜é¢¨éšª', h: 'é«˜é¢¨éšª', m: 'ä¸­ç­‰é¢¨éšª', l: 'ä½é¢¨éšª', s: 'å®‰å…¨' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'å‹å‹•ç”¨å·¥é¡','æˆ¿äº§ç‰©ä¸šç±»':'æˆ¿ç”¢ç‰©æ¥­é¡','æ¶ˆè´¹æœåŠ¡ç±»':'æ¶ˆè²»æœå‹™é¡','é‡‘èå€Ÿè´·ç±»':'é‡‘èå€Ÿè²¸é¡','ç½‘ç»œæ•°å­—ç±»':'ç¶²è·¯æ•¸ä½é¡','å©šå§»å®¶åº­ç±»':'å©šå§»å®¶åº­é¡','ç»è¥åˆä½œç±»':'ç¶“ç‡Ÿåˆä½œé¡','å…¶ä»–ç±»':'å…¶ä»–é¡' },
          },
          'en': {
            subtitle: 'Expert AI Contract Review', subtitle2: 'Real-time Legal DB Search', subtitle3: 'Deep Negotiation Strategy',
            step1_heading: 'Select Contract Type',
            step1_desc: 'The right category matches a more specialized legal database',
            expand_all: 'Expand All Details', collapse_all: 'Collapse All Details',
            back_btn: 'â† Back to Categories', current_type: 'Type: ',
            upload_title: 'Upload Contract Document', upload_formats: 'PDF Â· Word Â· Image Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ Auto OCR + AI Enhancement',
            upload_max: n => `ğŸ“ Max ${n.toLocaleString()} chars`,
            or_paste: 'Or paste text directly', textarea_placeholder: 'Paste contract text here...',
            min_chars: n => `Min ${n} chars`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` (need ${n} more)`, chars_over: ' âš  Over limit', chars_ok: ' âœ“ Ready',
            start_review: 'ğŸ” Start Expert Review', input_first: 'Please enter contract text first',
            analyzing_subtitle: 'Expert AI review takes about 3-5 minutes, please wait',
            ocr_processing: 'ğŸ¤– AI is enhancing OCR text quality...', ocr_done: 'âœ… OCR Enhancement Complete',
            cancel_btn: 'Cancel Review',
            stages: ['Parse Doc', 'Risk Review', 'Negotiation', 'Revision', 'Compile'],
            tab_overview: 'View Contract', tab_risks: 'Risk Analysis', tab_negotiation: 'Strategy', tab_revised: 'Revised Contract',
            risk_dist: 'Risk Distribution', core_threats: n => `Key Risks (${n})`,
            original_clause: 'Original Clause', legal_basis: 'Legal Basis', problem_title: 'Problem Analysis',
            action_title: 'Action Items', revision_suggestion: 'Suggested Defensive Wording', plain_explanation: 'Plain Language',
            game_overview: 'Negotiation Overview', call_script: 'Phone Call Script',
            opening_label: 'Opening', key_reasons_label: 'Key Reasons',
            style_strategies: 'Multi-Style Negotiation Strategies',
            copy_btn: 'Copy', copied_btn: 'âœ“ Copied', copy_full: 'Copy All', copy_full2: 'Copy All',
            email_section: 'Written Communication Email',
            revised_title: 'Full Revised Contract',
            revised_desc: 'A revised contract has been generated based on all identified risks. Changes are marked with [REVISED].',
            revised_full_tab: 'Revised Contract Text',
            revision_notes: n => `Revision Notes (${n})`,
            download_txt: 'Download .txt', no_revision: 'Revised contract is being generated or unavailable.',
            revision_item_label: i => `Revision ${i + 1}`,
            overall_risk: 'Overall Risk', risk_clauses_label: 'Risk Clauses',
            export_report: 'Export Report', restart_btn: 'Review New Contract',
            quick_nav_call: 'Phone Call Script', quick_nav_email: 'Written Email',
            style_aggressive: 'Aggressive', style_consultative: 'Consultative', style_compromise: 'Compromise',
            risk_lv: { xh: 'Critical Risk', h: 'High Risk', m: 'Medium Risk', l: 'Low Risk', s: 'Safe' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'Employment','æˆ¿äº§ç‰©ä¸šç±»':'Real Estate','æ¶ˆè´¹æœåŠ¡ç±»':'Consumer Services','é‡‘èå€Ÿè´·ç±»':'Finance & Loans','ç½‘ç»œæ•°å­—ç±»':'Digital & Internet','å©šå§»å®¶åº­ç±»':'Family & Marriage','ç»è¥åˆä½œç±»':'Business Partnership','å…¶ä»–ç±»':'Other' },
          },
          'ja': {
            subtitle: 'AI å°‚é–€å®¶ã«ã‚ˆã‚‹å¥‘ç´„ãƒ¬ãƒ“ãƒ¥ãƒ¼', subtitle2: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ³•å¾‹DBã‚µãƒ¼ãƒ', subtitle3: 'æ·±åº¦äº¤æ¸‰æˆ¦ç•¥',
            step1_heading: 'ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹å¥‘ç´„ã®ç¨®é¡ã‚’é¸æŠã—ã¦ãã ã•ã„',
            step1_desc: 'æ­£ç¢ºãªã‚«ãƒ†ã‚´ãƒªé¸æŠã«ã‚ˆã‚Šã€ã‚ˆã‚Šå°‚é–€çš„ãªæ³•å¾‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾å¿œã—ã¾ã™',
            expand_all: 'è©³ç´°ã‚’ã™ã¹ã¦å±•é–‹', collapse_all: 'è©³ç´°ã‚’ã™ã¹ã¦æŠ˜ã‚ŠãŸãŸã‚€',
            back_btn: 'â† ã‚«ãƒ†ã‚´ãƒªé¸æŠã«æˆ»ã‚‹', current_type: 'ç¨®é¡ï¼š',
            upload_title: 'å¥‘ç´„æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰', upload_formats: 'PDF Â· Word Â· ç”»åƒ Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ è‡ªå‹• OCR + AI æœ€é©åŒ–',
            upload_max: n => `ğŸ“ æœ€å¤§ ${n.toLocaleString()} æ–‡å­—`,
            or_paste: 'ã¾ãŸã¯ãƒ†ã‚­ã‚¹ãƒˆã‚’ç›´æ¥è²¼ã‚Šä»˜ã‘', textarea_placeholder: 'ã“ã“ã«å¥‘ç´„æ–‡ã‚’è²¼ã‚Šä»˜ã‘...',
            min_chars: n => `æœ€ä½ ${n} æ–‡å­—`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` (ã‚ã¨ ${n} æ–‡å­—å¿…è¦)`, chars_over: ' âš  ä¸Šé™è¶…é', chars_ok: ' âœ“ é€ä¿¡å¯èƒ½',
            start_review: 'ğŸ” å°‚é–€å®¶ãƒ¬ãƒ“ãƒ¥ãƒ¼é–‹å§‹', input_first: 'å¥‘ç´„å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
            analyzing_subtitle: 'AI å°‚é–€å®¶ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã¯ç´„ 3ã€œ5 åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„',
            ocr_processing: 'ğŸ¤– AI ãŒ OCR ãƒ†ã‚­ã‚¹ãƒˆã‚’æœ€é©åŒ–ä¸­...', ocr_done: 'âœ… OCR æœ€é©åŒ–å®Œäº†',
            cancel_btn: 'ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
            stages: ['æ–‡æ›¸è§£æ', 'ãƒªã‚¹ã‚¯å¯©æŸ»', 'äº¤æ¸‰æˆ¦ç•¥', 'ä¿®æ­£å¥‘ç´„', 'ã¾ã¨ã‚'],
            tab_overview: 'åŸæ–‡ã‚’èª­ã‚€', tab_risks: 'ãƒªã‚¹ã‚¯åˆ†æ', tab_negotiation: 'äº¤æ¸‰æˆ¦ç•¥', tab_revised: 'ä¿®æ­£ç‰ˆå¥‘ç´„',
            risk_dist: 'ãƒªã‚¹ã‚¯åˆ†å¸ƒ', core_threats: n => `ä¸»è¦ãƒªã‚¹ã‚¯ (${n})`,
            original_clause: 'åŸæ–‡æ¡é …', legal_basis: 'æ³•çš„æ ¹æ‹ ', problem_title: 'å•é¡Œåˆ†æ',
            action_title: 'å¯¾å¿œç­–', revision_suggestion: 'é˜²è¡›çš„æ¡é …ä¿®æ­£æ¡ˆ', plain_explanation: 'ã‚ã‹ã‚Šã‚„ã™ã„è§£èª¬',
            game_overview: 'äº¤æ¸‰ã®å…¨ä½“è¦³', call_script: 'é›»è©±äº¤æ¸‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ',
            opening_label: 'é–‹å ´', key_reasons_label: 'ä¸»ãªç†ç”±',
            style_strategies: 'ãƒãƒ«ãƒã‚¹ã‚¿ã‚¤ãƒ«äº¤æ¸‰æˆ¦ç•¥',
            copy_btn: 'ã‚³ãƒ”ãƒ¼', copied_btn: 'âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆ', copy_full: 'å…¨æ–‡ã‚³ãƒ”ãƒ¼', copy_full2: 'å…¨æ–‡ã‚³ãƒ”ãƒ¼',
            email_section: 'æ›¸é¢ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ¼ãƒ«',
            revised_title: 'ä¿®æ­£ç‰ˆå¥‘ç´„æ›¸ï¼ˆå…¨æ–‡ï¼‰',
            revised_desc: 'ç‰¹å®šã•ã‚ŒãŸã™ã¹ã¦ã®ãƒªã‚¹ã‚¯ã«åŸºã¥ã„ã¦ä¿®æ­£ç‰ˆå¥‘ç´„ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚å¤‰æ›´ç®‡æ‰€ã¯ã€ä¿®è¨‚ã€‘ã§ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚',
            revised_full_tab: 'ä¿®æ­£å¥‘ç´„å…¨æ–‡',
            revision_notes: n => `ä¿®æ­£ãƒ¡ãƒ¢ (${n} ç®‡æ‰€)`,
            download_txt: '.txt ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰', no_revision: 'ä¿®æ­£ç‰ˆå¥‘ç´„ã®ç”Ÿæˆä¸­ã¾ãŸã¯åˆ©ç”¨ä¸å¯ã€‚',
            revision_item_label: i => `ä¿®æ­£ ${i + 1}`,
            overall_risk: 'ç·åˆãƒªã‚¹ã‚¯', risk_clauses_label: 'ãƒªã‚¹ã‚¯æ¡é …',
            export_report: 'ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›', restart_btn: 'æ–°ã—ã„å¥‘ç´„ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼',
            quick_nav_call: 'é›»è©±ã‚¹ã‚¯ãƒªãƒ—ãƒˆ', quick_nav_email: 'ãƒ¡ãƒ¼ãƒ«è‰ç¨¿',
            style_aggressive: 'å¼·ç¡¬ã‚¹ã‚¿ã‚¤ãƒ«', style_consultative: 'å”è­°ã‚¹ã‚¿ã‚¤ãƒ«', style_compromise: 'å¦¥å”ã‚¹ã‚¿ã‚¤ãƒ«',
            risk_lv: { xh: 'è¶…é«˜ãƒªã‚¹ã‚¯', h: 'é«˜ãƒªã‚¹ã‚¯', m: 'ä¸­ãƒªã‚¹ã‚¯', l: 'ä½ãƒªã‚¹ã‚¯', s: 'å®‰å…¨' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'åŠ´åƒãƒ»é›‡ç”¨','æˆ¿äº§ç‰©ä¸šç±»':'ä¸å‹•ç”£','æ¶ˆè´¹æœåŠ¡ç±»':'æ¶ˆè²»è€…ã‚µãƒ¼ãƒ“ã‚¹','é‡‘èå€Ÿè´·ç±»':'é‡‘èãƒ»èè³‡','ç½‘ç»œæ•°å­—ç±»':'ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ»ãƒãƒƒãƒˆ','å©šå§»å®¶åº­ç±»':'å©šå§»ãƒ»å®¶æ—','ç»è¥åˆä½œç±»':'äº‹æ¥­ææº','å…¶ä»–ç±»':'ãã®ä»–' },
          },
          'ko': {
            subtitle: 'AI ì „ë¬¸ê°€ ê³„ì•½ì„œ ê²€í† ', subtitle2: 'ì‹¤ì‹œê°„ ë²•ë¥  DB ê²€ìƒ‰', subtitle3: 'ì‹¬ì¸µ í˜‘ìƒ ì „ëµ',
            step1_heading: 'ê²€í† í•  ê³„ì•½ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”',
            step1_desc: 'ì •í™•í•œ ìœ í˜• ì„ íƒì€ ë” ì „ë¬¸ì ì¸ ë²•ë¥  ë°ì´í„°ë² ì´ìŠ¤ì™€ ë§¤ì¹­ë©ë‹ˆë‹¤',
            expand_all: 'ëª¨ë‘ í¼ì¹˜ê¸°', collapse_all: 'ëª¨ë‘ ì ‘ê¸°',
            back_btn: 'â† ìœ í˜• ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°', current_type: 'ìœ í˜•ï¼š',
            upload_title: 'ê³„ì•½ì„œ ì—…ë¡œë“œ', upload_formats: 'PDF Â· Word Â· ì´ë¯¸ì§€ Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ ìë™ OCR + AI ìµœì í™”',
            upload_max: n => `ğŸ“ ìµœëŒ€ ${n.toLocaleString()} ì`,
            or_paste: 'ë˜ëŠ” í…ìŠ¤íŠ¸ ì§ì ‘ ë¶™ì—¬ë„£ê¸°', textarea_placeholder: 'ì—¬ê¸°ì— ê³„ì•½ì„œ í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...',
            min_chars: n => `ìµœì†Œ ${n} ì`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` (${n} ì ë” í•„ìš”)`, chars_over: ' âš  í•œë„ ì´ˆê³¼', chars_ok: ' âœ“ ì œì¶œ ê°€ëŠ¥',
            start_review: 'ğŸ” ì „ë¬¸ê°€ ê²€í†  ì‹œì‘', input_first: 'ê³„ì•½ì„œ ë‚´ìš©ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”',
            analyzing_subtitle: 'AI ì „ë¬¸ê°€ ê²€í† ëŠ” ë³´í†µ 3~5ë¶„ ì†Œìš”ë©ë‹ˆë‹¤. ì ì‹œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”',
            ocr_processing: 'ğŸ¤– AIê°€ OCR í…ìŠ¤íŠ¸ í’ˆì§ˆì„ ìµœì í™” ì¤‘...', ocr_done: 'âœ… OCR ìµœì í™” ì™„ë£Œ',
            cancel_btn: 'ê²€í†  ì·¨ì†Œ',
            stages: ['ë¬¸ì„œ íŒŒì‹±', 'ìœ„í—˜ ê²€í† ', 'í˜‘ìƒ ì „ëµ', 'ìˆ˜ì • ê³„ì•½', 'ë³´ê³ ì„œ ì •ë¦¬'],
            tab_overview: 'ì›ë¬¸ ë³´ê¸°', tab_risks: 'ìœ„í—˜ ë¶„ì„', tab_negotiation: 'í˜‘ìƒ ì „ëµ', tab_revised: 'ìˆ˜ì • ê³„ì•½ì„œ',
            risk_dist: 'ìœ„í—˜ ë¶„í¬', core_threats: n => `í•µì‹¬ ìœ„í—˜ (${n})`,
            original_clause: 'ì›ë¬¸ ì¡°í•­', legal_basis: 'ë²•ì  ê·¼ê±°', problem_title: 'ë¬¸ì œ ë¶„ì„',
            action_title: 'ëŒ€ì‘ ë°©ì•ˆ', revision_suggestion: 'ë°©ì–´ì  ì¡°í•­ ìˆ˜ì • ì œì•ˆ', plain_explanation: 'ì‰¬ìš´ ì„¤ëª…',
            game_overview: 'í˜‘ìƒ ì „ì²´ ê´€ì ', call_script: 'ì „í™” í˜‘ìƒ ìŠ¤í¬ë¦½íŠ¸',
            opening_label: 'ì˜¤í”„ë‹', key_reasons_label: 'í•µì‹¬ ì´ìœ ',
            style_strategies: 'ë‹¤ì–‘í•œ í˜‘ìƒ ìŠ¤íƒ€ì¼ ì „ëµ',
            copy_btn: 'ë³µì‚¬', copied_btn: 'âœ“ ë³µì‚¬ë¨', copy_full: 'ì „ì²´ ë³µì‚¬', copy_full2: 'ì „ì²´ ë³µì‚¬',
            email_section: 'ì„œë©´ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ì´ë©”ì¼',
            revised_title: 'ì „ì²´ ìˆ˜ì • ê³„ì•½ì„œ',
            revised_desc: 'ëª¨ë“  ìœ„í—˜ í¬ì¸íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìˆ˜ì •ëœ ê³„ì•½ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ì • ì‚¬í•­ì€ ã€ä¿®è¨‚ã€‘ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.',
            revised_full_tab: 'ìˆ˜ì • ê³„ì•½ì„œ ì „ë¬¸',
            revision_notes: n => `ìˆ˜ì • ë©”ëª¨ (${n}ê±´)`,
            download_txt: '.txt ë‹¤ìš´ë¡œë“œ', no_revision: 'ìˆ˜ì • ê³„ì•½ì„œ ë‚´ìš©ì´ ìƒì„± ì¤‘ì´ê±°ë‚˜ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
            revision_item_label: i => `ìˆ˜ì • ${i + 1}`,
            overall_risk: 'ì „ì²´ ìœ„í—˜', risk_clauses_label: 'ìœ„í—˜ ì¡°í•­',
            export_report: 'ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°', restart_btn: 'ìƒˆ ê³„ì•½ì„œ ê²€í† ',
            quick_nav_call: 'ì „í™” ìŠ¤í¬ë¦½íŠ¸', quick_nav_email: 'ì´ë©”ì¼ ì´ˆì•ˆ',
            style_aggressive: 'ê°•ê²½ ìŠ¤íƒ€ì¼', style_consultative: 'í˜‘ì˜ ìŠ¤íƒ€ì¼', style_compromise: 'íƒ€í˜‘ ìŠ¤íƒ€ì¼',
            risk_lv: { xh: 'ì´ˆê³ ìœ„í—˜', h: 'ê³ ìœ„í—˜', m: 'ì¤‘ìœ„í—˜', l: 'ì €ìœ„í—˜', s: 'ì•ˆì „' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'ê³ ìš©Â·ë…¸ë™','æˆ¿äº§ç‰©ä¸šç±»':'ë¶€ë™ì‚°','æ¶ˆè´¹æœåŠ¡ç±»':'ì†Œë¹„ìì„œë¹„ìŠ¤','é‡‘èå€Ÿè´·ç±»':'ê¸ˆìœµÂ·ëŒ€ì¶œ','ç½‘ç»œæ•°å­—ç±»':'ë””ì§€í„¸Â·ì¸í„°ë„·','å©šå§»å®¶åº­ç±»':'í˜¼ì¸Â·ê°€ì¡±','ç»è¥åˆä½œç±»':'ì‚¬ì—…Â·íŒŒíŠ¸ë„ˆì‹­','å…¶ä»–ç±»':'ê¸°íƒ€' },
          },
          'fr': {
            subtitle: "RÃ©vision de contrat par IA experte", subtitle2: 'Recherche juridique en temps rÃ©el', subtitle3: 'StratÃ©gie de nÃ©gociation approfondie',
            step1_heading: 'SÃ©lectionnez le type de contrat Ã  rÃ©viser',
            step1_desc: 'Un type prÃ©cis permet de cibler une base de donnÃ©es juridique spÃ©cialisÃ©e',
            expand_all: 'DÃ©velopper tout', collapse_all: 'RÃ©duire tout',
            back_btn: 'â† Retour aux catÃ©gories', current_type: 'Type : ',
            upload_title: 'TÃ©lÃ©charger le contrat', upload_formats: 'PDF Â· Word Â· Image Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ OCR auto + amÃ©lioration IA',
            upload_max: n => `ğŸ“ Max ${n.toLocaleString()} caractÃ¨res`,
            or_paste: 'Ou coller le texte directement', textarea_placeholder: 'Collez le texte du contrat ici...',
            min_chars: n => `Min ${n} caractÃ¨res`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` (${n} caractÃ¨res manquants)`, chars_over: ' âš  Limite dÃ©passÃ©e', chars_ok: ' âœ“ PrÃªt Ã  soumettre',
            start_review: 'ğŸ” DÃ©marrer la rÃ©vision', input_first: 'Veuillez saisir le texte du contrat',
            analyzing_subtitle: "La rÃ©vision prend gÃ©nÃ©ralement 3 Ã  5 minutes, veuillez patienter",
            ocr_processing: "ğŸ¤– L'IA amÃ©liore la qualitÃ© OCR...", ocr_done: 'âœ… AmÃ©lioration OCR terminÃ©e',
            cancel_btn: 'Annuler',
            stages: ['Analyse doc.', 'Risques', 'NÃ©gociation', 'RÃ©vision', 'Compilation'],
            tab_overview: 'Lire le contrat', tab_risks: 'Analyse des risques', tab_negotiation: 'StratÃ©gie', tab_revised: 'Contrat rÃ©visÃ©',
            risk_dist: 'Distribution des risques', core_threats: n => `Risques clÃ©s (${n})`,
            original_clause: 'Clause originale', legal_basis: 'Base lÃ©gale', problem_title: "Analyse du problÃ¨me",
            action_title: "Plan d'action", revision_suggestion: 'Reformulation dÃ©fensive suggÃ©rÃ©e', plain_explanation: 'Explication simplifiÃ©e',
            game_overview: 'Vue globale de la nÃ©gociation', call_script: "Script d'appel tÃ©lÃ©phonique",
            opening_label: 'Ouverture', key_reasons_label: 'Arguments clÃ©s',
            style_strategies: 'StratÃ©gies de nÃ©gociation multi-styles',
            copy_btn: 'Copier', copied_btn: 'âœ“ CopiÃ©', copy_full: 'Tout copier', copy_full2: 'Tout copier',
            email_section: 'Email de communication Ã©crite',
            revised_title: 'Contrat rÃ©visÃ© complet',
            revised_desc: 'Un contrat rÃ©visÃ© a Ã©tÃ© gÃ©nÃ©rÃ© sur la base de tous les risques identifiÃ©s. Les modifications sont marquÃ©es [RÃ‰VISÃ‰].',
            revised_full_tab: 'Texte du contrat rÃ©visÃ©',
            revision_notes: n => `Notes de rÃ©vision (${n})`,
            download_txt: 'TÃ©lÃ©charger .txt', no_revision: 'Le contrat rÃ©visÃ© est en cours de gÃ©nÃ©ration ou indisponible.',
            revision_item_label: i => `RÃ©vision ${i + 1}`,
            overall_risk: 'Risque global', risk_clauses_label: 'Clauses Ã  risque',
            export_report: 'Exporter le rapport', restart_btn: 'RÃ©viser un nouveau contrat',
            quick_nav_call: 'Script tÃ©lÃ©phonique', quick_nav_email: 'Email',
            style_aggressive: 'Agressif', style_consultative: 'Consultatif', style_compromise: 'Compromis',
            risk_lv: { xh: 'Risque critique', h: 'Risque Ã©levÃ©', m: 'Risque moyen', l: 'Risque faible', s: 'SÃ»r' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'Travail & Emploi','æˆ¿äº§ç‰©ä¸šç±»':'Immobilier','æ¶ˆè´¹æœåŠ¡ç±»':'Services aux consommateurs','é‡‘èå€Ÿè´·ç±»':'Finance & PrÃªts','ç½‘ç»œæ•°å­—ç±»':'NumÃ©rique & Internet','å©šå§»å®¶åº­ç±»':'Famille & Mariage','ç»è¥åˆä½œç±»':'Partenariat commercial','å…¶ä»–ç±»':'Autres' },
          },
          'de': {
            subtitle: 'KI-ExpertenprÃ¼fung von VertrÃ¤gen', subtitle2: 'Echtzeit-Rechtsdatenbanksuche', subtitle3: 'Tiefgehende Verhandlungsstrategie',
            step1_heading: 'WÃ¤hlen Sie den Vertragstyp aus',
            step1_desc: 'Eine genaue Kategorieauswahl passt besser zur Rechtsdatenbank',
            expand_all: 'Alle Details ausklappen', collapse_all: 'Alle Details einklappen',
            back_btn: 'â† ZurÃ¼ck zur Auswahl', current_type: 'Typ: ',
            upload_title: 'Vertrag hochladen', upload_formats: 'PDF Â· Word Â· Bild Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ Auto-OCR + KI-Verbesserung',
            upload_max: n => `ğŸ“ Max. ${n.toLocaleString()} Zeichen`,
            or_paste: 'Oder Text direkt einfÃ¼gen', textarea_placeholder: 'Vertragstext hier einfÃ¼gen...',
            min_chars: n => `Min. ${n} Zeichen`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` (noch ${n} Zeichen)`, chars_over: ' âš  Limit Ã¼berschritten', chars_ok: ' âœ“ Bereit',
            start_review: 'ğŸ” ExpertenprÃ¼fung starten', input_first: 'Bitte Vertragstext eingeben',
            analyzing_subtitle: 'Die KI-ExpertenprÃ¼fung dauert ca. 3â€“5 Minuten, bitte warten',
            ocr_processing: 'ğŸ¤– KI verbessert OCR-TextqualitÃ¤t...', ocr_done: 'âœ… OCR-Verbesserung abgeschlossen',
            cancel_btn: 'PrÃ¼fung abbrechen',
            stages: ['Dok. Analyse', 'Risikop.', 'Verhandlung', 'Ãœberarbeitung', 'Bericht'],
            tab_overview: 'Vertrag lesen', tab_risks: 'Risikoanalyse', tab_negotiation: 'Strategie', tab_revised: 'Revidierter Vertrag',
            risk_dist: 'Risikoverteilung', core_threats: n => `Hauptrisiken (${n})`,
            original_clause: 'Originalklausel', legal_basis: 'Rechtsgrundlage', problem_title: 'Problemanalyse',
            action_title: 'MaÃŸnahmen', revision_suggestion: 'Defensiver Formulierungsvorschlag', plain_explanation: 'Einfache ErklÃ¤rung',
            game_overview: 'VerhandlungsÃ¼bersicht', call_script: 'Telefonskript',
            opening_label: 'ErÃ¶ffnung', key_reasons_label: 'Hauptargumente',
            style_strategies: 'Multi-Style-Verhandlungsstrategien',
            copy_btn: 'Kopieren', copied_btn: 'âœ“ Kopiert', copy_full: 'Alles kopieren', copy_full2: 'Alles kopieren',
            email_section: 'Schriftliche Kommunikations-E-Mail',
            revised_title: 'VollstÃ¤ndiger Ã¼berarbeiteter Vertrag',
            revised_desc: 'Ein Ã¼berarbeiteter Vertrag wurde auf Basis aller Risiken erstellt. Ã„nderungen sind mit [ÃœBERARBEITET] markiert.',
            revised_full_tab: 'Ãœberarbeiteter Vertragstext',
            revision_notes: n => `Ãœberarbeitungshinweise (${n})`,
            download_txt: '.txt herunterladen', no_revision: 'Ãœberarbeiteter Vertrag wird generiert oder ist nicht verfÃ¼gbar.',
            revision_item_label: i => `Ã„nderung ${i + 1}`,
            overall_risk: 'Gesamtrisiko', risk_clauses_label: 'Risikoklauseln',
            export_report: 'Bericht exportieren', restart_btn: 'Neuen Vertrag prÃ¼fen',
            quick_nav_call: 'Telefonskript', quick_nav_email: 'E-Mail',
            style_aggressive: 'Aggressiv', style_consultative: 'Konsultativ', style_compromise: 'Kompromiss',
            risk_lv: { xh: 'Kritisches Risiko', h: 'Hohes Risiko', m: 'Mittleres Risiko', l: 'Niedriges Risiko', s: 'Sicher' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'Arbeit & BeschÃ¤ftigung','æˆ¿äº§ç‰©ä¸šç±»':'Immobilien','æ¶ˆè´¹æœåŠ¡ç±»':'Verbraucherdienstleistungen','é‡‘èå€Ÿè´·ç±»':'Finanzen & Kredite','ç½‘ç»œæ•°å­—ç±»':'Digital & Internet','å©šå§»å®¶åº­ç±»':'Familie & Ehe','ç»è¥åˆä½œç±»':'GeschÃ¤ftspartnerschaft','å…¶ä»–ç±»':'Andere' },
          },
          'es': {
            subtitle: 'RevisiÃ³n de contratos con IA experta', subtitle2: 'BÃºsqueda jurÃ­dica en tiempo real', subtitle3: 'Estrategia de negociaciÃ³n profunda',
            step1_heading: 'Seleccione el tipo de contrato a revisar',
            step1_desc: 'Una selecciÃ³n precisa permite acceder a bases de datos jurÃ­dicas especializadas',
            expand_all: 'Expandir todo', collapse_all: 'Contraer todo',
            back_btn: 'â† Volver a categorÃ­as', current_type: 'Tipo: ',
            upload_title: 'Subir contrato', upload_formats: 'PDF Â· Word Â· Imagen Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ OCR automÃ¡tico + mejora IA',
            upload_max: n => `ğŸ“ MÃ¡x. ${n.toLocaleString()} caracteres`,
            or_paste: 'O pegar texto directamente', textarea_placeholder: 'Pegue el texto del contrato aquÃ­...',
            min_chars: n => `MÃ­n. ${n} caracteres`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` (faltan ${n} caracteres)`, chars_over: ' âš  LÃ­mite superado', chars_ok: ' âœ“ Listo',
            start_review: 'ğŸ” Iniciar revisiÃ³n experta', input_first: 'Por favor ingrese el texto del contrato',
            analyzing_subtitle: 'La revisiÃ³n experta suele tardar 3-5 minutos, por favor espere',
            ocr_processing: 'ğŸ¤– La IA estÃ¡ mejorando la calidad OCR...', ocr_done: 'âœ… Mejora OCR completada',
            cancel_btn: 'Cancelar revisiÃ³n',
            stages: ['AnÃ¡lisis doc.', 'Riesgos', 'NegociaciÃ³n', 'RevisiÃ³n', 'Informe'],
            tab_overview: 'Leer contrato', tab_risks: 'AnÃ¡lisis de riesgos', tab_negotiation: 'Estrategia', tab_revised: 'Contrato revisado',
            risk_dist: 'DistribuciÃ³n de riesgos', core_threats: n => `Riesgos clave (${n})`,
            original_clause: 'ClÃ¡usula original', legal_basis: 'Base legal', problem_title: 'AnÃ¡lisis del problema',
            action_title: 'Medidas', revision_suggestion: 'RedacciÃ³n defensiva sugerida', plain_explanation: 'ExplicaciÃ³n sencilla',
            game_overview: 'VisiÃ³n global de negociaciÃ³n', call_script: 'GuiÃ³n de llamada telefÃ³nica',
            opening_label: 'Apertura', key_reasons_label: 'Argumentos clave',
            style_strategies: 'Estrategias de negociaciÃ³n multi-estilo',
            copy_btn: 'Copiar', copied_btn: 'âœ“ Copiado', copy_full: 'Copiar todo', copy_full2: 'Copiar todo',
            email_section: 'Correo de comunicaciÃ³n escrita',
            revised_title: 'Contrato revisado completo',
            revised_desc: 'Se ha generado un contrato revisado basado en todos los riesgos identificados. Los cambios estÃ¡n marcados con [REVISADO].',
            revised_full_tab: 'Texto del contrato revisado',
            revision_notes: n => `Notas de revisiÃ³n (${n})`,
            download_txt: 'Descargar .txt', no_revision: 'El contrato revisado se estÃ¡ generando o no estÃ¡ disponible.',
            revision_item_label: i => `RevisiÃ³n ${i + 1}`,
            overall_risk: 'Riesgo global', risk_clauses_label: 'ClÃ¡usulas de riesgo',
            export_report: 'Exportar informe', restart_btn: 'Revisar nuevo contrato',
            quick_nav_call: 'GuiÃ³n telefÃ³nico', quick_nav_email: 'Correo',
            style_aggressive: 'Agresivo', style_consultative: 'Consultivo', style_compromise: 'Compromiso',
            risk_lv: { xh: 'Riesgo crÃ­tico', h: 'Riesgo alto', m: 'Riesgo medio', l: 'Riesgo bajo', s: 'Seguro' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'Trabajo y Empleo','æˆ¿äº§ç‰©ä¸šç±»':'Inmuebles','æ¶ˆè´¹æœåŠ¡ç±»':'Servicios al Consumidor','é‡‘èå€Ÿè´·ç±»':'Finanzas y PrÃ©stamos','ç½‘ç»œæ•°å­—ç±»':'Digital e Internet','å©šå§»å®¶åº­ç±»':'Familia y Matrimonio','ç»è¥åˆä½œç±»':'Sociedad Empresarial','å…¶ä»–ç±»':'Otros' },
          },
          'pt': {
            subtitle: 'RevisÃ£o de contratos com IA especializada', subtitle2: 'Pesquisa jurÃ­dica em tempo real', subtitle3: 'EstratÃ©gia de negociaÃ§Ã£o profunda',
            step1_heading: 'Selecione o tipo de contrato para revisÃ£o',
            step1_desc: 'Uma seleÃ§Ã£o precisa permite acesso a bases de dados jurÃ­dicas especializadas',
            expand_all: 'Expandir tudo', collapse_all: 'Recolher tudo',
            back_btn: 'â† Voltar Ã s categorias', current_type: 'Tipo: ',
            upload_title: 'Enviar contrato', upload_formats: 'PDF Â· Word Â· Imagem Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ OCR automÃ¡tico + melhoria IA',
            upload_max: n => `ğŸ“ MÃ¡x. ${n.toLocaleString()} caracteres`,
            or_paste: 'Ou colar texto diretamente', textarea_placeholder: 'Cole o texto do contrato aqui...',
            min_chars: n => `MÃ­n. ${n} caracteres`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` (faltam ${n} caracteres)`, chars_over: ' âš  Limite excedido', chars_ok: ' âœ“ Pronto',
            start_review: 'ğŸ” Iniciar revisÃ£o especializada', input_first: 'Por favor insira o texto do contrato',
            analyzing_subtitle: 'A revisÃ£o especializada geralmente leva 3-5 minutos',
            ocr_processing: 'ğŸ¤– A IA estÃ¡ melhorando a qualidade OCR...', ocr_done: 'âœ… Melhoria OCR concluÃ­da',
            cancel_btn: 'Cancelar revisÃ£o',
            stages: ['AnÃ¡lise doc.', 'Riscos', 'NegociaÃ§Ã£o', 'RevisÃ£o', 'RelatÃ³rio'],
            tab_overview: 'Ler contrato', tab_risks: 'AnÃ¡lise de riscos', tab_negotiation: 'EstratÃ©gia', tab_revised: 'Contrato revisado',
            risk_dist: 'DistribuiÃ§Ã£o de riscos', core_threats: n => `Riscos principais (${n})`,
            original_clause: 'ClÃ¡usula original', legal_basis: 'Base legal', problem_title: 'AnÃ¡lise do problema',
            action_title: 'Medidas', revision_suggestion: 'RedaÃ§Ã£o defensiva sugerida', plain_explanation: 'ExplicaÃ§Ã£o simples',
            game_overview: 'VisÃ£o geral da negociaÃ§Ã£o', call_script: 'Roteiro de ligaÃ§Ã£o',
            opening_label: 'Abertura', key_reasons_label: 'Argumentos principais',
            style_strategies: 'EstratÃ©gias de negociaÃ§Ã£o multiestilo',
            copy_btn: 'Copiar', copied_btn: 'âœ“ Copiado', copy_full: 'Copiar tudo', copy_full2: 'Copiar tudo',
            email_section: 'E-mail de comunicaÃ§Ã£o escrita',
            revised_title: 'Contrato revisado completo',
            revised_desc: 'Um contrato revisado foi gerado com base em todos os riscos identificados. As alteraÃ§Ãµes sÃ£o marcadas com [REVISADO].',
            revised_full_tab: 'Texto do contrato revisado',
            revision_notes: n => `Notas de revisÃ£o (${n})`,
            download_txt: 'Baixar .txt', no_revision: 'O contrato revisado estÃ¡ sendo gerado ou indisponÃ­vel.',
            revision_item_label: i => `RevisÃ£o ${i + 1}`,
            overall_risk: 'Risco geral', risk_clauses_label: 'ClÃ¡usulas de risco',
            export_report: 'Exportar relatÃ³rio', restart_btn: 'Revisar novo contrato',
            quick_nav_call: 'Roteiro telefÃ´nico', quick_nav_email: 'E-mail',
            style_aggressive: 'Agressivo', style_consultative: 'Consultivo', style_compromise: 'Compromisso',
            risk_lv: { xh: 'Risco crÃ­tico', h: 'Risco alto', m: 'Risco mÃ©dio', l: 'Risco baixo', s: 'Seguro' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'Trabalho e Emprego','æˆ¿äº§ç‰©ä¸šç±»':'ImÃ³veis','æ¶ˆè´¹æœåŠ¡ç±»':'ServiÃ§os ao Consumidor','é‡‘èå€Ÿè´·ç±»':'FinanÃ§as e EmprÃ©stimos','ç½‘ç»œæ•°å­—ç±»':'Digital e Internet','å©šå§»å®¶åº­ç±»':'FamÃ­lia e Casamento','ç»è¥åˆä½œç±»':'Parceria Empresarial','å…¶ä»–ç±»':'Outros' },
          },
          'ar': {
            subtitle: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø¨ÙˆØ§Ø³Ø·Ø© Ø®Ø¨Ø±Ø§Ø¡ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', subtitle2: 'Ø¨Ø­Ø« Ù‚Ø§Ù†ÙˆÙ†ÙŠ ÙÙˆØ±ÙŠ', subtitle3: 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ØªÙØ§ÙˆØ¶ Ù…ØªØ¹Ù…Ù‚Ø©',
            step1_heading: 'Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø¯ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
            step1_desc: 'Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯Ù‚ÙŠÙ‚ ÙŠØªÙŠØ­ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§Ù„Ù…ØªØ®ØµØµØ©',
            expand_all: 'ØªÙˆØ³ÙŠØ¹ Ø§Ù„ÙƒÙ„', collapse_all: 'Ø·ÙŠ Ø§Ù„ÙƒÙ„',
            back_btn: 'â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙØ¦Ø§Øª', current_type: 'Ø§Ù„Ù†ÙˆØ¹: ',
            upload_title: 'Ø±ÙØ¹ Ø§Ù„Ø¹Ù‚Ø¯', upload_formats: 'PDF Â· Word Â· ØµÙˆØ±Ø© Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ OCR ØªÙ„Ù‚Ø§Ø¦ÙŠ + ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ',
            upload_max: n => `ğŸ“ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ ${n.toLocaleString()} Ø­Ø±Ù`,
            or_paste: 'Ø£Ùˆ Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹', textarea_placeholder: 'Ø§Ù„ØµÙ‚ Ù†Øµ Ø§Ù„Ø¹Ù‚Ø¯ Ù‡Ù†Ø§...',
            min_chars: n => `Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ ${n} Ø­Ø±Ù`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` (ØªØ­ØªØ§Ø¬ ${n} Ø­Ø±ÙØ§Ù‹ Ø¥Ø¶Ø§ÙÙŠØ§Ù‹)`, chars_over: ' âš  ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯', chars_ok: ' âœ“ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„',
            start_review: 'ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø®Ø¨ÙŠØ±Ø©', input_first: 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø¹Ù‚Ø¯',
            analyzing_subtitle: 'ØªØ³ØªØºØ±Ù‚ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡ Ø¹Ø§Ø¯Ø©Ù‹ 3-5 Ø¯Ù‚Ø§Ø¦Ù‚ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
            ocr_processing: 'ğŸ¤– Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ­Ø³Ù† Ø¬ÙˆØ¯Ø© Ù†Øµ OCR...', ocr_done: 'âœ… Ø§ÙƒØªÙ…Ù„ ØªØ­Ø³ÙŠÙ† OCR',
            cancel_btn: 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
            stages: ['ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯', 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±', 'Ø§Ù„ØªÙØ§ÙˆØ¶', 'Ø§Ù„ØªØ¹Ø¯ÙŠÙ„', 'Ø§Ù„ØªÙ‚Ø±ÙŠØ±'],
            tab_overview: 'Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¹Ù‚Ø¯', tab_risks: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±', tab_negotiation: 'Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©', tab_revised: 'Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù…Ø¹Ø¯Ù‘Ù„',
            risk_dist: 'ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ø·Ø±', core_threats: n => `Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (${n})`,
            original_clause: 'Ø§Ù„Ø¨Ù†Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠ', legal_basis: 'Ø§Ù„Ø£Ø³Ø§Ø³ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ', problem_title: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©',
            action_title: 'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª', revision_suggestion: 'Ø§Ù„ØµÙŠØ§ØºØ© Ø§Ù„Ø¯ÙØ§Ø¹ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©', plain_explanation: 'Ø´Ø±Ø­ Ù…Ø¨Ø³Ù‘Ø·',
            game_overview: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙØ§ÙˆØ¶', call_script: 'Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø© Ø§Ù„Ù‡Ø§ØªÙÙŠØ©',
            opening_label: 'Ø§Ù„Ø§ÙØªØªØ§Ø­', key_reasons_label: 'Ø§Ù„Ø­Ø¬Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
            style_strategies: 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ØªÙØ§ÙˆØ¶ Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø£Ø³Ø§Ù„ÙŠØ¨',
            copy_btn: 'Ù†Ø³Ø®', copied_btn: 'âœ“ ØªÙ… Ø§Ù„Ù†Ø³Ø®', copy_full: 'Ù†Ø³Ø® Ø§Ù„ÙƒÙ„', copy_full2: 'Ù†Ø³Ø® Ø§Ù„ÙƒÙ„',
            email_section: 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„ÙƒØªØ§Ø¨ÙŠ',
            revised_title: 'Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù…Ø¹Ø¯Ù‘Ù„ Ø§Ù„ÙƒØ§Ù…Ù„',
            revised_desc: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù‚Ø¯ Ù…Ø¹Ø¯Ù‘Ù„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©. Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…ÙØ¹Ù„ÙÙ‘Ù…Ø© Ø¨Ù€ [Ù…Ø¹Ø¯Ù‘Ù„].',
            revised_full_tab: 'Ù†Øµ Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù…Ø¹Ø¯Ù‘Ù„',
            revision_notes: n => `Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (${n})`,
            download_txt: 'ØªÙ†Ø²ÙŠÙ„ .txt', no_revision: 'Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù…Ø¹Ø¯Ù‘Ù„ Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ ØºÙŠØ± Ù…ØªÙˆÙØ±.',
            revision_item_label: i => `ØªØ¹Ø¯ÙŠÙ„ ${i + 1}`,
            overall_risk: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©', risk_clauses_label: 'Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
            export_report: 'ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±', restart_btn: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯',
            quick_nav_call: 'Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù‡Ø§ØªÙ', quick_nav_email: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
            style_aggressive: 'Ø£Ø³Ù„ÙˆØ¨ Ø­Ø§Ø²Ù…', style_consultative: 'Ø£Ø³Ù„ÙˆØ¨ ØªØ´Ø§ÙˆØ±ÙŠ', style_compromise: 'Ø£Ø³Ù„ÙˆØ¨ ØªÙˆØ§ÙÙ‚ÙŠ',
            risk_lv: { xh: 'Ø®Ø·Ø± Ø­Ø±Ø¬', h: 'Ø®Ø·Ø± Ø¹Ø§Ù„Ù', m: 'Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·', l: 'Ø®Ø·Ø± Ù…Ù†Ø®ÙØ¶', s: 'Ø¢Ù…Ù†' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„ØªÙˆØ¸ÙŠÙ','æˆ¿äº§ç‰©ä¸šç±»':'Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª','æ¶ˆè´¹æœåŠ¡ç±»':'Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ','é‡‘èå€Ÿè´·ç±»':'Ø§Ù„ØªÙ…ÙˆÙŠÙ„ ÙˆØ§Ù„Ù‚Ø±ÙˆØ¶','ç½‘ç»œæ•°å­—ç±»':'Ø§Ù„Ø±Ù‚Ù…ÙŠ ÙˆØ§Ù„Ø¥Ù†ØªØ±Ù†Øª','å©šå§»å®¶åº­ç±»':'Ø§Ù„Ø²ÙˆØ§Ø¬ ÙˆØ§Ù„Ø£Ø³Ø±Ø©','ç»è¥åˆä½œç±»':'Ø§Ù„Ø´Ø±Ø§ÙƒØ© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©','å…¶ä»–ç±»':'Ø£Ø®Ø±Ù‰' },
          },
          'ru': {
            subtitle: 'Ğ­ĞºÑĞ¿ĞµÑ€Ñ‚Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ğ² Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒÑ Ğ˜Ğ˜', subtitle2: 'ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ²Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ğµ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸', subtitle3: 'Ğ“Ğ»ÑƒĞ±Ğ¾ĞºĞ°Ñ Ğ¿ĞµÑ€ĞµĞ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ',
            step1_heading: 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸',
            step1_desc: 'Ğ¢Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ñ‚Ğ¸Ğ¿Ğ° Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ñ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ²Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…',
            expand_all: 'Ğ Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ²ÑÑ‘', collapse_all: 'Ğ¡Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ²ÑÑ‘',
            back_btn: 'â† ĞĞ°Ğ·Ğ°Ğ´ Ğº Ğ²Ñ‹Ğ±Ğ¾Ñ€Ñƒ', current_type: 'Ğ¢Ğ¸Ğ¿: ',
            upload_title: 'Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€', upload_formats: 'PDF Â· Word Â· Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Â· TXT',
            upload_ocr_tip: 'ğŸ–¼ï¸ ĞĞ²Ñ‚Ğ¾-OCR + ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ Ğ˜Ğ˜',
            upload_max: n => `ğŸ“ ĞœĞ°ĞºÑ. ${n.toLocaleString()} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²`,
            or_paste: 'Ğ˜Ğ»Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ', textarea_placeholder: 'Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ° Ğ·Ğ´ĞµÑÑŒ...',
            min_chars: n => `ĞœĞ¸Ğ½. ${n} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²`,
            chars_info: (c, m) => `${c.toLocaleString()} / ${m.toLocaleString()}`,
            chars_need_more: n => ` (ĞµÑ‰Ñ‘ ${n} ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)`, chars_over: ' âš  ĞŸÑ€ĞµĞ²Ñ‹ÑˆĞµĞ½ Ğ»Ğ¸Ğ¼Ğ¸Ñ‚', chars_ok: ' âœ“ Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾',
            start_review: 'ğŸ” ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞºÑĞ¿ĞµÑ€Ñ‚Ğ½ÑƒÑ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ', input_first: 'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ°',
            analyzing_subtitle: 'Ğ­ĞºÑĞ¿ĞµÑ€Ñ‚Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ˜Ğ˜ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ 3â€“5 Ğ¼Ğ¸Ğ½ÑƒÑ‚, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ',
            ocr_processing: 'ğŸ¤– Ğ˜Ğ˜ ÑƒĞ»ÑƒÑ‡ÑˆĞ°ĞµÑ‚ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ¾ OCR-Ñ‚ĞµĞºÑÑ‚Ğ°...', ocr_done: 'âœ… Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ OCR Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾',
            cancel_btn: 'ĞÑ‚Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ',
            stages: ['ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°', 'Ğ Ğ¸ÑĞºĞ¸', 'ĞŸĞµÑ€ĞµĞ³Ğ¾Ğ²Ğ¾Ñ€Ñ‹', 'Ğ ĞµĞ´Ğ°ĞºÑ†Ğ¸Ñ', 'ĞÑ‚Ñ‡Ñ‘Ñ‚'],
            tab_overview: 'Ğ§Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€', tab_risks: 'ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ€Ğ¸ÑĞºĞ¾Ğ²', tab_negotiation: 'Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ', tab_revised: 'Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€',
            risk_dist: 'Ğ Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ€Ğ¸ÑĞºĞ¾Ğ²', core_threats: n => `ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ€Ğ¸ÑĞºĞ¸ (${n})`,
            original_clause: 'Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ğ¿ÑƒĞ½ĞºÑ‚', legal_basis: 'ĞŸÑ€Ğ°Ğ²Ğ¾Ğ²Ğ°Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ°', problem_title: 'ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹',
            action_title: 'ĞœĞµÑ€Ñ‹', revision_suggestion: 'ĞŸÑ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµĞ¼Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ½Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°', plain_explanation: 'ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğµ Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğµ',
            game_overview: 'ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ²Ğ·Ğ³Ğ»ÑĞ´ Ğ½Ğ° Ğ¿ĞµÑ€ĞµĞ³Ğ¾Ğ²Ğ¾Ñ€Ñ‹', call_script: 'Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ°',
            opening_label: 'Ğ’ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ğµ', key_reasons_label: 'ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ°Ñ€Ğ³ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹',
            style_strategies: 'Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ¿ĞµÑ€ĞµĞ³Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ğ² Ğ² Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… ÑÑ‚Ğ¸Ğ»ÑÑ…',
            copy_btn: 'ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ', copied_btn: 'âœ“ Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾', copy_full: 'ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑÑ‘', copy_full2: 'ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑÑ‘',
            email_section: 'Ğ­Ğ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğµ Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºĞ¸',
            revised_title: 'ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€',
            revised_desc: 'Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ²ÑĞµÑ… Ğ²Ñ‹ÑĞ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… Ñ€Ğ¸ÑĞºĞ¾Ğ². Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ğ¼ĞµÑ‡ĞµĞ½Ñ‹ [Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ].',
            revised_full_tab: 'Ğ¢ĞµĞºÑÑ‚ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ°',
            revision_notes: n => `ĞŸÑ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ñ Ğº Ğ¿Ñ€Ğ°Ğ²ĞºĞ°Ğ¼ (${n})`,
            download_txt: 'Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ .txt', no_revision: 'Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ¸Ğ»Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.',
            revision_item_label: i => `ĞŸÑ€Ğ°Ğ²ĞºĞ° ${i + 1}`,
            overall_risk: 'ĞĞ±Ñ‰Ğ¸Ğ¹ Ñ€Ğ¸ÑĞº', risk_clauses_label: 'Ğ Ğ¸ÑĞºĞ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿ÑƒĞ½ĞºÑ‚Ñ‹',
            export_report: 'Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ°', restart_btn: 'ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€',
            quick_nav_call: 'Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚', quick_nav_email: 'ĞŸĞ¸ÑÑŒĞ¼Ğ¾',
            style_aggressive: 'ĞĞ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ñ‹Ğ¹', style_consultative: 'ĞšĞ¾Ğ½ÑÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹', style_compromise: 'ĞšĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼Ğ¸ÑÑ',
            risk_lv: { xh: 'ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº', h: 'Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº', m: 'Ğ¡Ñ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ¸ÑĞº', l: 'ĞĞ¸Ğ·ĞºĞ¸Ğ¹ Ñ€Ğ¸ÑĞº', s: 'Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾' },
            cat_names: { 'åŠ³åŠ¨ç”¨å·¥ç±»':'Ğ¢Ñ€ÑƒĞ´Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ‹','æˆ¿äº§ç‰©ä¸šç±»':'ĞĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ','æ¶ˆè´¹æœåŠ¡ç±»':'ĞŸĞ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ ÑƒÑĞ»ÑƒĞ³Ğ¸','é‡‘èå€Ÿè´·ç±»':'Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑÑ‹ Ğ¸ ĞºÑ€ĞµĞ´Ğ¸Ñ‚Ñ‹','ç½‘ç»œæ•°å­—ç±»':'Ğ¦Ğ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ‹','å©šå§»å®¶åº­ç±»':'Ğ¡ĞµĞ¼ÑŒÑ Ğ¸ Ğ±Ñ€Ğ°Ğº','ç»è¥åˆä½œç±»':'Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ¿Ğ°Ñ€Ñ‚Ğ½Ñ‘Ñ€ÑÑ‚Ğ²Ğ¾','å…¶ä»–ç±»':'ĞŸÑ€Ğ¾Ñ‡ĞµĞµ' },
          },
        };

        // ==================== åˆåŒç±»å‹ ====================
        const CATEGORIES = [
            { id: 'åŠ³åŠ¨ç”¨å·¥ç±»', icon: 'users',         detail: '**æ¶µç›–åˆåŒ**ï¼šåŠ³åŠ¨åˆåŒã€åŠ³åŠ¡åˆåŒã€å®ä¹ åè®®ã€ç«ä¸šé™åˆ¶åè®®ã€ä¿å¯†åè®®ã€ç¦»èŒåè®®ç­‰ã€‚\n **å®¡æŸ¥é‡ç‚¹**ï¼šè¯•ç”¨æœŸçº¦å®šã€è–ªèµ„ç»“æ„ã€å·¥æ—¶åˆ¶åº¦ã€ç¤¾ä¿ç¼´çº³ã€è¿çº¦é‡‘æ¡æ¬¾ã€ç«ä¸šé™åˆ¶è¡¥å¿ç­‰ã€‚' },
            { id: 'æˆ¿äº§ç‰©ä¸šç±»', icon: 'home',          detail: '**æ¶µç›–åˆåŒ**ï¼šå•†å“æˆ¿ä¹°å–åˆåŒã€æˆ¿å±‹ç§ŸèµåˆåŒã€äºŒæ‰‹æˆ¿ä¹°å–åˆåŒã€è£…ä¿®åˆåŒã€ç‰©ä¸šæœåŠ¡åˆåŒã€æˆ¿äº§ä¸­ä»‹æœåŠ¡åˆåŒç­‰ã€‚\n **å®¡æŸ¥é‡ç‚¹**ï¼šäº§æƒæ¸…æ™°åº¦ã€äº¤ä»˜æ ‡å‡†ã€è¿çº¦è´£ä»»ã€æŠ¼é‡‘é€€è¿˜ã€è£…ä¿®è´¨é‡ã€ç‰©ä¸šè´¹ç”¨ç­‰ã€‚' },
            { id: 'æ¶ˆè´¹æœåŠ¡ç±»', icon: 'shopping-cart', detail: '**æ¶µç›–åˆåŒ**ï¼šæ•™è‚²åŸ¹è®­åˆåŒã€å¥èº«/ç¾å®¹/é¢„ä»˜å¡æœåŠ¡åˆåŒã€æ—…æ¸¸åˆåŒã€å©šåº†æœåŠ¡åˆåŒã€å®¶æ”¿æœåŠ¡åˆåŒã€ç»´ä¿®æœåŠ¡åˆåŒç­‰ã€‚\n **å®¡æŸ¥é‡ç‚¹**ï¼šé€€è´¹æ¡æ¬¾ã€æ ¼å¼æ¡æ¬¾ã€è™šå‡å®£ä¼ ã€é¢„ä»˜æ¬¾å®‰å…¨ã€æœåŠ¡æ ‡å‡†ã€éœ¸ç‹æ¡æ¬¾ç­‰ã€‚' },
            { id: 'é‡‘èå€Ÿè´·ç±»', icon: 'banknote',      detail: '**æ¶µç›–åˆåŒ**ï¼šå€Ÿæ¬¾åˆåŒï¼ˆä¸ªäºº/é“¶è¡Œï¼‰ã€ç½‘ç»œå€Ÿè´·åˆåŒã€ä¿¡ç”¨å¡åè®®ã€æ‹…ä¿åˆåŒã€æŠµæŠ¼åˆåŒã€èèµ„ç§ŸèµåˆåŒç­‰ã€‚\n **å®¡æŸ¥é‡ç‚¹**ï¼šåˆ©ç‡ä¸Šé™ã€å¤åˆ©è®¡ç®—ã€æ‹…ä¿è´£ä»»ã€æå‰è¿˜æ¬¾è¿çº¦é‡‘ã€å¾ä¿¡æ¡æ¬¾ç­‰ã€‚' },
            { id: 'ç½‘ç»œæ•°å­—ç±»', icon: 'globe',         detail: '**æ¶µç›–åˆåŒ**ï¼šç”¨æˆ·æ³¨å†Œåè®®/éšç§æ”¿ç­–ã€è½¯ä»¶è®¸å¯åè®®ã€ç”µå•†äº¤æ˜“åˆåŒã€ç½‘ç»œç›´æ’­/æ¸¸æˆæœåŠ¡åè®®ã€äº‘æœåŠ¡åˆåŒã€æ•°æ®æˆæƒåè®®ç­‰ã€‚\n **å®¡æŸ¥é‡ç‚¹**ï¼šä¸ªäººä¿¡æ¯æ”¶é›†èŒƒå›´ã€æ•°æ®ä½¿ç”¨æˆæƒã€å…è´£æ¡æ¬¾ã€è´¦å·å½’å±ã€è™šæ‹Ÿè´¢äº§ã€è‡ªåŠ¨ç»­è´¹ç­‰ã€‚' },
            { id: 'å©šå§»å®¶åº­ç±»', icon: 'heart',         detail: '**æ¶µç›–åˆåŒ**ï¼šå©šå‰/å©šå†…è´¢äº§åè®®ã€ç¦»å©šåè®®ã€æ”¶å…»åè®®ã€é—èµ æ‰¶å…»åè®®ç­‰ã€‚\n **å®¡æŸ¥é‡ç‚¹**ï¼šè´¢äº§å½’å±çº¦å®šã€å€ºåŠ¡æ‰¿æ‹…ã€å­å¥³æŠšå…»ã€èµ¡å…»ä¹‰åŠ¡ã€æ’¤é”€æ¡ä»¶ç­‰ã€‚' },
            { id: 'ç»è¥åˆä½œç±»', icon: 'briefcase',     detail: '**æ¶µç›–åˆåŒ**ï¼šåˆä¼™åè®®ã€è‚¡ä¸œåè®®/å…¬å¸ç« ç¨‹ï¼ŒåŠ ç›Ÿ/ç‰¹è®¸ç»è¥åˆåŒï¼Œç»é”€/ä»£ç†åˆåŒï¼Œè”è¥åˆåŒï¼Œå¯¹èµŒåè®®ç­‰ã€‚\n **å®¡æŸ¥é‡ç‚¹**ï¼šå‡ºèµ„è´£ä»»ï¼Œç›ˆäºåˆ†é…ï¼Œé€€å‡ºæœºåˆ¶ï¼Œç«ä¸šç¦æ­¢ï¼Œæ— é™è¿å¸¦è´£ä»»ï¼Œå¯¹èµŒæ¡æ¬¾æ•ˆåŠ›ç­‰ã€‚' },
            { id: 'å…¶ä»–ç±»',     icon: 'more-horizontal',detail: '**æ¶µç›–åˆåŒ**ï¼šæ— æ³•å½’å…¥ä¸Šè¿°7ç±»çš„åˆåŒï¼Œå¦‚èµ ä¸åˆåŒã€å€Ÿç”¨åˆåŒã€ä»“å‚¨åˆåŒã€è¿è¾“åˆåŒã€çŸ¥è¯†äº§æƒè®¸å¯ç­‰ã€‚' },
        ];


        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç™»å½•é¡µé¢ç»„ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const LoginPage = ({ onLogin, onClose }) => {
            const [mode, setMode] = React.useState('sms'); // 'sms' | 'pwd' | 'register'
            const [phone, setPhone] = React.useState('');
            const [otp, setOtp] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [confirmPwd, setConfirmPwd] = React.useState('');
            const [nickname, setNickname] = React.useState('');
            const [countdown, setCountdown] = React.useState(0);
            const [error, setError] = React.useState('');
            const [success, setSuccess] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            const [showPwd, setShowPwd] = React.useState(false);
            const [devOtp, setDevOtp] = React.useState(''); // å¼€å‘æ¨¡å¼æ˜¾ç¤ºçš„ OTP æç¤º
            const timerRef = React.useRef(null);

            React.useEffect(() => { lucide.createIcons(); }, [mode, error, success, devOtp]);
            React.useEffect(() => () => { if (timerRef.current) clearInterval(timerRef.current); }, []);

            const validatePhone = p => /^1[3-9]\d{9}$/.test(p);

            // â”€â”€ å‘é€éªŒè¯ç  â”€â”€
            const sendOtp = async () => {
                if (!validatePhone(phone)) { setError('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç ï¼ˆ11ä½ï¼‰'); return; }
                setError(''); setSuccess('');
                try {
                    const res  = await fetch(API_BASE_URL + '/auth/send-otp', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'bypass-tunnel-reminder': 'true' },
                        body: JSON.stringify({ phone }),
                    });
                    const data = await res.json();
                    if (!res.ok) { setError(data.message || 'å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'); return; }
                    setSuccess(data.message || 'éªŒè¯ç å·²å‘é€');
                    // å¼€å‘æ¨¡å¼ï¼šåç«¯è¿”å› dev_otp å­—æ®µæ–¹ä¾¿æµ‹è¯•
                    if (data.dev_otp) {
                        setDevOtp(`ğŸ”§ å¼€å‘æ¨¡å¼éªŒè¯ç ï¼š${data.dev_otp}`);
                    }
                    setCountdown(60);
                    timerRef.current = setInterval(() => setCountdown(c => {
                        if (c <= 1) { clearInterval(timerRef.current); return 0; }
                        return c - 1;
                    }), 1000);
                } catch { setError('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ'); }
            };

            // â”€â”€ ç»Ÿä¸€ç™»å½•å¤„ç† â”€â”€
            const doAuth = async (endpoint, body) => {
                setLoading(true); setError('');
                try {
                    const res  = await fetch(API_BASE_URL + endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'bypass-tunnel-reminder': 'true' },
                        body: JSON.stringify(body),
                    });
                    const data = await res.json();
                    if (!res.ok) { setError(data.message || 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•'); setLoading(false); return; }
                    // æˆåŠŸï¼šäº¤ç”±çˆ¶ç»„ä»¶å­˜å‚¨ token å¹¶æ›´æ–° currentUser
                    onLogin({ user: data.user, access_token: data.access_token, refresh_token: data.refresh_token });
                } catch { setError('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ'); setLoading(false); }
            };

            const handleSmsLogin  = () => {
                if (!validatePhone(phone)) { setError('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·'); return; }
                if (!otp) { setError('è¯·è¾“å…¥éªŒè¯ç '); return; }
                doAuth('/auth/login-sms', { phone, otp });
            };
            const handlePwdLogin  = () => {
                if (!validatePhone(phone)) { setError('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·'); return; }
                if (!password) { setError('è¯·è¾“å…¥å¯†ç '); return; }
                doAuth('/auth/login-pwd', { phone, password });
            };
            const handleRegister  = () => {
                if (!validatePhone(phone)) { setError('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·'); return; }
                if (!otp) { setError('è¯·è¾“å…¥éªŒè¯ç '); return; }
                if (!password || password.length < 6) { setError('å¯†ç è‡³å°‘ 6 ä½å­—ç¬¦'); return; }
                if (password !== confirmPwd) { setError('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´'); return; }
                doAuth('/auth/register', { phone, otp, password, nickname: nickname || undefined });
            };

            const tabs = [
                { key: 'sms', label: 'éªŒè¯ç ç™»å½•' },
                { key: 'pwd', label: 'å¯†ç ç™»å½•' },
                { key: 'register', label: 'æ³¨å†Œè´¦å·' },
            ];

            const doAction = mode === 'sms' ? handleSmsLogin : mode === 'pwd' ? handlePwdLogin : handleRegister;

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4"
                    style={{ background: 'rgba(2,6,23,0.88)', backdropFilter: 'blur(16px)' }}
                    onClick={e => { if (e.target === e.currentTarget && onClose) onClose(); }}>
                    <div className="w-full max-w-md modal-in" style={{ background: 'rgba(15,23,42,0.95)', border: '1px solid rgba(255,255,255,0.08)', borderRadius: '2rem', overflow: 'hidden', boxShadow: '0 40px 120px rgba(0,0,0,0.6)' }}>
                        {/* é¡¶éƒ¨ banner */}
                        <div className="relative px-10 pt-10 pb-7 text-center" style={{ background: 'linear-gradient(135deg, rgba(59,130,246,0.1), rgba(139,92,246,0.1))', borderBottom: '1px solid rgba(255,255,255,0.05)' }}>
                            {onClose && (
                                <button onClick={onClose} className="absolute top-5 right-5 w-8 h-8 rounded-full flex items-center justify-center text-slate-500 hover:text-white hover:bg-white/10 transition-all">
                                    <i data-lucide="x" className="w-4 h-4"></i>
                                </button>
                            )}
                            <div className="inline-flex items-center justify-center w-12 h-12 rounded-2xl mb-4" style={{ background: 'linear-gradient(135deg, #3b82f6, #8b5cf6)', boxShadow: '0 8px 24px rgba(99,102,241,0.4)' }}>
                                <i data-lucide="scale" className="w-6 h-6 text-white"></i>
                            </div>
                            <div className="text-3xl font-black display-font">å¯¹ç°¿<span className="gradient-text">AI</span></div>
                            <p className="text-slate-500 text-sm mt-1">æ™ºèƒ½åˆåŒå®¡æŸ¥ Â· æ³•å¾‹é£é™©é¢„è­¦</p>
                        </div>

                        <div className="p-8">
                            {/* ç™»å½•æ–¹å¼æ ‡ç­¾ */}
                            <div className="flex gap-1 p-1 mb-6 rounded-xl" style={{ background: 'rgba(255,255,255,0.04)', border: '1px solid rgba(255,255,255,0.06)' }}>
                                {tabs.map(tab => (
                                    <button key={tab.key}
                                        onClick={() => { setMode(tab.key); setError(''); setSuccess(''); }}
                                        className={`flex-1 py-2.5 rounded-lg text-sm font-bold transition-all ${mode === tab.key ? 'bg-gradient-to-r from-blue-600 to-violet-600 text-white shadow-lg' : 'text-slate-500 hover:text-slate-300'}`}>
                                        {tab.label}
                                    </button>
                                ))}
                            </div>

                            {/* é”™è¯¯/æˆåŠŸæç¤º */}
                            {error && (
                                <div className="flex items-center gap-2 text-sm text-red-400 rounded-xl px-4 py-3 mb-4" style={{ background: 'rgba(239,68,68,0.1)', border: '1px solid rgba(239,68,68,0.2)' }}>
                                    <i data-lucide="alert-circle" className="w-4 h-4 shrink-0"></i> {error}
                                </div>
                            )}
                            {success && (
                                <div className="flex items-center gap-2 text-sm text-emerald-400 rounded-xl px-4 py-3 mb-4" style={{ background: 'rgba(16,185,129,0.1)', border: '1px solid rgba(16,185,129,0.2)' }}>
                                    <i data-lucide="check-circle" className="w-4 h-4 shrink-0"></i> {success}
                                </div>
                            )}
                            {devOtp && (
                                <div className="flex items-center gap-2 text-sm text-amber-400 rounded-xl px-4 py-3 mb-4 font-mono" style={{ background: 'rgba(251,191,36,0.08)', border: '1px solid rgba(251,191,36,0.2)' }}>
                                    <i data-lucide="terminal" className="w-4 h-4 shrink-0"></i> {devOtp}
                                </div>
                            )}

                            <div className="space-y-3">
                                {/* æ‰‹æœºå· */}
                                <div className="relative">
                                    <span className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 text-sm font-bold">+86</span>
                                    <div className="absolute left-12 top-1/2 -translate-y-1/2 w-px h-4 bg-white/10"></div>
                                    <input type="tel" value={phone} onChange={e => setPhone(e.target.value.replace(/\D/g,'').slice(0,11))}
                                        className="login-input" style={{ paddingLeft: '3.5rem' }} placeholder="è¯·è¾“å…¥æ‰‹æœºå·" maxLength={11}
                                        onKeyDown={e => e.key === 'Enter' && doAction()} />
                                </div>

                                {/* éªŒè¯ç  */}
                                {(mode === 'sms' || mode === 'register') && (
                                    <div className="flex gap-2">
                                        <input type="text" inputMode="numeric" value={otp} onChange={e => setOtp(e.target.value.replace(/\D/g,'').slice(0,6))}
                                            className="login-input flex-1" placeholder="6ä½éªŒè¯ç " maxLength={6}
                                            onKeyDown={e => e.key === 'Enter' && doAction()} />
                                        <button onClick={sendOtp} disabled={countdown > 0}
                                            className={`px-4 py-3 rounded-2xl text-sm font-bold whitespace-nowrap transition-all shrink-0 ${countdown > 0 ? 'text-slate-600 cursor-not-allowed' : 'text-blue-400 hover:text-blue-300'}`}
                                            style={{ background: countdown > 0 ? 'rgba(255,255,255,0.03)' : 'rgba(59,130,246,0.12)', border: '1px solid ' + (countdown > 0 ? 'rgba(255,255,255,0.05)' : 'rgba(59,130,246,0.25)') }}>
                                            {countdown > 0 ? `${countdown}s` : 'è·å–éªŒè¯ç '}
                                        </button>
                                    </div>
                                )}

                                {/* å¯†ç  */}
                                {(mode === 'pwd' || mode === 'register') && (
                                    <div className="relative">
                                        <input type={showPwd ? 'text' : 'password'} value={password}
                                            onChange={e => setPassword(e.target.value)}
                                            className="login-input pr-12" placeholder={mode === 'register' ? 'è®¾ç½®å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰' : 'è¯·è¾“å…¥å¯†ç '}
                                            onKeyDown={e => e.key === 'Enter' && doAction()} />
                                        <button type="button" onClick={() => setShowPwd(v => !v)} className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-300 transition-colors">
                                            <i data-lucide={showPwd ? 'eye-off' : 'eye'} className="w-4 h-4"></i>
                                        </button>
                                    </div>
                                )}

                                {/* ç¡®è®¤å¯†ç  & æ˜µç§° (register) */}
                                {mode === 'register' && (
                                    <>
                                        <input type={showPwd ? 'text' : 'password'} value={confirmPwd}
                                            onChange={e => setConfirmPwd(e.target.value)} className="login-input"
                                            placeholder="å†æ¬¡è¾“å…¥å¯†ç ç¡®è®¤" onKeyDown={e => e.key === 'Enter' && doAction()} />
                                        <input type="text" value={nickname} onChange={e => setNickname(e.target.value)}
                                            className="login-input" placeholder="æ˜µç§°ï¼ˆå¯é€‰ï¼Œæœ€å¤š10å­—ï¼‰" maxLength={10} />
                                    </>
                                )}

                                {/* è®°ä½æˆ‘è¯´æ˜ / å¿˜è®°å¯†ç  */}
                                {mode !== 'register' && (
                                    <div className="flex items-center justify-between pt-1">
                                        <span className="text-xs text-slate-600 flex items-center gap-1.5">
                                            <i data-lucide="shield-check" className="w-3 h-3 text-emerald-600"></i>
                                            ç™»å½•çŠ¶æ€ä¿æŒ 30 å¤©
                                        </span>
                                        {mode === 'pwd' && (
                                            <button onClick={() => { setMode('sms'); setError(''); setSuccess('è¯·ä½¿ç”¨éªŒè¯ç éªŒè¯èº«ä»½åé‡ç½®å¯†ç '); }} className="text-sm text-blue-400 hover:text-blue-300 transition-colors">
                                                å¿˜è®°å¯†ç ?
                                            </button>
                                        )}
                                    </div>
                                )}

                                {/* ä¸»æ“ä½œæŒ‰é’® */}
                                <button onClick={doAction} disabled={loading}
                                    className="w-full py-4 rounded-2xl font-black text-base text-white transition-all mt-2"
                                    style={{ background: 'linear-gradient(135deg, #2563eb, #7c3aed)', boxShadow: '0 8px 24px rgba(99,102,241,0.35)', opacity: loading ? 0.7 : 1 }}>
                                    {loading ? 'å¤„ç†ä¸­...' : mode === 'register' ? 'ç«‹å³æ³¨å†Œ' : 'ç™»å½•'}
                                </button>
                            </div>

                            {/* åˆ†éš”çº¿ */}
                            <div className="flex items-center gap-3 my-5">
                                <div className="flex-1 h-px" style={{ background: 'rgba(255,255,255,0.06)' }}></div>
                                <span className="text-xs text-slate-600 font-bold">æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹ç™»å½•</span>
                                <div className="flex-1 h-px" style={{ background: 'rgba(255,255,255,0.06)' }}></div>
                            </div>

                            {/* ç¤¾äº¤ç™»å½• */}
                            <div className="flex gap-2.5">
                                {[{ emoji: 'ğŸ’¬', label: 'å¾®ä¿¡' }, { emoji: 'ğŸ', label: 'Apple' }, { emoji: 'ğŸ”µ', label: 'Google' }].map(s => (
                                    <button key={s.label} className="social-btn"
                                        onClick={() => setError('ç¬¬ä¸‰æ–¹ç™»å½•æ¼”ç¤ºæš‚ä¸å¯ç”¨ï¼Œè¯·ä½¿ç”¨æ‰‹æœºå·ç™»å½•')}>
                                        <span>{s.emoji}</span><span>{s.label}</span>
                                    </button>
                                ))}
                            </div>

                            <p className="text-center text-xs text-slate-600 mt-5">
                                ç™»å½•å³è¡¨ç¤ºåŒæ„
                                <span className="text-blue-500 mx-1 cursor-pointer hover:text-blue-400">ã€Šç”¨æˆ·åè®®ã€‹</span>
                                åŠ
                                <span className="text-blue-500 mx-1 cursor-pointer hover:text-blue-400">ã€Šéšç§æ”¿ç­–ã€‹</span>
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸ªäººä¸­å¿ƒç»„ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const ProfilePage = ({ user, onClose, onLogout, onUpdateUser, selectedLanguage, setSelectedLanguage }) => {
            const [section, setSection] = React.useState('overview');
            const [contracts, setContracts] = React.useState([]);
            const [favorites, setFavorites] = React.useState([]);
            const [contractsLoading, setContractsLoading] = React.useState(false);
            const [searchQ, setSearchQ] = React.useState('');
            const [selContract, setSelContract] = React.useState(null);
            const [editForm, setEditForm] = React.useState({ nickname: user.nickname || '', email: user.email || '', bio: user.bio || '' });
            const [notifState, setNotifState] = React.useState(user.notifications || { emailNotif: true, smsNotif: false, weeklyReport: true, riskAlert: true });
            const [changePwd, setChangePwd] = React.useState({ oldPwd: '', newPwd: '', confirmPwd: '' });
            const [msg, setMsg] = React.useState({ text: '', type: '' });
            const [showPwdPeek, setShowPwdPeek] = React.useState(false);
            const [deactivateConfirm, setDeactivateConfirm] = React.useState('');

            const flash = (text, type = 'ok') => { setMsg({ text, type }); setTimeout(() => setMsg({ text: '', type: '' }), 3500); };

            const loadData = async () => {
                setContractsLoading(true);
                try {
                    const [cRes, fRes] = await Promise.all([
                        apiGet('/auth/contracts'),
                        apiGet('/auth/favorites'),
                    ]);
                    if (cRes.ok) { setContracts(await cRes.json()); }
                    if (fRes.ok) { setFavorites(await fRes.json()); }  // favorites is a plain ID array
                } catch { flash('æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', 'err'); }
                setContractsLoading(false);
            };

            React.useEffect(() => { loadData(); }, []);
            React.useEffect(() => { setTimeout(() => lucide.createIcons(), 80); }, [section, selContract, contracts, favorites]);

            const toggleFav = async (cid) => {
                const isFav = favorites.includes(cid);
                // ä¹è§‚æ›´æ–°
                setFavorites(prev => isFav ? prev.filter(id => id !== cid) : [...prev, cid]);
                try {
                    if (isFav) {
                        await apiDelete(`/auth/favorites/${cid}`);
                    } else {
                        const res = await apiPost(`/auth/favorites/${cid}`, {});
                        if (!res.ok) throw new Error();
                    }
                } catch {
                    setFavorites(prev => isFav ? [...prev, cid] : prev.filter(id => id !== cid));
                    flash('æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•', 'err');
                }
            };

            const deleteContract = async (cid) => {
                if (!confirm('ç¡®å®šè¦åˆ é™¤æ­¤åˆåŒè®°å½•å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚')) return;
                const res = await apiDelete(`/auth/contracts/${cid}`);
                if (res.ok) {
                    setContracts(cs => cs.filter(c => c.id !== cid));
                    setFavorites(f => f.filter(id => id !== cid));
                    if (selContract?.id === cid) setSelContract(null);
                    onUpdateUser({ ...user, review_count: Math.max(0, (user.review_count || 0) - 1) });
                    flash('å·²åˆ é™¤ âœ“');
                } else { flash('åˆ é™¤å¤±è´¥', 'err'); }
            };

            const saveProfile = async () => {
                const res  = await apiPut('/auth/profile', editForm);
                const data = await res.json();
                if (res.ok) { onUpdateUser({ ...user, ...data }); flash('ä¸ªäººèµ„æ–™å·²ä¿å­˜ âœ“'); }
                else flash(data.message || 'ä¿å­˜å¤±è´¥', 'err');
            };

            const saveNotif = async () => {
                const res  = await apiPut('/auth/notifications', notifState);
                const data = await res.json();
                if (res.ok) flash('é€šçŸ¥è®¾ç½®å·²ä¿å­˜ âœ“');
                else flash(data.message || 'ä¿å­˜å¤±è´¥', 'err');
            };

            const doChangePwd = async () => {
                if (changePwd.newPwd.length < 6) { flash('æ–°å¯†ç è‡³å°‘ 6 ä½å­—ç¬¦', 'err'); return; }
                if (changePwd.newPwd !== changePwd.confirmPwd) { flash('ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´', 'err'); return; }
                const res  = await apiPut('/auth/change-password', {
                    old_password: changePwd.oldPwd || undefined,
                    new_password: changePwd.newPwd,
                });
                const data = await res.json();
                if (res.ok) {
                    setChangePwd({ oldPwd: '', newPwd: '', confirmPwd: '' });
                    flash('å¯†ç å·²æ›´æ–° âœ“');
                    onUpdateUser({ ...user, has_password: true });
                } else flash(data.message || 'å¯†ç ä¿®æ”¹å¤±è´¥', 'err');
            };

            const doDeactivate = async () => {
                if (!confirm('ç¡®å®šè¦æ°¸ä¹…æ³¨é”€è´¦å·å—ï¼Ÿæ‰€æœ‰æ•°æ®å°†è¢«åˆ é™¤ä¸”æ— æ³•æ¢å¤ã€‚')) return;
                const res  = await apiDelete('/auth/account');
                const data = await res.json();
                if (res.ok) { alert('è´¦å·å·²æ°¸ä¹…æ³¨é”€ã€‚'); clearTokens(); onLogout(); }
                else flash(data.message || 'æ³¨é”€å¤±è´¥', 'err');
            };

            const riskHex = (score) => score >= 80 ? '#ef4444' : score >= 60 ? '#f97316' : score >= 40 ? '#fbbf24' : '#10b981';

            const filtered = contracts.filter(c => !searchQ ||
                (c.contract_type||'').toLowerCase().includes(searchQ.toLowerCase()) ||
                (c.category||'').toLowerCase().includes(searchQ.toLowerCase()) ||
                (c.summary||'').toLowerCase().includes(searchQ.toLowerCase())
            );
            const favContracts = contracts.filter(c => favorites.includes(c.id));
            const totalRisks = contracts.reduce((s, c) => s + (c.issues?.length || 0), 0);
            const avgScore = contracts.length ? Math.round(contracts.reduce((s, c) => s + (c.risk_score || 0), 0) / contracts.length) : 0;

            const planInfo = { free: { label: 'å…è´¹ç‰ˆ', cls: 'plan-badge-free', quota: 'æ¯æœˆ 5 æ¬¡å®¡æŸ¥' }, pro: { label: 'Pro ä¼šå‘˜', cls: 'plan-badge-pro', quota: 'æ— é™æ¬¡å®¡æŸ¥' }, team: { label: 'å›¢é˜Ÿç‰ˆ', cls: 'plan-badge-team', quota: 'å›¢é˜Ÿå…±äº«' } }[user.plan || 'free'];

            const navItems = [
                { key: 'overview',  icon: 'layout-dashboard', label: 'æˆ‘çš„ä¸»é¡µ',   badge: null },
                { key: 'history',   icon: 'file-text',         label: 'åˆåŒæ¡£æ¡ˆ',   badge: contracts.length || null },
                { key: 'favorites', icon: 'star',               label: 'æˆ‘çš„æ”¶è—',   badge: favContracts.length || null },
                { key: 'notif',     icon: 'bell',               label: 'é€šçŸ¥è®¾ç½®',   badge: null },
                { key: 'settings',  icon: 'user-cog',           label: 'è´¦å·è®¾ç½®',   badge: null },
                { key: 'security',  icon: 'shield-check',       label: 'å®‰å…¨ä¸­å¿ƒ',   badge: null },
            ];

            const MsgBar = () => msg.text ? (
                <div className={`flex items-center gap-2 text-sm rounded-2xl px-5 py-3 mb-4 ${msg.type === 'err' ? 'text-red-400' : 'text-emerald-400'}`}
                    style={{ background: msg.type === 'err' ? 'rgba(239,68,68,0.1)' : 'rgba(16,185,129,0.1)', border: '1px solid ' + (msg.type === 'err' ? 'rgba(239,68,68,0.25)' : 'rgba(16,185,129,0.25)') }}>
                    <i data-lucide={msg.type === 'err' ? 'alert-circle' : 'check-circle'} className="w-4 h-4 shrink-0"></i> {msg.text}
                </div>
            ) : null;

            const ToggleSwitch = ({ on, onToggle }) => (
                <div className={`toggle-track ${on ? 'on' : ''}`} onClick={onToggle}>
                    <div className="toggle-knob"></div>
                </div>
            );

            return (
                <div className="fixed inset-0 z-50 overflow-y-auto scrollbar-thin" style={{ background: '#020617' }}>
                    <div className="max-w-7xl mx-auto p-5 md:p-10 min-h-screen">

                        {/* â”€â”€ é¡¶éƒ¨å¯¼èˆªæ  â”€â”€ */}
                        <div className="flex items-center justify-between mb-8 animate-up">
                            <div className="flex items-center gap-4">
                                <button onClick={onClose} className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors font-bold text-sm">
                                    <i data-lucide="arrow-left" className="w-4 h-4"></i> è¿”å›å®¡æŸ¥
                                </button>
                                <span className="text-slate-700">Â·</span>
                                <h1 className="text-xl font-black text-white">ä¸ªäººä¸­å¿ƒ</h1>
                            </div>
                            <button onClick={onLogout}
                                className="flex items-center gap-2 px-5 py-2 rounded-2xl text-slate-400 hover:text-red-400 text-sm font-bold transition-all"
                                style={{ background: 'rgba(255,255,255,0.04)', border: '1px solid rgba(255,255,255,0.07)' }}>
                                <i data-lucide="log-out" className="w-4 h-4"></i> é€€å‡ºç™»å½•
                            </button>
                        </div>

                        <div className="grid lg:grid-cols-4 gap-6">

                            {/* â”€â”€ å·¦ä¾§è¾¹æ  â”€â”€ */}
                            <div className="lg:col-span-1 space-y-4">
                                {/* ç”¨æˆ·åç‰‡ */}
                                <div className="glass-card p-6 text-center animate-up">
                                    <div className="avatar-circle mx-auto mb-4" style={{ width: '72px', height: '72px', fontSize: '1.75rem' }}>
                                        {(user.nickname || user.phone || 'U')[0].toUpperCase()}
                                    </div>
                                    <div className="font-black text-white text-base leading-tight">{user.nickname || 'æœªè®¾ç½®æ˜µç§°'}</div>
                                    <div className="text-slate-500 text-xs mt-1">{user.phone?.slice(0,3)+'****'+user.phone?.slice(7)}</div>
                                    {user.bio && <div className="text-slate-400 text-xs mt-2 italic leading-relaxed">{user.bio}</div>}
                                    <div className="mt-3">
                                        <span className={`text-xs font-black px-3 py-1 ${planInfo.cls}`}>{planInfo.label}</span>
                                    </div>
                                    <div className="grid grid-cols-2 gap-2 mt-4 pt-4" style={{ borderTop: '1px solid rgba(255,255,255,0.06)' }}>
                                        <div className="text-center">
                                            <div className="text-xl font-black text-blue-400">{contracts.length}</div>
                                            <div className="text-[10px] text-slate-500">åˆåŒæ¡£æ¡ˆ</div>
                                        </div>
                                        <div className="text-center">
                                            <div className="text-xl font-black text-amber-400">{favContracts.length}</div>
                                            <div className="text-[10px] text-slate-500">æ”¶è—æ•°é‡</div>
                                        </div>
                                    </div>
                                </div>

                                {/* å¯¼èˆªèœå• */}
                                <div className="glass-card p-3 space-y-0.5 animate-up">
                                    {navItems.map(item => (
                                        <button key={item.key}
                                            onClick={() => { setSection(item.key); setSelContract(null); setSearchQ(''); flash('', ''); }}
                                            className={`profile-nav-btn ${section === item.key ? 'active' : ''}`}>
                                            <i data-lucide={item.icon} className="w-4 h-4 shrink-0"></i>
                                            <span className="flex-1">{item.label}</span>
                                            {item.badge ? (
                                                <span className="text-[10px] font-black px-2 py-0.5 rounded-full"
                                                    style={{ background: section === item.key ? 'rgba(129,140,248,0.3)' : 'rgba(99,102,241,0.15)', color: '#818cf8' }}>
                                                    {item.badge}
                                                </span>
                                            ) : null}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* â”€â”€ å³ä¾§ä¸»å†…å®¹åŒº â”€â”€ */}
                            <div className="lg:col-span-3 animate-up">

                                {/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æˆ‘çš„ä¸»é¡µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
                                {section === 'overview' && (
                                    <div className="space-y-6">
                                        <div className="flex items-center gap-3">
                                            <div className="avatar-circle" style={{ width: '40px', height: '40px', fontSize: '1rem', flexShrink: 0 }}>
                                                {(user.nickname || 'U')[0].toUpperCase()}
                                            </div>
                                            <div>
                                                <h2 className="text-xl font-black text-white">ä½ å¥½ï¼Œ{user.nickname || 'ç”¨æˆ·'} ğŸ‘‹</h2>
                                                <p className="text-slate-500 text-xs">{new Date().toLocaleDateString('zh-CN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                            {[
                                                { label: 'å®¡æŸ¥åˆåŒ', value: contracts.length, sub: 'ä»½', icon: 'file-check', color: '#3b82f6' },
                                                { label: 'å‘ç°é£é™©', value: totalRisks, sub: 'å¤„', icon: 'alert-triangle', color: '#f97316' },
                                                { label: 'å¹³å‡é£é™©åˆ†', value: avgScore || '--', sub: '/100', icon: 'activity', color: riskHex(avgScore) },
                                                { label: 'æˆ‘çš„æ”¶è—', value: favContracts.length, sub: 'ä»½', icon: 'star', color: '#f59e0b' },
                                            ].map((s, i) => (
                                                <div key={i} className="stat-card">
                                                    <div className="w-10 h-10 rounded-2xl flex items-center justify-center mx-auto mb-3" style={{ background: s.color + '18' }}>
                                                        <i data-lucide={s.icon} className="w-5 h-5" style={{ color: s.color }}></i>
                                                    </div>
                                                    <div className="text-3xl font-black" style={{ color: s.color }}>{s.value}</div>
                                                    <div className="text-[11px] text-slate-500 mt-1">{s.sub} Â· {s.label}</div>
                                                </div>
                                            ))}
                                        </div>

                                        {/* ä¼šå‘˜å‡çº§å¡ */}
                                        <div className="glass-card p-7 relative overflow-hidden" style={{ background: 'linear-gradient(135deg, rgba(59,130,246,0.07), rgba(139,92,246,0.07))' }}>
                                            <div className="absolute -top-16 -right-16 w-48 h-48 rounded-full opacity-10" style={{ background: 'radial-gradient(circle, #a78bfa, transparent)' }}></div>
                                            <div className="flex flex-col md:flex-row items-start md:items-center gap-5">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-3 mb-2">
                                                        <span className={`text-xs font-black px-3 py-1 ${planInfo.cls}`}>{planInfo.label}</span>
                                                        <span className="text-slate-500 text-sm">{planInfo.quota}</span>
                                                    </div>
                                                    <h3 className="text-lg font-black text-white mb-1">å‡çº§ Pro ä¼šå‘˜ï¼Œè§£é”æ— é™å®¡æŸ¥</h3>
                                                    <p className="text-slate-400 text-sm">â€¢ ä¼˜å…ˆå¤„ç†é˜Ÿåˆ— &nbsp;â€¢ æ›´æ·±åº¦ AI åˆ†æ &nbsp;â€¢ ä¸“å±æ³•å¾‹æ¨¡æ¿åº“ &nbsp;â€¢ å†å²å¯¹æ¯”åŠŸèƒ½</p>
                                                </div>
                                                <button className="px-7 py-3 rounded-2xl font-black text-sm text-white transition-all shrink-0 hover:scale-105"
                                                    style={{ background: 'linear-gradient(135deg, #f59e0b, #ef4444)', boxShadow: '0 8px 24px rgba(245,158,11,0.35)' }}>
                                                    ç«‹å³å‡çº§ â†’
                                                </button>
                                            </div>
                                        </div>

                                        {/* æœ€è¿‘å®¡æŸ¥ */}
                                        <div>
                                            <h3 className="text-sm font-black text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                                                <i data-lucide="clock" className="w-4 h-4 text-blue-400"></i> æœ€è¿‘å®¡æŸ¥è®°å½•
                                            </h3>
                                            {contractsLoading ? (
                                                <div className="glass-card p-10 text-center text-slate-500">
                                                    <div className="animate-pulse text-2xl mb-2">â³</div> åŠ è½½ä¸­...
                                                </div>
                                            ) : contracts.length > 0 ? (
                                                <div className="space-y-3">
                                                    {contracts.slice(0, 4).map(c => (
                                                        <div key={c.id} className="history-card cursor-pointer" onClick={() => { setSection('history'); setSelContract(c); }}>
                                                            <div className="w-10 h-10 rounded-2xl flex items-center justify-center shrink-0" style={{ background: riskHex(c.risk_score) + '18' }}>
                                                                <i data-lucide="file-text" className="w-5 h-5" style={{ color: riskHex(c.risk_score) }}></i>
                                                            </div>
                                                            <div className="flex-1 min-w-0">
                                                                <div className="font-bold text-sm text-white truncate">{c.contract_type || 'æœªçŸ¥åˆåŒ'}</div>
                                                                <div className="text-xs text-slate-500 mt-0.5">{c.category} Â· {new Date(c.created_at).toLocaleDateString('zh-CN')}</div>
                                                            </div>
                                                            <div className="text-right shrink-0">
                                                                <div className="text-lg font-black" style={{ color: riskHex(c.risk_score) }}>{c.risk_score}</div>
                                                                <div className="text-[10px] text-slate-600">é£é™©åˆ†</div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                    {contracts.length > 4 && (
                                                        <button onClick={() => setSection('history')} className="text-sm text-blue-400 hover:text-blue-300 font-bold transition-colors ml-2">
                                                            æŸ¥çœ‹å…¨éƒ¨ {contracts.length} ä»½ â†’
                                                        </button>
                                                    )}
                                                </div>
                                            ) : (
                                                <div className="glass-card p-10 text-center">
                                                    <div className="text-5xl mb-4">ğŸ“„</div>
                                                    <p className="text-slate-400 font-bold mb-1">è¿˜æ²¡æœ‰å®¡æŸ¥è®°å½•</p>
                                                    <p className="text-slate-600 text-xs">å®ŒæˆåˆåŒå®¡æŸ¥åï¼Œè®°å½•ä¼šè‡ªåŠ¨ä¿å­˜åœ¨è¿™é‡Œ</p>
                                                    <button onClick={onClose} className="mt-4 px-6 py-2.5 text-blue-400 rounded-full text-sm font-bold transition-colors hover:text-blue-300" style={{ background: 'rgba(59,130,246,0.1)', border: '1px solid rgba(59,130,246,0.2)' }}>
                                                        å¼€å§‹å®¡æŸ¥é¦–ä»½åˆåŒ
                                                    </button>
                                                </div>
                                            )}
                                        </div>

                                        <div className="glass-card p-6 flex flex-wrap items-center gap-6 text-xs text-slate-600">
                                            <span>ğŸ“… åŠ å…¥äº {new Date(user.join_date || Date.now()).toLocaleDateString('zh-CN', { year:'numeric', month:'long', day:'numeric' })}</span>
                                            <span>ğŸ“§ {user.email || 'æœªç»‘å®šé‚®ç®±'}</span>
                                            <span>ğŸŒ {LANGUAGES.find(l => l.code === selectedLanguage)?.label || 'ç®€ä½“ä¸­æ–‡'}</span>
                                        </div>
                                    </div>
                                )}

                                {/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆåŒæ¡£æ¡ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
                                {section === 'history' && (
                                    <div className="space-y-4">
                                        <div className="flex items-center justify-between">
                                            <h2 className="text-2xl font-black text-white">åˆåŒæ¡£æ¡ˆ</h2>
                                            <span className="text-slate-500 text-sm">{contracts.length} ä»½</span>
                                        </div>

                                        {selContract ? (
                                            <div className="space-y-4 animate-up">
                                                <button onClick={() => setSelContract(null)} className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors text-sm font-bold">
                                                    <i data-lucide="arrow-left" className="w-4 h-4"></i> è¿”å›åˆ—è¡¨
                                                </button>
                                                <div className="glass-card p-8">
                                                    <div className="flex items-start gap-4 mb-6">
                                                        <div className="w-14 h-14 rounded-2xl flex items-center justify-center shrink-0" style={{ background: riskHex(selContract.risk_score) + '18' }}>
                                                            <i data-lucide="file-text" className="w-7 h-7" style={{ color: riskHex(selContract.risk_score) }}></i>
                                                        </div>
                                                        <div className="flex-1 min-w-0">
                                                            <h3 className="text-xl font-black text-white leading-tight">{selContract.contract_type}</h3>
                                                            <div className="flex flex-wrap items-center gap-2 mt-2">
                                                                <span className="text-xs text-slate-400 px-2 py-0.5 rounded-full bg-white/5">{selContract.category}</span>
                                                                <span className="text-xs text-slate-500">{new Date(selContract.created_at).toLocaleString('zh-CN')}</span>
                                                                <span className="text-xs font-black px-2.5 py-0.5 rounded-full" style={{ color: riskHex(selContract.risk_score), background: riskHex(selContract.risk_score)+'18' }}>
                                                                    âš¡ é£é™©åˆ† {selContract.risk_score}/100
                                                                </span>
                                                                {selContract.jurisdiction && <span className="text-xs text-slate-500">ğŸ“ {selContract.jurisdiction}</span>}
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-2 shrink-0">
                                                            <button onClick={() => toggleFav(selContract.id)} className={`w-9 h-9 rounded-xl flex items-center justify-center transition-all ${favorites.includes(selContract.id) ? 'text-amber-400 bg-amber-500/15' : 'text-slate-500 hover:text-amber-400 hover:bg-amber-500/10'}`}>
                                                                <i data-lucide="star" className="w-4 h-4"></i>
                                                            </button>
                                                            <button onClick={() => deleteContract(selContract.id)} className="w-9 h-9 rounded-xl flex items-center justify-center text-slate-500 hover:text-red-400 hover:bg-red-500/10 transition-all">
                                                                <i data-lucide="trash-2" className="w-4 h-4"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    {selContract.summary && (
                                                        <div className="p-5 rounded-2xl italic text-slate-300 text-sm leading-relaxed mb-6" style={{ background: 'rgba(255,255,255,0.03)', border: '1px solid rgba(255,255,255,0.06)' }}>
                                                            "{selContract.summary}"
                                                        </div>
                                                    )}
                                                    <h4 className="text-sm font-black text-slate-400 uppercase tracking-widest mb-3">è¯†åˆ«çš„é£é™©æ¡æ¬¾</h4>
                                                    {(selContract.issues || []).length > 0 ? (
                                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                            {(selContract.issues || []).map((iss, i) => (
                                                                <div key={i} className="p-4 rounded-2xl" style={{ background: 'rgba(255,255,255,0.025)', border: '1px solid rgba(255,255,255,0.06)' }}>
                                                                    <span className="risk-pill mb-2 inline-flex" style={{ color: iss.severity?.includes('é«˜') || iss.severity?.toLowerCase().includes('high') ? (iss.severity?.includes('æ') ? '#ef4444' : '#f97316') : iss.severity?.includes('ä¸­') || iss.severity?.toLowerCase() === 'medium' ? '#fbbf24' : '#10b981', background: iss.severity?.includes('æ') ? 'rgba(239,68,68,0.15)' : iss.severity?.includes('é«˜') ? 'rgba(249,115,22,0.15)' : iss.severity?.includes('ä¸­') ? 'rgba(251,191,36,0.15)' : 'rgba(16,185,129,0.15)' }}>
                                                                        {iss.severity}
                                                                    </span>
                                                                    <div className="text-sm text-slate-300 font-bold leading-snug">{iss.title}</div>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    ) : <p className="text-slate-500 text-sm">æš‚æ— é£é™©æ¡æ¬¾è®°å½•</p>}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                <div className="relative">
                                                    <i data-lucide="search" className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"></i>
                                                    <input type="text" value={searchQ} onChange={e => setSearchQ(e.target.value)}
                                                        className="login-input" style={{ paddingLeft: '2.75rem' }}
                                                        placeholder="æœç´¢åˆåŒç±»å‹ã€åˆ†ç±»ã€æ‘˜è¦..." />
                                                </div>
                                                {contractsLoading ? (
                                                    <div className="glass-card p-12 text-center text-slate-500 animate-pulse">åŠ è½½ä¸­...</div>
                                                ) : filtered.length > 0 ? (
                                                    <div className="space-y-3">
                                                        {filtered.map(c => (
                                                            <div key={c.id} className="history-card">
                                                                <div className="w-10 h-10 rounded-2xl flex items-center justify-center shrink-0" style={{ background: riskHex(c.risk_score) + '18' }}>
                                                                    <i data-lucide="file-text" className="w-4 h-4" style={{ color: riskHex(c.risk_score) }}></i>
                                                                </div>
                                                                <div className="flex-1 min-w-0 cursor-pointer" onClick={() => setSelContract(c)}>
                                                                    <div className="font-bold text-sm text-white truncate">{c.contract_type || 'æœªçŸ¥åˆåŒ'}</div>
                                                                    <div className="text-xs text-slate-500 mt-0.5">{c.category} Â· {new Date(c.created_at).toLocaleDateString('zh-CN')} Â· {c.issues?.length || 0} å¤„é£é™©</div>
                                                                </div>
                                                                <div className="flex items-center gap-2 shrink-0">
                                                                    <div className="text-right">
                                                                        <div className="text-base font-black" style={{ color: riskHex(c.risk_score) }}>{c.risk_score}</div>
                                                                        <div className="text-[10px] text-slate-600">åˆ†</div>
                                                                    </div>
                                                                    <button onClick={() => toggleFav(c.id)} className={`w-8 h-8 rounded-full flex items-center justify-center transition-all ${favorites.includes(c.id) ? 'text-amber-400' : 'text-slate-600 hover:text-amber-400'}`}>
                                                                        <i data-lucide="star" className="w-3.5 h-3.5"></i>
                                                                    </button>
                                                                    <button onClick={() => deleteContract(c.id)} className="w-8 h-8 rounded-full flex items-center justify-center text-slate-600 hover:text-red-400 transition-all">
                                                                        <i data-lucide="trash-2" className="w-3.5 h-3.5"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                ) : (
                                                    <div className="glass-card p-12 text-center">
                                                        <div className="text-5xl mb-4">{searchQ ? 'ğŸ”' : 'ğŸ“‚'}</div>
                                                        <p className="text-slate-400 font-bold">{searchQ ? 'æœªæ‰¾åˆ°åŒ¹é…ç»“æœ' : 'è¿˜æ²¡æœ‰åˆåŒè®°å½•'}</p>
                                                        {!searchQ && <button onClick={onClose} className="mt-4 px-6 py-2.5 text-blue-400 rounded-full text-sm font-bold hover:text-blue-300 transition-colors" style={{ background: 'rgba(59,130,246,0.1)', border: '1px solid rgba(59,130,246,0.2)' }}>å®¡æŸ¥é¦–ä»½åˆåŒ â†’</button>}
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æˆ‘çš„æ”¶è— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
                                {section === 'favorites' && (
                                    <div className="space-y-4">
                                        <h2 className="text-2xl font-black text-white">æˆ‘çš„æ”¶è—</h2>
                                        {favContracts.length > 0 ? (
                                            <div className="space-y-3">
                                                {favContracts.map(c => (
                                                    <div key={c.id} className="history-card">
                                                        <div className="w-10 h-10 rounded-2xl flex items-center justify-center shrink-0" style={{ background: '#f59e0b18' }}>
                                                            <i data-lucide="star" className="w-5 h-5 text-amber-400"></i>
                                                        </div>
                                                        <div className="flex-1 min-w-0 cursor-pointer" onClick={() => { setSection('history'); setSelContract(c); }}>
                                                            <div className="font-bold text-sm text-white truncate">{c.contract_type || 'æœªçŸ¥åˆåŒ'}</div>
                                                            <div className="text-xs text-slate-500 mt-0.5">{c.category} Â· {new Date(c.created_at).toLocaleDateString('zh-CN')}</div>
                                                        </div>
                                                        <div className="font-black text-base shrink-0" style={{ color: riskHex(c.risk_score) }}>{c.risk_score} åˆ†</div>
                                                        <button onClick={() => toggleFav(c.id)} className="w-8 h-8 rounded-full flex items-center justify-center text-amber-400 hover:text-slate-500 transition-all" title="å–æ¶ˆæ”¶è—">
                                                            <i data-lucide="star-off" className="w-3.5 h-3.5"></i>
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <div className="glass-card p-12 text-center">
                                                <div className="text-5xl mb-4">â­</div>
                                                <p className="text-slate-400 font-bold">æš‚æ— æ”¶è—</p>
                                                <p className="text-slate-600 text-sm mt-1">åœ¨åˆåŒæ¡£æ¡ˆä¸­ç‚¹å‡» â­ å³å¯æ”¶è—</p>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é€šçŸ¥è®¾ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
                                {section === 'notif' && (
                                    <div className="space-y-5">
                                        <h2 className="text-2xl font-black text-white">é€šçŸ¥è®¾ç½®</h2>
                                        <MsgBar />
                                        <div className="glass-card p-8 space-y-1">
                                            {[
                                                { key: 'emailNotif',    icon: 'mail',           label: 'é‚®ä»¶é€šçŸ¥',   desc: 'åˆåŒåˆ†æå®Œæˆåå‘é€é‚®ä»¶æé†’' },
                                                { key: 'smsNotif',     icon: 'message-square', label: 'çŸ­ä¿¡é€šçŸ¥',   desc: 'å‘ç°æé«˜é£é™©æ¡æ¬¾æ—¶å‘é€çŸ­ä¿¡' },
                                                { key: 'weeklyReport', icon: 'bar-chart-2',    label: 'æ¯å‘¨æŠ¥å‘Š',   desc: 'æ¯å‘¨å‘é€åˆåŒå®¡æŸ¥æ±‡æ€»æŠ¥å‘Š' },
                                                { key: 'riskAlert',    icon: 'alert-triangle', label: 'é£é™©é¢„è­¦',   desc: 'é£é™©åˆ†è¶…è¿‡ 80 åˆ†ç«‹å³æ¨é€é€šçŸ¥' },
                                            ].map((item, i, arr) => (
                                                <div key={item.key} className={`flex items-center justify-between py-5 ${i < arr.length-1 ? 'border-b' : ''}`} style={{ borderColor: 'rgba(255,255,255,0.05)' }}>
                                                    <div className="flex items-center gap-4">
                                                        <div className="w-9 h-9 rounded-xl flex items-center justify-center shrink-0" style={{ background: 'rgba(99,102,241,0.12)' }}>
                                                            <i data-lucide={item.icon} className="w-4 h-4 text-indigo-400"></i>
                                                        </div>
                                                        <div>
                                                            <div className="font-bold text-white text-sm">{item.label}</div>
                                                            <div className="text-xs text-slate-500 mt-0.5">{item.desc}</div>
                                                        </div>
                                                    </div>
                                                    <ToggleSwitch on={notifState[item.key]} onToggle={() => setNotifState(p => ({ ...p, [item.key]: !p[item.key] }))} />
                                                </div>
                                            ))}
                                        </div>
                                        <button onClick={saveNotif} className="px-8 py-3 rounded-2xl font-black text-sm text-white transition-all hover:opacity-90" style={{ background: 'linear-gradient(135deg, #2563eb, #7c3aed)', boxShadow: '0 8px 20px rgba(99,102,241,0.3)' }}>
                                            ä¿å­˜é€šçŸ¥è®¾ç½®
                                        </button>
                                    </div>
                                )}

                                {/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è´¦å·è®¾ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
                                {section === 'settings' && (
                                    <div className="space-y-5">
                                        <h2 className="text-2xl font-black text-white">è´¦å·è®¾ç½®</h2>
                                        <MsgBar />
                                        <div className="glass-card p-8 space-y-6">
                                            <div className="flex items-center gap-5 pb-6" style={{ borderBottom: '1px solid rgba(255,255,255,0.06)' }}>
                                                <div className="avatar-circle" style={{ width: '80px', height: '80px', fontSize: '2rem', flexShrink: 0 }}>
                                                    {(editForm.nickname || user.phone || 'U')[0].toUpperCase()}
                                                </div>
                                                <div>
                                                    <div className="font-black text-white text-lg">{editForm.nickname || user.phone}</div>
                                                    <div className="text-slate-500 text-sm mt-1">æ‰‹æœºå·ï¼š{user.phone}</div>
                                                    <div className="text-slate-600 text-xs mt-1">UIDï¼š{user.id?.slice(0, 8)?.toUpperCase()}</div>
                                                </div>
                                            </div>
                                            <div className="space-y-5">
                                                <div>
                                                    <label className="block text-sm font-black text-slate-400 mb-2">æ˜µç§° <span className="text-slate-600 font-normal">ï¼ˆæœ€å¤š 20 å­—ï¼‰</span></label>
                                                    <input type="text" value={editForm.nickname} onChange={e => setEditForm(f => ({...f, nickname: e.target.value}))}
                                                        className="login-input" placeholder="è®¾ç½®æ‚¨çš„æ˜µç§°" maxLength={20} />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-black text-slate-400 mb-2">ç»‘å®šé‚®ç®± <span className="text-slate-600 font-normal">ï¼ˆæ¥æ”¶é€šçŸ¥é‚®ä»¶ï¼‰</span></label>
                                                    <input type="email" value={editForm.email} onChange={e => setEditForm(f => ({...f, email: e.target.value}))}
                                                        className="login-input" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-black text-slate-400 mb-2">ä¸ªäººç®€ä»‹ <span className="text-slate-600 font-normal">ï¼ˆæœ€å¤š 200 å­—ï¼‰</span></label>
                                                    <textarea value={editForm.bio} onChange={e => setEditForm(f => ({...f, bio: e.target.value}))}
                                                        className="login-input resize-none" rows={3} placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±..." maxLength={200}
                                                        style={{ height: 'auto', lineHeight: '1.6' }} />
                                                    <div className="text-right text-xs text-slate-600 mt-1">{editForm.bio.length}/200</div>
                                                </div>
                                            </div>
                                            <button onClick={saveProfile} className="px-8 py-3 rounded-2xl font-black text-sm text-white transition-all hover:opacity-90" style={{ background: 'linear-gradient(135deg, #2563eb, #7c3aed)', boxShadow: '0 8px 20px rgba(99,102,241,0.3)' }}>
                                                ä¿å­˜ä¿®æ”¹
                                            </button>
                                        </div>

                                        <div className="glass-card p-8">
                                            <h3 className="text-base font-black text-white mb-5 flex items-center gap-2">
                                                <i data-lucide="sliders" className="w-4 h-4 text-purple-400"></i> ä½¿ç”¨åå¥½
                                            </h3>
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <div className="font-bold text-sm text-white">é»˜è®¤åˆ†æè¯­è¨€</div>
                                                    <div className="text-xs text-slate-500 mt-0.5">å½“å‰ï¼š{LANGUAGES.find(l => l.code === selectedLanguage)?.label}</div>
                                                </div>
                                                <select value={selectedLanguage} onChange={e => setSelectedLanguage(e.target.value)} className="lang-selector">
                                                    {LANGUAGES.map(l => <option key={l.code} value={l.code}>{l.label}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å®‰å…¨ä¸­å¿ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */}
                                {section === 'security' && (
                                    <div className="space-y-5">
                                        <h2 className="text-2xl font-black text-white">å®‰å…¨ä¸­å¿ƒ</h2>
                                        <MsgBar />

                                        <div className="glass-card p-6 flex items-center gap-5" style={{ background: 'linear-gradient(135deg, rgba(16,185,129,0.07), rgba(6,182,212,0.07))' }}>
                                            <div className="w-16 h-16 rounded-full flex items-center justify-center shrink-0" style={{ background: 'rgba(16,185,129,0.15)', border: '2px solid rgba(16,185,129,0.3)' }}>
                                                <i data-lucide="shield-check" className="w-8 h-8 text-emerald-400"></i>
                                            </div>
                                            <div>
                                                <div className="text-lg font-black text-white">å®‰å…¨è¯„çº§ï¼šâ­â­â­ è‰¯å¥½</div>
                                                <div className="text-sm text-slate-400 mt-0.5">JWT åŒä»¤ç‰Œé‰´æƒï¼ŒæœåŠ¡ç«¯ bcrypt åŠ å¯†ï¼ŒRefresh Token è‡ªåŠ¨è½®æ¢</div>
                                            </div>
                                        </div>

                                        <div className="glass-card p-6 space-y-3">
                                            <h3 className="text-sm font-black text-slate-400 uppercase tracking-widest mb-4">å®‰å…¨æ£€æŸ¥é¡¹</h3>
                                            {[
                                                { label: 'æ‰‹æœºå·éªŒè¯',        done: !!user.phone,     desc: user.phone || 'æœªç»‘å®š' },
                                                { label: 'æœåŠ¡ç«¯å¯†ç åŠ å¯†',     done: true,             desc: 'bcrypt å“ˆå¸Œ + éšæœº saltï¼Œæ˜æ–‡ä¸è½åº“' },
                                                { label: 'JWT Access Token', done: true,             desc: `30 åˆ†é’Ÿæœ‰æ•ˆæœŸï¼Œè‡ªåŠ¨åˆ·æ–°` },
                                                { label: 'Refresh Token è½®æ¢', done: true,           desc: 'æ¯æ¬¡åˆ·æ–°æ—§ Token ç«‹å³åŠé”€ï¼Œé˜²é‡æ”¾æ”»å‡»' },
                                                { label: 'æ¥å£é™æµä¿æŠ¤',       done: true,             desc: 'æ¯ IP æ¯åˆ†é’Ÿæœ€å¤š 10 æ¬¡é‰´æƒè¯·æ±‚' },
                                                { label: 'ç»‘å®šé‚®ç®±',          done: !!user.email,     desc: user.email || 'æœªç»‘å®šï¼Œå¯æ¥æ”¶é‡è¦é€šçŸ¥' },
                                            ].map((item, i) => (
                                                <div key={i} className="security-item">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-6 h-6 rounded-full flex items-center justify-center shrink-0 text-xs font-black ${item.done ? 'text-emerald-400 bg-emerald-500/15' : 'text-amber-400 bg-amber-500/10'}`}>
                                                            {item.done ? 'âœ“' : '!'}
                                                        </div>
                                                        <div>
                                                            <div className="font-bold text-sm text-white">{item.label}</div>
                                                            <div className="text-xs text-slate-500 mt-0.5">{item.desc}</div>
                                                        </div>
                                                    </div>
                                                    {!item.done && item.label === 'ç»‘å®šé‚®ç®±' && (
                                                        <button onClick={() => setSection('settings')} className="text-xs text-blue-400 font-bold hover:text-blue-300 transition-colors">
                                                            å»è®¾ç½® â†’
                                                        </button>
                                                    )}
                                                </div>
                                            ))}
                                        </div>

                                        <div className="glass-card p-8 space-y-4">
                                            <h3 className="text-base font-black text-white flex items-center gap-2">
                                                <i data-lucide="lock" className="w-4 h-4 text-blue-400"></i> {user.has_password ? 'ä¿®æ”¹ç™»å½•å¯†ç ' : 'è®¾ç½®ç™»å½•å¯†ç '}
                                            </h3>
                                            <p className="text-xs text-slate-500">å¯†ç é•¿åº¦è‡³å°‘ 8 ä½ã€‚å¯†ç ä»¥ bcrypt å“ˆå¸Œå½¢å¼å­˜å‚¨äºæœåŠ¡ç«¯ï¼Œç³»ç»Ÿæ— æ³•æŸ¥çœ‹æ˜æ–‡ã€‚</p>
                                            {user.has_password && (
                                                <input type="password" value={changePwd.oldPwd} onChange={e => setChangePwd(p => ({...p, oldPwd: e.target.value}))}
                                                    className="login-input" placeholder="å½“å‰å¯†ç " />
                                            )}
                                            <div className="relative">
                                                <input type={showPwdPeek ? 'text' : 'password'} value={changePwd.newPwd} onChange={e => setChangePwd(p => ({...p, newPwd: e.target.value}))}
                                                    className="login-input pr-12" placeholder="æ–°å¯†ç ï¼ˆè‡³å°‘ 8 ä½ï¼‰" />
                                                <button type="button" onClick={() => setShowPwdPeek(v => !v)} className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-300">
                                                    <i data-lucide={showPwdPeek ? 'eye-off' : 'eye'} className="w-4 h-4"></i>
                                                </button>
                                            </div>
                                            <input type={showPwdPeek ? 'text' : 'password'} value={changePwd.confirmPwd} onChange={e => setChangePwd(p => ({...p, confirmPwd: e.target.value}))}
                                                className="login-input" placeholder="ç¡®è®¤æ–°å¯†ç " />
                                            <button onClick={doChangePwd} className="px-8 py-3 rounded-2xl font-black text-sm text-white transition-all hover:opacity-90" style={{ background: 'linear-gradient(135deg, #2563eb, #7c3aed)', boxShadow: '0 8px 20px rgba(99,102,241,0.3)' }}>
                                                {user.has_password ? 'ç¡®è®¤ä¿®æ”¹å¯†ç ' : 'ç«‹å³è®¾ç½®å¯†ç '}
                                            </button>
                                        </div>

                                        <div className="glass-card p-6 space-y-4" style={{ borderColor: 'rgba(239,68,68,0.12)' }}>
                                            <h3 className="text-base font-black text-red-400 flex items-center gap-2">
                                                <i data-lucide="alert-triangle" className="w-4 h-4"></i> å±é™©æ“ä½œ
                                            </h3>
                                            <div className="security-item" style={{ background: 'rgba(239,68,68,0.04)', borderColor: 'rgba(239,68,68,0.1)' }}>
                                                <div className="flex-1">
                                                    <div className="font-bold text-sm text-white mb-1">æ°¸ä¹…æ³¨é”€è´¦å·</div>
                                                    <div className="text-xs text-slate-500 mb-3">æ­¤æ“ä½œä¸å¯é€†ï¼Œæ‰€æœ‰å®¡æŸ¥æ•°æ®å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚è¯·è¾“å…¥å½“å‰å¯†ç ï¼ˆæ— å¯†ç æ—¶è¾“å…¥ OTPï¼‰ç¡®è®¤ã€‚</div>
                                                    <input type="password" value={deactivateConfirm} onChange={e => setDeactivateConfirm(e.target.value)}
                                                        className="login-input" style={{ fontSize: '0.8rem', padding: '0.6rem 1rem' }} placeholder="è¾“å…¥å¯†ç æˆ– OTP éªŒè¯ç " />
                                                </div>
                                            </div>
                                            <button onClick={doDeactivate}
                                                className="px-5 py-2 rounded-xl text-sm font-black text-red-400 transition-all hover:bg-red-500/20"
                                                style={{ background: 'rgba(239,68,68,0.1)', border: '1px solid rgba(239,68,68,0.2)' }}>
                                                ç¡®è®¤æ³¨é”€è´¦å·
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ==================== ä¸»åº”ç”¨ ====================
        function App() {

            // â”€â”€ çŠ¶æ€ â”€â”€
            const [step, setStep]                   = useState('categorySelect');
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [expandedCat, setExpandedCat]     = useState([]);
            const [isAllExpanded, setIsAllExpanded] = useState(false);
            const [progress, setProgress]           = useState('');
            const [progressStage, setProgressStage] = useState(0); // 0-4
            const [extractedText, setExtractedText] = useState('');
            const [analysisResult, setAnalysisResult] = useState(null);
            const [activeTab, setActiveTab]         = useState('åˆåŒæ€»è§ˆ');
            const [selectedIssue, setSelectedIssue] = useState(null);
            const [contractText, setContractText]   = useState('');
            const [copyTip, setCopyTip]             = useState('');
            const [copyTipType, setCopyTipType]     = useState('');
            const [selectedLanguage, setSelectedLanguage] = useState('zh-CN');
            const [ocrStatus, setOcrStatus]         = useState(''); // OCR çŠ¶æ€æç¤º

            // â”€â”€ ç¿»è¯‘å‡½æ•° â”€â”€
            const t = (key, ...args) => {
                const dict = UI_STRINGS[selectedLanguage] || UI_STRINGS['zh-CN'];
                const fallback = UI_STRINGS['zh-CN'];
                const val = dict[key] !== undefined ? dict[key] : fallback[key];
                if (typeof val === 'function') return val(...args);
                return val !== undefined ? val : key;
            };

            // ç¿»è¯‘åˆåŒç±»å‹åç§°
            const getCatName = (id) => {
                const dict = UI_STRINGS[selectedLanguage] || UI_STRINGS['zh-CN'];
                return (dict.cat_names || {})[id] || id;
            };
            const [isDragOver, setIsDragOver]       = useState(false);
            const [fileInfo, setFileInfo]           = useState(null); // {name, size, chars}
            const [revisionView, setRevisionView]   = useState('contract'); // 'contract' | 'notes'

            // â”€â”€ ç”¨æˆ·é‰´æƒçŠ¶æ€ â”€â”€
            const [currentUser, setCurrentUser]   = useState(null);
            const [authLoading, setAuthLoading]   = useState(true);  // é¦–æ¬¡ token æ ¡éªŒ
            const [showLogin, setShowLogin]        = useState(false);
            const [showProfile, setShowProfile]    = useState(false);

            const pollingRef = useRef(null);

            // â”€â”€ å¯åŠ¨æ—¶éªŒè¯ JWTï¼Œä»åç«¯åŠ è½½ç”¨æˆ· â”€â”€
            useEffect(() => {
                fetchCurrentUser().then(user => {
                    setCurrentUser(user);
                    setAuthLoading(false);
                });
            }, []);

            const currentLength = contractText.length;
            const isTextValid   = currentLength >= MIN_CHARACTERS && currentLength <= MAX_CHARACTERS;

            // â”€â”€ å›¾æ ‡åˆ·æ–° â”€â”€
            useEffect(() => { lucide.createIcons(); }, [step, activeTab, selectedIssue]);

            // â”€â”€ å·¥å…·å‡½æ•° â”€â”€
            const normalizeRisk = (s) => String(s || '').trim();

            const getRiskColor = (s) => {
                const r = normalizeRisk(s).toLowerCase();
                if (r.includes('æé«˜') || r.includes('critical') || r.includes('trÃ¨s') || r.includes('sehr') || r.includes('muy')) return 'risk-æé«˜';
                if (r.includes('é«˜') || r === 'high' || r.includes('Ã©levÃ©') || r.includes('hoch') || r.includes('alto')) return 'risk-é«˜';
                if (r.includes('ä¸­') || r === 'medium' || r.includes('moyen') || r === 'mittel' || r.includes('medio')) return 'risk-ä¸­';
                if (r.includes('ä½') || r === 'low' || r.includes('faible') || r === 'niedrig' || r.includes('bajo')) return 'risk-ä½';
                return 'bg-slate-600';
            };

            const getBorderColor = (s) => {
                const r = normalizeRisk(s).toLowerCase();
                if (r.includes('æé«˜') || r.includes('critical')) return 'border-æé«˜';
                if (r.includes('é«˜') || r === 'high') return 'border-é«˜';
                if (r.includes('ä¸­') || r === 'medium') return 'border-ä¸­';
                if (r.includes('ä½') || r === 'low') return 'border-ä½';
                return 'border-slate-800';
            };

            const getRiskHex = (s) => {
                const r = normalizeRisk(s).toLowerCase();
                if (r.includes('æé«˜') || r.includes('critical')) return '#ef4444';
                if (r.includes('é«˜') || r === 'high') return '#f97316';
                if (r.includes('ä¸­') || r === 'medium') return '#fbbf24';
                return '#10b981';
            };

            const parseMarkdownToHtml = (text, styleType) => {
                if (!text) return '';
                const colorMap = { aggressive: 'text-red-400', consultative: 'text-blue-400', compromise: 'text-green-400' };
                const colorClass = colorMap[styleType] || 'text-blue-400';
                let html = text
                    .replace(/\*\*(.*?)\*\*/g, `<strong class="font-bold ${colorClass}">$1</strong>`)
                    .replace(/(\d+)\. (.*?)(\n|$)/g, `<div class="ml-4 mb-2 flex items-start gap-2"><span class="${colorClass} shrink-0">$1.</span><span>$2</span></div>`)
                    .replace(/\- (.*?)(\n|$)/g, `<div class="ml-8 mb-2 flex items-start gap-2"><span class="${colorClass} shrink-0">â€¢</span><span>$1</span></div>`)
                    .replace(/\n/g, '<br/>');
                return html.replace(/^(<br\/>)+/, '').replace(/(<br\/>)+$/, '');
            };

            // â”€â”€ å–æ¶ˆåˆ†æ â”€â”€
            const cancelAnalysis = () => {
                if (pollingRef.current) clearInterval(pollingRef.current);
                setStep('upload');
                setProgress('');
                setAnalysisResult(null);
                setProgressStage(0);
            };

            // â”€â”€ ç”¨æˆ·ç™»å½•å›è°ƒï¼ˆLoginPage è°ƒç”¨ï¼Œä¼ å…¥ {user, access_token, refresh_token}ï¼‰â”€â”€
            const handleLogin = ({ user, access_token, refresh_token }) => {
                setTokens(access_token, refresh_token);
                setCurrentUser(user);
                setShowLogin(false);
            };

            // â”€â”€ ç”¨æˆ·ç™»å‡º â”€â”€
            const handleLogout = async () => {
                try {
                    await apiPost('/auth/logout', { refresh_token: getRefreshToken() });
                } catch { /* å¿½ç•¥ç½‘ç»œé”™è¯¯ï¼Œç›´æ¥æ¸…é™¤æœ¬åœ° token */ }
                clearTokens();
                setCurrentUser(null);
                setShowProfile(false);
            };

            // â”€â”€ æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆProfilePage ä¿å­˜åå›è°ƒï¼‰â”€â”€
            const handleUpdateUser = (updatedUser) => {
                setCurrentUser(updatedUser);
            };

            // â”€â”€ å°†åˆ†æç»“æœå¼‚æ­¥ä¿å­˜è‡³åç«¯ â”€â”€
            const saveToHistory = async (result, category) => {
                if (!currentUser) return;
                const record = {
                    date:          new Date().toISOString(),
                    category:      category || 'å…¶ä»–ç±»',
                    contract_type: result.contractType || 'æœªçŸ¥åˆåŒ',
                    risk_score:    result.riskScore    || 0,
                    overall_risk:  result.overallRisk  || '',
                    summary:       result.summary      || '',
                    jurisdiction:  result.jurisdiction || '',
                    issues: (result.issues || []).map(i => ({
                        severity: i.severity, title: i.title, id: i.id
                    })),
                };
                try {
                    const res = await apiPost('/auth/contracts', record);
                    if (res.ok) {
                        // åŒæ­¥æ›´æ–°æœ¬åœ° reviewCount æ˜¾ç¤º
                        setCurrentUser(u => u ? { ...u, review_count: (u.review_count || 0) + 1 } : u);
                    }
                } catch (e) {
                    console.warn('ä¿å­˜åˆåŒè®°å½•å¤±è´¥:', e);
                }
            };

            // â”€â”€ ä¸‹è½½æŠ¥å‘Š â”€â”€
            const downloadReport = () => {
                const r = analysisResult;
                let text = `å¯¹ç°¿AI åˆåŒåˆ†ææŠ¥å‘Š\n========================\n\n`;
                text += `åˆåŒç±»å‹: ${r.contractType}\né£é™©åˆ†æ•°: ${r.riskScore}/100\nå›½å®¶æˆ–åœ°åŒº: ${r.jurisdiction}\n\n`;
                text += `æ€»ä½“ç‚¹è¯„:\n${r.summary}\n\n`;
                text += `æ ¸å¿ƒé£é™©ç‚¹:\n`;
                r.issues.forEach((iss, i) => {
                    text += `${i+1}. [${iss.severity.toUpperCase()}] ${iss.title}\n`;
                    text += `   é—®é¢˜: ${iss.problem}\n`;
                    text += `   å»ºè®®: ${(iss.whatToDo||[]).join(', ')}\n\n`;
                });
                text += `\n========================================\nè°ˆåˆ¤ä¸åšå¼ˆç­–ç•¥\n========================================\n\n`;
                text += `ä¸€ã€åšå¼ˆå…¨å±€è§‚\n${r.negotiation.strategy}\n\n`;
                text += `äºŒã€ç”µè¯é¢è°ˆè„šæœ¬\nå¼€åœºï¼š${r.negotiation.talkTrack.opening}\n\næ ¸å¿ƒç†ç”±ï¼š\n`;
                r.negotiation.talkTrack.reasons.forEach((item, i) => { text += `${i+1}. ${item}\n`; });
                text += `\nä¸‰ã€å¤šé£æ ¼è°ˆåˆ¤ç­–ç•¥\n\n1) å¼ºç¡¬é£æ ¼\n${r.negotiation.styles.aggressive}\n\n2) åå•†é£æ ¼\n${r.negotiation.styles.consultative}\n\n3) å¦¥åé£æ ¼\n${r.negotiation.styles.compromise}\n\n`;
                text += `å››ã€ä¹¦é¢æ²Ÿé€šé‚®ä»¶\n${r.negotiation.email}`;
                if (r.revisedContract) {
                    text += `\n\n========================================\nå®Œæ•´ä¿®è®¢åˆåŒ\n========================================\n\n${r.revisedContract}`;
                }
                const blob = new Blob([text], { type: 'text/plain' });
                const url  = URL.createObjectURL(blob);
                const a    = document.createElement('a');
                a.href     = url;
                a.download = `ContractClarity_å®Œæ•´åˆ†ææŠ¥å‘Š_${Date.now()}.txt`;
                a.click();
            };

            // â”€â”€ ä¸‹è½½ä¿®è®¢åˆåŒ â”€â”€
            const downloadRevisedContract = () => {
                if (!analysisResult?.revisedContract) return;
                const blob = new Blob([analysisResult.revisedContract], { type: 'text/plain' });
                const url  = URL.createObjectURL(blob);
                const a    = document.createElement('a');
                a.href     = url;
                a.download = `ContractClarity_ä¿®è®¢åˆåŒ_${Date.now()}.txt`;
                a.click();
            };

            // â”€â”€ OCR AI ä¼˜åŒ– â”€â”€
            const refineOcrText = async (rawText) => {
                setOcrStatus(t('ocr_processing'));
                try {
                    const res = await fetch(`${API_BASE_URL}/ocr-refine`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'bypass-tunnel-reminder': 'true' },
                        body: JSON.stringify({ text: rawText, language: selectedLanguage })
                    });
                    const data = await res.json();
                    if (data.refined) {
                        setOcrStatus(t('ocr_done'));
                        setTimeout(() => setOcrStatus(''), 3000); // Fix 2: 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
                        return data.refined;
                    }
                } catch (e) {
                    console.warn('OCR refine failed, using raw text:', e);
                }
                setOcrStatus('');
                return rawText;
            };

            // â”€â”€ æ–‡ä»¶ä¸Šä¼ å¤„ç† â”€â”€
            const handleFileUpload = async (files) => {
                setStep('analyzing');
                setProgress('æ­£åœ¨æ™ºèƒ½è§£ææ–‡æ¡£...');
                setProgressStage(0);
                let fullText = '';
                try {
                    for (const f of Array.from(files)) {
                        const ext = f.name.split('.').pop().toLowerCase();
                        const fileSizeMB = (f.size / 1024 / 1024).toFixed(2);

                        if (ext === 'txt') {
                            fullText += await new Promise(res => {
                                const r = new FileReader();
                                r.onload = e => res(e.target.result);
                                r.readAsText(f);
                            });
                        } else if (ext === 'docx') {
                            const res = await mammoth.extractRawText({ arrayBuffer: await f.arrayBuffer() });
                            fullText += res.value;
                        } else if (ext === 'pdf') {
                            const pdf = await pdfjsLib.getDocument({ data: await f.arrayBuffer() }).promise;
                            for (let i = 1; i <= pdf.numPages; i++) {
                                const page    = await pdf.getPage(i);
                                const content = await page.getTextContent();
                                fullText += content.items.map(it => it.str).join(' ') + '\n';
                            }
                        } else if (['png', 'jpg', 'jpeg', 'webp', 'bmp'].includes(ext)) {
                            setProgress(`æ­£åœ¨è¿›è¡Œ OCR æ–‡å­—è¯†åˆ«ï¼ˆ${f.name}ï¼‰...`);
                            const worker = await Tesseract.createWorker();
                            await worker.loadLanguage('chi_sim+chi_tra+eng+jpn+kor');
                            await worker.initialize('chi_sim+chi_tra+eng');
                            const { data: { text: t } } = await worker.recognize(f);
                            await worker.terminate();
                            // AI ä¼˜åŒ– OCR ç»“æœ
                            setProgress('æ­£åœ¨ä¼˜åŒ– OCR è¯†åˆ«ç»“æœ...');
                            const refined = await refineOcrText(t);
                            fullText += refined + '\n';
                        }
                    }

                    if (!fullText.trim()) throw new Error('æ–‡æœ¬æå–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶å†…å®¹');
                    if (fullText.trim().length < MIN_CHARACTERS) throw new Error(`æå–çš„æ–‡æœ¬ä¸è¶³ ${MIN_CHARACTERS} å­—ï¼Œè¯·ä¸Šä¼ å†…å®¹æ›´å®Œæ•´çš„æ–‡æ¡£`);

                    // è¶…å‡ºå­—æ•°æ—¶æˆªæ–­å¹¶æç¤º
                    let finalText = fullText.trim();
                    if (finalText.length > FILE_MAX_CHARS) {
                        finalText = finalText.substring(0, FILE_MAX_CHARS);
                        console.warn(`æ–‡ä»¶å†…å®¹è¶…å‡º ${FILE_MAX_CHARS} å­—é™åˆ¶ï¼Œå·²è‡ªåŠ¨æˆªæ–­ã€‚`);
                    }

                    setExtractedText(finalText);
                    startPollingAI(finalText);
                } catch (e) {
                    alert(e.message);
                    setStep('upload');
                    setProgressStage(0);
                }
            };

            // â”€â”€ æ‹–æ”¾å¤„ç† â”€â”€
            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragOver(false);
                const files = e.dataTransfer.files;
                if (files.length) handleFileUpload(files);
            };

            // â”€â”€ å¯åŠ¨ AI åˆ†æ â”€â”€
            const startPollingAI = async (text) => {
                setProgress('æ­£åœ¨åˆå§‹åŒ–åˆ†æä»»åŠ¡...');
                setProgressStage(1);
                try {
                    const response = await fetch(`${API_BASE_URL}/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'bypass-tunnel-reminder': 'true' },
                        body: JSON.stringify({ text, category: selectedCategory, language: selectedLanguage })
                    });
                    const { task_id } = await response.json();

                    pollingRef.current = setInterval(async () => {
                        try {
                            const res    = await fetch(`${API_BASE_URL}/status/${task_id}`, { headers: { 'bypass-tunnel-reminder': 'true', 'ngrok-skip-browser-warning': 'true' } });
                            const status = await res.json();

                            if (status.progress) {
                                setProgress(status.progress);
                            }

                            // Fix 3: ä¼˜å…ˆä½¿ç”¨åç«¯è¿”å›çš„ stage å­—æ®µï¼Œé¿å…ä¸­æ–‡å…³é”®è¯åŒ¹é…å¤±æ•ˆ
                            if (status.stage !== undefined) {
                                setProgressStage(status.stage);
                            } else if (status.progress) {
                                // å…¼å®¹æ—§ç‰ˆåç«¯ï¼šå›é€€åˆ°å…³é”®è¯åŒ¹é…ï¼ˆå·²ä¿®æ­£'ä¿®è®¢ç‰ˆ'åŒ¹é…ï¼‰
                                if      (status.progress.includes('é£é™©å®¡æŸ¥'))  setProgressStage(1);
                                else if (status.progress.includes('é‚®ä»¶'))      setProgressStage(2);
                                else if (status.progress.includes('è¯æœ¯'))      setProgressStage(2);
                                else if (status.progress.includes('ä¿®è®¢ç‰ˆ'))    setProgressStage(3); // ä¿®æ­£ï¼šåŸ'ä¿®è®¢åˆåŒ'æ— æ³•åŒ¹é…
                                else if (status.progress.includes('æ•´åˆ'))      setProgressStage(4);
                            }

                            if (status.status === 'completed') {
                                clearInterval(pollingRef.current);
                                setAnalysisResult(status.result);
                                setStep('results');
                                setProgressStage(0);
                                saveToHistory(status.result, selectedCategory);
                                if (status.result.issues?.length > 0) setSelectedIssue(status.result.issues[0]);
                                setTimeout(() => lucide.createIcons(), 100);
                            } else if (status.status === 'failed') {
                                clearInterval(pollingRef.current);
                                alert('AI å¤„ç†å¤±è´¥: ' + status.error);
                                setStep('upload');
                                setProgressStage(0);
                            }
                        } catch (e) { console.log('è½®è¯¢å¼‚å¸¸:', e); }
                    }, 1000);
                } catch (e) {
                    alert('æœåŠ¡å¯åŠ¨å¤±è´¥: ' + e.message);
                    setStep('upload');
                    setProgressStage(0);
                }
            };

            // â”€â”€ æ”¹è¿›çš„æ–‡æœ¬é«˜äº®ï¼ˆæ”¯æŒè·¨è¡Œç©ºç™½åŒ¹é…ï¼‰â”€â”€
            const renderHighlightedText = () => {
                if (!analysisResult || !extractedText) return <span>{extractedText}</span>;
                let html = extractedText
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;');

                analysisResult.issues.forEach(iss => {
                    if (!iss.clauseText || iss.clauseText.length < 4) return;
                    try {
                        // å°† clauseText ä¸­çš„è¿ç»­ç©ºç™½æ›¿æ¢æˆ \s+ ä»¥æ”¯æŒè·¨è¡ŒåŒ¹é…
                        const escaped = iss.clauseText
                            .replace(/&/g, '&amp;')
                            .replace(/</g, '&lt;')
                            .replace(/>/g, '&gt;')
                            .replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
                            .replace(/\s+/g, '\\s+');
                        const regex = new RegExp(`(${escaped})`, 'gs');
                        const severity = normalizeRisk(iss.severity);
                        html = html.replace(regex,
                            `<span class="highlight-${severity} px-1 rounded font-bold cursor-pointer" ` +
                            `title="${iss.title.replace(/"/g, '&quot;')}" ` +
                            `style="text-decoration:underline dotted;">$1</span>`
                        );
                    } catch (e) { /* æ­£åˆ™æ— æ•ˆæ—¶è·³è¿‡ */ }
                });
                return <div dangerouslySetInnerHTML={{ __html: html }} />;
            };

            // â”€â”€ ä¿®è®¢åˆåŒæ¸²æŸ“ï¼ˆé«˜äº®ã€ä¿®è®¢ã€‘æ ‡è®°ï¼‰â”€â”€
            const renderRevisedContract = (text) => {
                if (!text) return '';
                const escaped = text
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/\n/g, '<br/>');
                return escaped.replace(
                    /ã€ä¿®è®¢ã€‘(.*?)(?=<br\/>|$)/g,
                    '<span class="revision-marker">ã€ä¿®è®¢ã€‘$1</span>'
                );
            };

            // â”€â”€ å­—ç¬¦æ¡é¢œè‰² â”€â”€
            const getCharBarClass = (len) => {
                if (len > MAX_CHARACTERS) return 'char-bar-error';
                if (len > MAX_CHARACTERS * 0.8) return 'char-bar-warn';
                return 'char-bar-ok';
            };
            const charBarWidth = Math.min((currentLength / MAX_CHARACTERS) * 100, 100);

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å­ç»„ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

            // è¿·ä½ ä»ªè¡¨ç›˜
            const MiniDashboard = () => {
                const counts = {};
                analysisResult.issues.forEach(i => {
                    const s = normalizeRisk(i.severity);
                    counts[s] = (counts[s] || 0) + 1;
                });
                const total = analysisResult.issues.length || 1;
                const items = Object.entries(counts).sort((a, b) => b[1] - a[1]);
                return (
                    <div className="glass-card-light p-5 space-y-3">
                        <div className="text-xs font-black uppercase tracking-widest text-slate-500 mb-4">{t('risk_dist')}</div>
                        {items.map(([label, count]) => (
                            <div key={label} className="flex items-center gap-3">
                                <div className={`w-3 h-3 rounded-full shrink-0 ${getRiskColor(label)}`}></div>
                                <span className="text-sm text-slate-400 w-12 shrink-0">{label}</span>
                                <div className="flex-1 bg-white/5 rounded-full h-2 overflow-hidden">
                                    <div
                                        className={`risk-bar h-full rounded-full ${getRiskColor(label)}`}
                                        style={{ width: `${(count / total) * 100}%` }}
                                    ></div>
                                </div>
                                <span className="text-sm font-black text-slate-300 w-4 text-right">{count}</span>
                            </div>
                        ))}
                    </div>
                );
            };

            // é£é™©ä»ªè¡¨ç›˜
            const RiskMeter = ({ score }) => {
                const radius = 90;
                const circ   = Math.PI * radius;
                const offset = circ - (score / 100) * circ;
                const getColor = (s) => {
                    if (s <= 50) {
                        const p = s / 50;
                        return `rgb(${Math.round(16+(251-16)*p)},${Math.round(185+(191-185)*p)},${Math.round(129+(36-129)*p)})`;
                    }
                    const p = (s-50)/50;
                    return `rgb(${Math.round(251+(239-251)*p)},${Math.round(191+(68-191)*p)},${Math.round(36+(68-36)*p)})`;
                };
                const getRiskLabel = (s) => {
                    if (s >= 80) return { text: t('risk_lv').xh, color: '#ef4444' };
                    if (s >= 60) return { text: t('risk_lv').h,  color: '#f97316' };
                    if (s >= 40) return { text: t('risk_lv').m,  color: '#fbbf24' };
                    if (s >= 20) return { text: t('risk_lv').l,  color: '#10b981' };
                    return          { text: t('risk_lv').s,  color: '#059669' };
                };
                const strokeColor = getColor(score);
                const riskInfo    = getRiskLabel(score);
                return (
                    <div className="relative flex flex-col items-center">
                        <svg width="240" height="140" viewBox="0 0 240 140">
                            <defs>
                                <filter id="glow">
                                    <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
                                    <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
                                </filter>
                            </defs>
                            <path d="M20,120 A100,100 0 0,1 220,120" fill="none" stroke="#1e293b" strokeWidth="14" strokeLinecap="round"/>
                            <path className="gauge-ring" d="M20,120 A100,100 0 0,1 220,120" fill="none"
                                stroke={strokeColor} strokeWidth="14" strokeLinecap="round"
                                strokeDasharray={`${circ} ${circ}`} strokeDashoffset={offset}
                                filter="url(#glow)"
                            />
                            {[0,25,50,75,100].map((tick, i) => {
                                const angle = (Math.PI * tick) / 100;
                                const x1 = 120-100*Math.cos(angle), y1 = 120-100*Math.sin(angle);
                                const x2 = 120-85*Math.cos(angle),  y2 = 120-85*Math.sin(angle);
                                return <line key={i} x1={x1} y1={y1} x2={x2} y2={y2} stroke="#334155" strokeWidth="2" strokeLinecap="round"/>;
                            })}
                        </svg>
                        <div className="absolute top-16 text-center">
                            <span className="text-6xl font-black" style={{ color: strokeColor }}>{score || 0}</span>
                            <div className="text-[11px] font-bold text-slate-500 uppercase tracking-widest mt-1">RISK SCORE</div>
                        </div>
                        <div className="mt-4 px-6 py-2 rounded-full text-sm font-black tracking-wider"
                            style={{ backgroundColor: `${riskInfo.color}20`, color: riskInfo.color, border: `2px solid ${riskInfo.color}40` }}>
                            {riskInfo.text}
                        </div>
                    </div>
                );
            };

            // è¿›åº¦æ­¥éª¤æŒ‡ç¤ºå™¨
            const ProgressStepper = () => {
                const stages = t('stages');
                return (
                    <div className="flex items-center gap-2 justify-center mt-8">
                        {stages.map((s, i) => (
                            <React.Fragment key={s}>
                                <div className={`flex flex-col items-center gap-1 transition-all ${i < progressStage ? 'opacity-100' : i === progressStage ? 'opacity-100' : 'opacity-20'}`}>
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-black ${
                                        i < progressStage  ? 'bg-green-500 text-white' :
                                        i === progressStage ? 'bg-blue-500 text-white animate-pulse' :
                                        'bg-white/10 text-slate-500'
                                    }`}>
                                        {i < progressStage ? 'âœ“' : i+1}
                                    </div>
                                    <span className="text-[10px] text-slate-400 whitespace-nowrap">{s}</span>
                                </div>
                                {i < stages.length-1 && (
                                    <div className={`flex-1 h-px max-w-[32px] mb-4 ${i < progressStage ? 'bg-green-500' : 'bg-white/10'}`}></div>
                                )}
                            </React.Fragment>
                        ))}
                    </div>
                );
            };

            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ¸²æŸ“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            if (authLoading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center animate-fade">
                            <div className="inline-flex items-center justify-center w-16 h-16 rounded-3xl mb-5"
                                style={{ background: 'linear-gradient(135deg, #3b82f6, #8b5cf6)', boxShadow: '0 12px 32px rgba(99,102,241,0.4)' }}>
                                <i data-lucide="scale" className="w-8 h-8 text-white"></i>
                            </div>
                            <div className="text-2xl font-black display-font">å¯¹ç°¿<span className="gradient-text">AI</span></div>
                            <div className="flex items-center justify-center gap-1.5 mt-4">
                                {[0,1,2].map(i => (
                                    <div key={i} className="w-2 h-2 rounded-full bg-blue-500 animate-pulse"
                                        style={{ animationDelay: `${i*0.2}s` }}></div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-7xl mx-auto p-4 md:p-10 min-h-screen">

                    {/* â”€â”€ ç™»å½•å¼¹çª— â”€â”€ */}
                    {showLogin && (
                        <LoginPage
                            onLogin={handleLogin}
                            onClose={() => setShowLogin(false)}
                        />
                    )}

                    {/* â”€â”€ ä¸ªäººä¸­å¿ƒï¼ˆå…¨å±è¦†ç›–ï¼‰ â”€â”€ */}
                    {showProfile && currentUser && (
                        <ProfilePage
                            user={currentUser}
                            onClose={() => setShowProfile(false)}
                            onLogout={handleLogout}
                            onUpdateUser={handleUpdateUser}
                            selectedLanguage={selectedLanguage}
                            setSelectedLanguage={setSelectedLanguage}
                        />
                    )}

                    {/* â”€â”€ å¤´éƒ¨ â”€â”€ */}
                    <header className="text-center mb-14 animate-up">
                        <div className="flex items-center justify-between mb-6">
                            <div className="inline-flex items-center gap-2 px-4 py-2 glass-card border-blue-500/20 text-blue-400 text-xs font-bold tracking-widest uppercase">
                                <i data-lucide="shield" className="w-4 h-4"></i> AI-Powered Contract Review
                            </div>
                        {/* è¯­è¨€é€‰æ‹©å™¨ + ç”¨æˆ·å…¥å£ */}
                        <div className="flex items-center gap-3">
                            <i data-lucide="globe-2" className="w-4 h-4 text-slate-500"></i>
                            <select
                                value={selectedLanguage}
                                onChange={e => setSelectedLanguage(e.target.value)}
                                className="lang-selector"
                            >
                                {LANGUAGES.map(l => (
                                    <option key={l.code} value={l.code}>{l.label}</option>
                                ))}
                            </select>
                            <span className="text-slate-700 hidden md:block">|</span>
                            {currentUser ? (
                                <button className="user-avatar-btn" onClick={() => setShowProfile(true)}>
                                    <div className="avatar-circle" style={{ width: '28px', height: '28px', fontSize: '0.75rem' }}>
                                        {(currentUser.nickname || currentUser.phone || 'U')[0].toUpperCase()}
                                    </div>
                                    <span className="text-sm font-bold text-slate-300 hidden md:block max-w-[80px] truncate">
                                        {currentUser.nickname || (currentUser.phone?.slice(0,3) + '****' + currentUser.phone?.slice(7))}
                                    </span>
                                    <i data-lucide="chevron-down" className="w-3 h-3 text-slate-500 hidden md:block"></i>
                                </button>
                            ) : (
                                <button onClick={() => setShowLogin(true)}
                                    className="flex items-center gap-1.5 px-4 py-2 rounded-xl font-bold text-sm text-blue-400 transition-all hover:text-blue-300"
                                    style={{ background: 'rgba(59,130,246,0.1)', border: '1px solid rgba(59,130,246,0.2)' }}>
                                    <i data-lucide="user" className="w-3.5 h-3.5"></i>
                                    <span className="hidden md:inline">ç™»å½• / æ³¨å†Œ</span>
                                    <span className="md:hidden">ç™»å½•</span>
                                </button>
                            )}
                        </div>
                        </div>
                        <h1 className="text-5xl md:text-8xl font-black display-font mb-4 tracking-tighter">
                            å¯¹ç°¿<span className="gradient-text">AI</span>
                        </h1>
                        <p className="text-xl text-slate-300 font-light italic">
                            <span className="gradient-text">Contract Clarity</span>
                            <span className="text-slate-500 mx-3">Â·</span>{t('subtitle')}
                            <span className="text-slate-500 mx-3">Â·</span>{t('subtitle2')}
                            <span className="text-slate-500 mx-3">Â·</span>{t('subtitle3')}
                        </p>
                    </header>

                    {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
                    {/* æ­¥éª¤ 1: é€‰æ‹©åˆåŒç±»å‹                                */}
                    {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
                    {step === 'categorySelect' && (
                        <div className="max-w-5xl mx-auto animate-up">
                            <div className="text-center mb-10">
                                <h2 className="text-3xl font-bold text-white mb-2">{t('step1_heading')}</h2>
                                <p className="text-slate-400 mb-4">{t('step1_desc')}</p>
                                <button
                                    onClick={() => { setIsAllExpanded(!isAllExpanded); setExpandedCat(isAllExpanded ? [] : CATEGORIES.map(c => c.id)); }}
                                    className="px-6 py-2 bg-blue-600/20 text-blue-400 rounded-full text-sm font-bold hover:bg-blue-600/30 transition-colors"
                                >
                                    {isAllExpanded ? t('collapse_all') : t('expand_all')}
                                </button>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-5 items-start">
                                {CATEGORIES.map(cat => (
                                    <div key={cat.id} className={`glass-card p-6 transition-all hover-lift border-2 ${selectedCategory === cat.id ? 'border-blue-500 bg-blue-500/5' : 'border-white/5 hover:border-white/20'}`}>
                                        <div className="flex justify-between items-center">
                                            <div className="flex items-center gap-4 flex-1 cursor-pointer"
                                                onClick={() => { setSelectedCategory(cat.id); setStep('upload'); }}>
                                                <div className="p-3 rounded-2xl bg-blue-600/20 text-blue-400">
                                                    <i data-lucide={cat.icon} className="w-6 h-6"></i>
                                                </div>
                                                <span className="text-xl font-bold text-white">{getCatName(cat.id)}</span>
                                            </div>
                                            <button
                                                onClick={e => { e.stopPropagation(); setExpandedCat(prev => prev.includes(cat.id) ? prev.filter(id => id !== cat.id) : [...prev, cat.id]); setTimeout(() => lucide.createIcons(), 100); }}
                                                className="p-2 hover:bg-white/5 rounded-full transition-colors text-slate-500"
                                            >
                                                <i data-lucide={expandedCat.includes(cat.id) ? 'chevron-up' : 'chevron-down'} className="w-5 h-5"></i>
                                            </button>
                                        </div>
                                        {expandedCat.includes(cat.id) && (
                                            <div className="mt-4 pt-4 border-t border-white/5 text-sm text-slate-400 leading-relaxed negotiation-markdown"
                                                dangerouslySetInnerHTML={{ __html: parseMarkdownToHtml(cat.detail) }}>
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
                    {/* æ­¥éª¤ 2: ä¸Šä¼  / ç²˜è´´                                */}
                    {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
                    {step === 'upload' && (
                        <div className="max-w-4xl mx-auto space-y-10 animate-up">
                            <div className="flex justify-between items-center px-2">
                                <button onClick={() => setStep('categorySelect')}
                                    className="flex items-center gap-2 text-slate-400 hover:text-white transition-colors">
                                    <i data-lucide="arrow-left" className="w-4 h-4"></i> {t('back_btn')}
                                </button>
                                <div className="flex items-center gap-3">
                                    <span className="text-sm font-bold text-blue-400 uppercase tracking-widest">{t('current_type')}{getCatName(selectedCategory)}</span>
                                    <span className="text-slate-600">|</span>
                                    <span className="text-sm text-slate-400">{LANGUAGES.find(l=>l.code===selectedLanguage)?.label}</span>
                                </div>
                            </div>

                            {/* æ–‡ä»¶ä¸Šä¼ åŒº */}
                            <div
                                className={`upload-zone glass-card p-14 text-center border-2 border-dashed cursor-pointer group shadow-2xl ${isDragOver ? 'drag-over' : 'border-white/10 hover:border-blue-500/40'}`}
                                onClick={() => document.getElementById('fileInput').click()}
                                onDragOver={e => { e.preventDefault(); setIsDragOver(true); }}
                                onDragLeave={() => setIsDragOver(false)}
                                onDrop={handleDrop}
                            >
                                <input id="fileInput" type="file" multiple className="hidden"
                                    accept=".pdf,.docx,.txt,.png,.jpg,.jpeg,.webp,.bmp"
                                    onChange={e => handleFileUpload(e.target.files)} />
                                <div className="text-7xl mb-6 group-hover:scale-110 transition-transform duration-500 select-none">ğŸ“„</div>
                                <h3 className="text-2xl font-bold mb-2 text-white">{t('upload_title')}</h3>
                                <p className="text-slate-500 text-sm uppercase tracking-widest mb-3">{t('upload_formats')}</p>
                                <div className="inline-flex gap-3 text-xs text-slate-500">
                                    <span className="px-3 py-1 rounded-full bg-white/5 border border-white/10">{t('upload_ocr_tip')}</span>
                                    <span className="px-3 py-1 rounded-full bg-white/5 border border-white/10">{t('upload_max', FILE_MAX_CHARS)}</span>
                                </div>
                            </div>

                            <div className="relative flex items-center gap-4 text-slate-500">
                                <div className="flex-1 h-px bg-white/5"></div>
                                <span className="text-xs font-black uppercase tracking-widest">{t('or_paste')}</span>
                                <div className="flex-1 h-px bg-white/5"></div>
                            </div>

                            {/* æ–‡æœ¬è¾“å…¥åŒº */}
                            <div className="glass-card p-8">
                                <textarea
                                    id="txtArea"
                                    value={contractText}
                                    onChange={e => setContractText(e.target.value.substring(0, MAX_CHARACTERS))}
                                    className="w-full h-64 bg-white/5 border border-white/10 rounded-2xl p-5 focus:ring-2 focus:ring-blue-500/30 focus:border-transparent text-base text-slate-200 placeholder:text-slate-500 resize-none scrollbar-thin leading-relaxed font-mono"
                                    placeholder={t('textarea_placeholder')}
                                    style={{ lineHeight: '1.8', whiteSpace: 'pre-wrap', wordBreak: 'break-word' }}
                                />

                                {/* å­—ç¬¦æ¡ */}
                                <div className="mt-3 space-y-1">
                                    <div className="w-full h-1.5 bg-white/5 rounded-full overflow-hidden">
                                        <div
                                            className={`char-bar-fill h-full rounded-full ${getCharBarClass(currentLength)}`}
                                            style={{ width: `${charBarWidth}%` }}
                                        ></div>
                                    </div>
                                    <div className="flex justify-between text-xs">
                                        <span className="text-slate-500">{t('min_chars', MIN_CHARACTERS)}</span>
                                        <span className={currentLength > MAX_CHARACTERS ? 'text-red-400 font-bold' : currentLength < MIN_CHARACTERS ? 'text-slate-500' : 'text-green-400 font-bold'}>
                                            {t('chars_info', currentLength, MAX_CHARACTERS)}
                                            {currentLength < MIN_CHARACTERS && t('chars_need_more', MIN_CHARACTERS - currentLength)}
                                            {currentLength > MAX_CHARACTERS && t('chars_over')}
                                            {currentLength >= MIN_CHARACTERS && currentLength <= MAX_CHARACTERS && t('chars_ok')}
                                        </span>
                                    </div>
                                </div>

                                <button
                                    onClick={() => { setExtractedText(contractText); setStep('analyzing'); startPollingAI(contractText); }}
                                    disabled={!isTextValid}
                                    className={`w-full mt-6 py-5 rounded-3xl font-black text-xl transition-all ${isTextValid ? 'bg-gradient-to-r from-blue-600 to-violet-600 hover:from-blue-500 hover:to-violet-500 shadow-xl shadow-blue-900/30 hover:shadow-blue-800/40' : 'bg-slate-700 text-slate-500 cursor-not-allowed opacity-60'}`}
                                >
                                    {isTextValid ? t('start_review') : t('input_first')}
                                </button>
                            </div>
                        </div>
                    )}

                    {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
                    {/* æ­¥éª¤ 3: åˆ†æä¸­                                      */}
                    {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
                    {step === 'analyzing' && (
                        <div className="text-center py-32 glass-card max-w-3xl mx-auto animate-up">
                            {/* æ—‹è½¬ç¯åŠ¨ç”» */}
                            <div className="relative w-36 h-36 mx-auto mb-10">
                                <div className="pulse-ring"></div>
                                <div className="pulse-ring" style={{ animationDelay: '0.5s' }}></div>
                                <div className="absolute inset-0 flex items-center justify-center">
                                    <div className="w-20 h-20 rounded-full bg-blue-600/20 border border-blue-500/30 flex items-center justify-center">
                                        <i data-lucide="scale" className="w-10 h-10 text-blue-400"></i>
                                    </div>
                                </div>
                            </div>

                            <h2 className="text-2xl font-bold mb-2 gradient-text">{progress || '...'}</h2>
                            <p className="text-slate-500 text-sm mb-4">{t('analyzing_subtitle')}</p>

                            {ocrStatus && (
                                <div className="inline-flex items-center gap-2 text-sm text-amber-400 mb-4 px-4 py-2 bg-amber-500/10 rounded-full border border-amber-500/20">
                                    <i data-lucide="cpu" className="w-4 h-4"></i> {ocrStatus}
                                </div>
                            )}

                            <ProgressStepper />

                            <button onClick={cancelAnalysis} className="mt-10 px-10 py-4 glass-card border-red-500/30 text-red-400 font-black hover:bg-red-500/10 transition-all mx-auto">
                                {t('cancel_btn')}
                            </button>
                        </div>
                    )}

                    {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
                    {/* æ­¥éª¤ 4: åˆ†æç»“æœ                                    */}
                    {/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */}
                    {step === 'results' && analysisResult && (
                        <div className="space-y-8 animate-up">

                            {/* æ¦‚è§ˆå¤´éƒ¨ */}
                            <div className="grid lg:grid-cols-4 gap-6">
                                <div className="lg:col-span-3 glass-card p-10 flex flex-col md:flex-row items-center gap-10">
                                    <div className="flex-1">
                                        <div className="flex items-center gap-3 mb-4">
                                            <div className="text-xs font-black uppercase tracking-widest text-blue-400 px-3 py-1 bg-blue-500/10 rounded-full border border-blue-500/20">{getCatName(selectedCategory)}</div>
                                            <div className="text-xs text-slate-500">{LANGUAGES.find(l=>l.code===selectedLanguage)?.label}</div>
                                        </div>
                                        <h2 className="text-4xl font-black mb-3 text-white tracking-tighter">{analysisResult.contractType}</h2>
                                        <div className="flex items-center gap-3 text-slate-400 text-base mb-6">
                                            <i data-lucide="landmark" className="w-5 h-5 text-blue-500"></i>
                                            {analysisResult.jurisdiction}
                                        </div>
                                        <div className="p-6 bg-white/5 border border-white/5 rounded-3xl italic text-slate-300 text-lg leading-relaxed">
                                            " {analysisResult.summary} "
                                        </div>
                                    </div>
                                    <RiskMeter score={analysisResult.riskScore} />
                                </div>
                                <div className={`${getRiskColor(analysisResult.overallRisk)} p-10 rounded-[3rem] flex flex-col justify-center items-center shadow-2xl relative overflow-hidden group hover-lift`}>
                                    <div className="absolute inset-0 bg-black/10 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div>
                                    <span className="text-xs font-black uppercase tracking-[0.4em] mb-4 opacity-70">{t('overall_risk')}</span>
                                    <h3 className="text-4xl font-black text-center mb-4">{analysisResult.overallRisk.toUpperCase()}</h3>
                                    <div className="text-3xl font-black opacity-80">{analysisResult.issues.length}</div>
                                    <div className="text-xs opacity-60 mb-6">{t('risk_clauses_label')}</div>
                                    <button onClick={downloadReport} className="px-6 py-2 bg-black/20 hover:bg-black/40 rounded-full text-xs font-black transition-all">
                                        {t('export_report')}
                                    </button>
                                </div>
                            </div>

                            {/* æ ‡ç­¾æ  */}
                            <div className="flex flex-wrap gap-3 glass-card p-4 w-max">
                                {[
                                    { id: 'åˆåŒæ€»è§ˆ', label: t('tab_overview'),    icon: 'file-text'    },
                                    { id: 'é£é™©ç»†èŠ‚', label: t('tab_risks'),       icon: 'shield-alert' },
                                    { id: 'è°ˆåˆ¤å»ºè®®', label: t('tab_negotiation'), icon: 'trending-up'  },
                                    { id: 'ä¿®è®¢åˆåŒ', label: t('tab_revised'),     icon: 'file-check-2' },
                                ].map(tab => (
                                    <button key={tab.id}
                                        onClick={() => { setActiveTab(tab.id); setTimeout(() => lucide.createIcons(), 50); }}
                                        className={`px-8 py-4 rounded-[1.25rem] font-bold flex items-center gap-3 transition-all ${activeTab === tab.id ? 'tab-btn-active' : 'hover:bg-white/5 text-slate-400'}`}>
                                        <i data-lucide={tab.icon} className="w-4 h-4"></i> {tab.label}
                                        {tab.id === 'ä¿®è®¢åˆåŒ' && analysisResult.revisedContract && (
                                            <span className="ml-1 px-1.5 py-0.5 bg-green-500 text-white text-[9px] font-black rounded-full uppercase tracking-wider">NEW</span>
                                        )}
                                    </button>
                                ))}
                            </div>

                            {/* â”€â”€â”€ åˆåŒæ€»è§ˆ â”€â”€â”€ */}
                            {activeTab === 'åˆåŒæ€»è§ˆ' && (
                                <div className="grid lg:grid-cols-3 gap-8 h-[820px]">
                                    <div className="lg:col-span-2 h-full overflow-hidden">
                                        <div className="text-view-box scrollbar-thin h-full overflow-y-auto text-sm">
                                            {renderHighlightedText()}
                                        </div>
                                    </div>
                                    <div className="h-full overflow-y-auto pr-2 scrollbar-thin space-y-5">
                                        <MiniDashboard />
                                        <div>
                                            <h3 className="text-base font-bold flex items-center gap-2 text-orange-400 px-2 mb-3">
                                                <i data-lucide="list" className="w-4 h-4"></i>
                                                {t('core_threats', analysisResult.issues.length)}
                                            </h3>
                                            <div className="space-y-3 pb-4">
                                                {analysisResult.issues.map(iss => (
                                                    <div key={iss.id}
                                                        onClick={() => { setSelectedIssue(iss); setActiveTab('é£é™©ç»†èŠ‚'); }}
                                                        className="p-5 glass-card border-white/5 hover:border-blue-500/50 transition-all cursor-pointer group hover-lift"
                                                    >
                                                        <div className="flex items-center gap-3 mb-1">
                                                            <div className={`w-2.5 h-2.5 rounded-full shrink-0 ${getRiskColor(iss.severity)}`}></div>
                                                            <span className="text-[10px] font-black uppercase text-slate-500">{iss.severity}</span>
                                                        </div>
                                                        <div className="font-bold text-sm text-slate-200 group-hover:text-blue-400 leading-snug">{iss.title}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* â”€â”€â”€ é£é™©ç»†èŠ‚ â”€â”€â”€ */}
                            {activeTab === 'é£é™©ç»†èŠ‚' && (
                                <div className="grid lg:grid-cols-4 gap-8 h-[820px]">
                                    <div className="lg:col-span-1 glass-card p-5 space-y-3 overflow-y-auto scrollbar-thin">
                                        {analysisResult.issues.map(iss => (
                                            <div key={iss.id}
                                                onClick={() => setSelectedIssue(iss)}
                                                className={`p-4 rounded-2xl cursor-pointer transition-all border-l-[6px] ${selectedIssue?.id === iss.id ? getRiskColor(iss.severity) + ' border-transparent shadow-lg' : 'glass-card-light opacity-50 hover:opacity-100'}`}
                                                style={{ borderColor: selectedIssue?.id === iss.id ? 'transparent' : getRiskHex(iss.severity) + '60' }}
                                            >
                                                <div className="text-[11px] font-black uppercase mb-1 opacity-80">{iss.severity}</div>
                                                <div className="font-bold text-sm leading-snug">{iss.title}</div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="lg:col-span-3 glass-card p-12 overflow-y-auto scrollbar-thin">
                                        {selectedIssue && (
                                            <div className="space-y-10 animate-fade">
                                                <div className="flex items-center gap-6">
                                                    <div className={`w-16 h-16 rounded-[1.5rem] flex items-center justify-center shrink-0 ${getRiskColor(selectedIssue.severity)}`}>
                                                        <i data-lucide="eye" className="w-8 h-8"></i>
                                                    </div>
                                                    <h2 className="text-2xl font-black text-white leading-tight">{selectedIssue.title}</h2>
                                                </div>

                                                {/* åŸæ–‡ */}
                                                <div className="p-8 bg-amber-500/8 rounded-[2rem] border border-amber-500/15">
                                                    <span className="font-black text-amber-400 flex items-center gap-2 mb-4 text-base">
                                                        <i data-lucide="quote" className="w-4 h-4"></i> {t('original_clause')}
                                                    </span>
                                                    <div className="text-slate-200 text-base leading-relaxed font-mono"
                                                        dangerouslySetInnerHTML={{ __html: (selectedIssue.clauseText||'').replace(/\n/g,'<br/>') }}/>
                                                </div>

                                                {/* æ³•å¾‹ä¾æ® */}
                                                <div className="p-8 bg-blue-500/8 rounded-[2rem] border border-blue-500/15">
                                                    <h4 className="font-black text-blue-400 mb-4 flex items-center gap-2 text-base">
                                                        <i data-lucide="gavel" className="w-4 h-4"></i> {t('legal_basis')}
                                                    </h4>
                                                    <div className="text-slate-200 text-base leading-relaxed italic"
                                                        dangerouslySetInnerHTML={{ __html: (selectedIssue.lawReference||'æ ¹æ®ç›¸å…³æ³•å¾‹æ³•è§„').replace(/\n/g,'<br/>') }}/>
                                                </div>

                                                {/* é—®é¢˜ & å»ºè®® */}
                                                <div className="grid md:grid-cols-2 gap-8">
                                                    <div className={`p-8 glass-card border-t-[8px] shadow-xl ${getBorderColor(selectedIssue.severity)}`}>
                                                        <h4 className="font-black text-red-400 mb-4 flex items-center gap-2 text-base">{t('problem_title')}</h4>
                                                        <div className="text-slate-300 text-base leading-relaxed"
                                                            dangerouslySetInnerHTML={{ __html: (selectedIssue.problem||'').replace(/\n/g,'<br/>') }}/>
                                                    </div>
                                                    <div className="p-8 glass-card border-t-[8px] border-green-500 shadow-xl">
                                                        <h4 className="font-black text-green-400 mb-4 flex items-center gap-2 text-base">{t('action_title')}</h4>
                                                        <ul className="space-y-2">
                                                            {(selectedIssue.whatToDo||[]).map((a, i) => (
                                                                <li key={i} className="text-slate-300 text-sm flex items-start gap-2">
                                                                    <svg className="text-green-500 w-4 h-4 mt-0.5 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 6L9 17l-5-5"/></svg>
                                                                    <span>{a}</span>
                                                                </li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                </div>

                                                {/* ä¿®è®¢å»ºè®® */}
                                                <div className="p-10 bg-blue-500/5 rounded-[2.5rem] border border-blue-500/15">
                                                    <h4 className="font-black text-blue-400 mb-4 flex items-center gap-2 text-base">
                                                        <i data-lucide="pen-line" className="w-4 h-4"></i> {t('revision_suggestion')}
                                                    </h4>
                                                    <p className="text-slate-100 text-base font-serif italic leading-relaxed">{selectedIssue.alternative}</p>
                                                </div>

                                                {/* é€šä¿—è§£é‡Š */}
                                                {(selectedIssue.plainLanguage||[]).length > 0 && (
                                                    <div className="p-8 bg-purple-500/5 rounded-[2rem] border border-purple-500/15">
                                                        <h4 className="font-black text-purple-400 mb-4 flex items-center gap-2 text-base">
                                                            <i data-lucide="message-circle" className="w-4 h-4"></i> {t('plain_explanation')}
                                                        </h4>
                                                        <ul className="space-y-2">
                                                            {selectedIssue.plainLanguage.map((p, i) => (
                                                                <li key={i} className="text-slate-300 text-sm flex items-start gap-2">
                                                                    <span className="text-purple-400 font-black shrink-0">â†’</span>
                                                                    <span>{p}</span>
                                                                </li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* â”€â”€â”€ è°ˆåˆ¤å»ºè®® â”€â”€â”€ */}
                            {activeTab === 'è°ˆåˆ¤å»ºè®®' && (
                                <div className="h-[820px] overflow-y-auto scrollbar-thin pr-2 pb-10">
                                    <div className="space-y-10 max-w-5xl mx-auto">

                                        {/* åšå¼ˆå…¨å±€è§‚ */}
                                        <div className="glass-card p-14 border-blue-500/10 shadow-2xl relative overflow-hidden">
                                            <div className="absolute -top-40 -right-40 w-80 h-80 bg-blue-500/5 blur-[100px] rounded-full pointer-events-none"></div>
                                            <h3 className="text-2xl font-black text-blue-400 mb-8 flex items-center gap-4">
                                                <i data-lucide="target" className="w-8 h-8"></i> {t('game_overview')}
                                            </h3>
                                            <p className="text-xl text-slate-100 leading-tight italic font-serif border-l-[10px] border-blue-500 pl-10">{analysisResult.negotiation.strategy}</p>
                                        </div>

                                        {/* å¿«é€Ÿå¯¼èˆª */}
                                        <div className="glass-card p-6 flex flex-wrap gap-3">
                                            <button onClick={() => document.getElementById('talk-track-section').scrollIntoView({ behavior: 'smooth' })}
                                                className="px-6 py-2.5 rounded-full text-sm font-black bg-purple-500/10 text-purple-400 hover:bg-purple-500/20 border border-purple-500/20 transition-all">
                                                <i data-lucide="mic" className="w-4 h-4 inline-block mr-2"></i>{t('quick_nav_call')}
                                            </button>
                                            <button onClick={() => document.getElementById('email-section').scrollIntoView({ behavior: 'smooth' })}
                                                className="px-6 py-2.5 rounded-full text-sm font-black bg-indigo-500/10 text-indigo-400 hover:bg-indigo-500/20 border border-indigo-500/20 transition-all">
                                                <i data-lucide="mail" className="w-4 h-4 inline-block mr-2"></i>{t('quick_nav_email')}
                                            </button>
                                        </div>

                                        {/* ç”µè¯é¢è°ˆè„šæœ¬ */}
                                        <div id="talk-track-section" className="glass-card p-10 space-y-8 shadow-xl">
                                            <h3 className="text-xl font-bold text-orange-400 flex items-center gap-3">
                                                <i data-lucide="mic" className="w-5 h-5"></i> {t('call_script')}
                                            </h3>
                                            <div className="space-y-6">
                                                <div>
                                                    <span className="text-xs font-black text-slate-500 uppercase tracking-widest block mb-3">{t('opening_label')}</span>
                                                    <p className="italic text-slate-100 text-xl font-serif leading-relaxed border-l-4 border-orange-500 pl-6">" {analysisResult.negotiation.talkTrack.opening} "</p>
                                                </div>
                                                <div>
                                                    <span className="text-xs font-black text-slate-500 uppercase tracking-widest block mb-3">{t('key_reasons_label')}</span>
                                                    <ul className="space-y-4">
                                                        {(analysisResult.negotiation.talkTrack.reasons||[]).map((r, i) => (
                                                            <li key={i} className="text-slate-300 text-lg flex gap-4 leading-relaxed italic">
                                                                <i data-lucide="chevron-right" className="text-orange-500 w-5 h-5 shrink-0 mt-1"></i>
                                                                {r}
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        {/* å¤šé£æ ¼ç­–ç•¥ */}
                                        <div className="space-y-6">
                                            <h3 className="text-2xl font-bold text-white flex items-center gap-3">
                                                <i data-lucide="layers" className="w-6 h-6"></i> {t('style_strategies')}
                                            </h3>
                                            {[
                                                { key: 'aggressive',   label: t('style_aggressive'),   color: 'red',   },
                                                { key: 'consultative', label: t('style_consultative'), color: 'blue',  },
                                                { key: 'compromise',   label: t('style_compromise'),   color: 'green', },
                                            ].map(({ key, label, color }) => (
                                                <div key={key} className={`w-full p-8 glass-card border-t-[6px] shadow-xl bg-${color}-500/5 flex gap-6`}
                                                    style={{ borderTopColor: `var(--tw-shadow-color, ${color === 'red' ? '#ef4444' : color === 'blue' ? '#3b82f6' : '#10b981'})` }}>
                                                    <div className="w-40 shrink-0 flex flex-col gap-3">
                                                        <span className={`text-sm font-black text-${color}-400 uppercase tracking-widest`}>{label}</span>
                                                        <button
                                                            onClick={async () => { await navigator.clipboard.writeText(analysisResult.negotiation.styles[key]); setCopyTip(t('copied_btn')); setCopyTipType(key); setTimeout(() => setCopyTip(''), 2000); }}
                                                            className={`px-3 py-1.5 bg-${color}-500/15 text-${color}-400 rounded-full text-xs font-black hover:bg-${color}-500 hover:text-white transition-all`}
                                                        >
                                                            {copyTipType === key && copyTip ? copyTip : t('copy_btn')}
                                                        </button>
                                                    </div>
                                                    <div className="flex-1 text-slate-200 text-base italic leading-relaxed"
                                                        dangerouslySetInnerHTML={{ __html: parseMarkdownToHtml(analysisResult.negotiation.styles[key] || '', key) }}>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        {/* ä¹¦é¢é‚®ä»¶ */}
                                        <div id="email-section" className="glass-card p-10 shadow-2xl">
                                            <div className="flex justify-between items-center mb-6">
                                                <h3 className="text-xl font-bold text-indigo-300 flex items-center gap-3">
                                                    <i data-lucide="mail" className="w-5 h-5"></i> {t('email_section')}
                                                </h3>
                                                <button
                                                    onClick={async () => { await navigator.clipboard.writeText(analysisResult.negotiation.email); setCopyTip(t('copied_btn')); setCopyTipType('email'); setTimeout(() => setCopyTip(''), 2000); }}
                                                    className="px-4 py-1.5 bg-indigo-500/15 text-indigo-400 rounded-full text-sm font-black hover:bg-indigo-500 hover:text-white transition-all"
                                                >
                                                    {copyTipType === 'email' && copyTip ? copyTip : t('copy_full')}
                                                </button>
                                            </div>
                                            <div className="bg-black/40 p-8 rounded-[1.5rem] text-base leading-relaxed text-slate-300 font-mono border border-white/5">
                                                <pre className="whitespace-pre-wrap">{analysisResult.negotiation.email}</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* â”€â”€â”€ ä¿®è®¢åˆåŒ â”€â”€â”€ */}
                            {activeTab === 'ä¿®è®¢åˆåŒ' && (
                                <div className="space-y-6 animate-fade">

                                    {/* ä¿®è®¢æ‘˜è¦ */}
                                    <div className="glass-card p-8 border-green-500/20 relative overflow-hidden">
                                        <div className="absolute -top-20 -right-20 w-60 h-60 bg-green-500/5 blur-[80px] rounded-full pointer-events-none"></div>
                                        <div className="flex items-start gap-5">
                                            <div className="w-14 h-14 rounded-2xl bg-green-500/20 border border-green-500/30 flex items-center justify-center shrink-0">
                                                <i data-lucide="file-check-2" className="w-7 h-7 text-green-400"></i>
                                            </div>
                                            <div className="flex-1">
                                                <h3 className="text-xl font-black text-green-400 mb-2">{t('revised_title')}</h3>
                                                <p className="text-slate-300 text-base leading-relaxed">{analysisResult.revisionSummary || t('revised_desc')}</p>
                                            </div>
                                            <div className="flex gap-3 shrink-0">
                                                <button
                                                    onClick={async () => { await navigator.clipboard.writeText(analysisResult.revisedContract||''); setCopyTip(t('copied_btn')); setCopyTipType('revised'); setTimeout(() => setCopyTip(''), 2000); }}
                                                    className="px-5 py-2 bg-green-500/15 text-green-400 rounded-full text-sm font-black hover:bg-green-500 hover:text-white transition-all"
                                                >
                                                    {copyTipType === 'revised' && copyTip ? copyTip : t('copy_full2')}
                                                </button>
                                                <button
                                                    onClick={downloadRevisedContract}
                                                    className="px-5 py-2 bg-blue-500/15 text-blue-400 rounded-full text-sm font-black hover:bg-blue-500 hover:text-white transition-all"
                                                >
                                                    {t('download_txt')}
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    {/* å­æ ‡ç­¾ï¼šåˆåŒ / ä¿®è®¢è¯´æ˜ */}
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setRevisionView('contract')}
                                            className={`px-6 py-2.5 rounded-xl text-sm font-bold transition-all ${revisionView === 'contract' ? 'bg-green-500/20 text-green-400 border border-green-500/30' : 'text-slate-400 hover:bg-white/5'}`}
                                        >
                                            <i data-lucide="file-text" className="w-4 h-4 inline-block mr-2"></i>{t('revised_full_tab')}
                                        </button>
                                        {(analysisResult.revisionNotes||[]).length > 0 && (
                                            <button
                                                onClick={() => setRevisionView('notes')}
                                                className={`px-6 py-2.5 rounded-xl text-sm font-bold transition-all ${revisionView === 'notes' ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' : 'text-slate-400 hover:bg-white/5'}`}
                                            >
                                                <i data-lucide="list-checks" className="w-4 h-4 inline-block mr-2"></i>{t('revision_notes', analysisResult.revisionNotes.length)}
                                            </button>
                                        )}
                                    </div>

                                    {revisionView === 'contract' && (
                                        <div className="revised-contract-box scrollbar-thin overflow-y-auto" style={{ maxHeight: '700px' }}>
                                            {analysisResult.revisedContract ? (
                                                <div dangerouslySetInnerHTML={{ __html: renderRevisedContract(analysisResult.revisedContract) }} />
                                            ) : (
                                                <div className="text-slate-500 italic text-center py-10">{t('no_revision')}</div>
                                            )}
                                        </div>
                                    )}

                                    {revisionView === 'notes' && (
                                        <div className="space-y-4 max-h-[700px] overflow-y-auto scrollbar-thin pr-2">
                                            {(analysisResult.revisionNotes||[]).map((note, i) => (
                                                <div key={i} className="revision-note-card">
                                                    <div className="flex items-start gap-3">
                                                        <div className="w-6 h-6 rounded-full bg-green-500/20 border border-green-500/40 flex items-center justify-center text-[10px] font-black text-green-400 shrink-0">{i+1}</div>
                                                        <div>
                                                            <div className="text-green-400 font-bold text-sm mb-1">{note.clauseRef || t('revision_item_label', i)}</div>
                                                            <div className="text-slate-300 text-sm leading-relaxed">{note.change}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* é‡æ–°å¼€å§‹ */}
                            <div className="mt-16 text-center pb-32">
                                <button onClick={() => window.location.reload()}
                                    className="px-20 py-6 glass-card border-none bg-white text-black font-black text-xl hover:bg-slate-100 active:scale-95 transition-all shadow-[0_30px_90px_rgba(255,255,255,0.08)]">
                                    {t('restart_btn')}
                                </button>
                            </div>
                        </div>
                    )}

                    {/* é¡µè„š */}
                    <footer className="mt-auto py-10 text-center border-t border-white/5 opacity-25 text-[10px] uppercase tracking-[0.8em] font-black">
                        ContractClarity Â© 2026 | Mole Lab
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>
